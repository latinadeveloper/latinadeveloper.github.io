<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Conceptos Básicos de Action Mailer — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/prism/default.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/prism/rails-guides.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/prism.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/responsive-tables.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Conceptos Básicos de Action Mailer — Ruby on Rails Guides" />
  <meta name="description" content="NO LEA ESTE ARCHIVO EN GITHUB, LAS GUÍAS SE PUBLICAN EN https://guides.rubyonrails.org.Conceptos Básicos de Action MailerEsta guía le proporciona todo lo que necesita para comenzar a enviar correos electrónicos desde y hacia su aplicación, y muchos aspectos internos de Action Remitente. También cubre cómo probar sus anuncios publicitarios.Después de leer esta guía, sabrá: Cómo enviar correo electrónico dentro de una aplicación Rails. Cómo generar y editar una clase de Action Mailer y una vista de mailer. Cómo configurar Action Mailer para su entorno. Cómo probar tus clases de Action Mailer." />
  <meta property="og:description" content="NO LEA ESTE ARCHIVO EN GITHUB, LAS GUÍAS SE PUBLICAN EN https://guides.rubyonrails.org.Conceptos Básicos de Action MailerEsta guía le proporciona todo lo que necesita para comenzar a enviar correos electrónicos desde y hacia su aplicación, y muchos aspectos internos de Action Remitente. También cubre cómo probar sus anuncios publicitarios.Después de leer esta guía, sabrá: Cómo enviar correo electrónico dentro de una aplicación Rails. Cómo generar y editar una clase de Action Mailer y una vista de mailer. Cómo configurar Action Mailer para su entorno. Cómo probar tus clases de Action Mailer." />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
<!--    <img src="images/edge_badge.png" alt="edge-badge" id="edge-badge" />-->
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Más en <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Más Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guías</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://stackoverflow.com/questions/tagged/ruby-on-rails">Pedir Ayuda</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribuir on GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Guías de Ruby on Rails">Guías de Ruby on Rails </a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Inicio</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Index de Guías </a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Empieza Aqui</dt>
                  <dd><a href="getting_started.html">Introducción a Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Modelos</dt>
                  <dd><a href="active_record_basics.html">Conceptos básicos de Active Record</a></dd>
                  <dd><a href="active_record_migrations.html">Migraciones de Active Record</a></dd>
                  <dd><a href="active_record_validations.html">Validaciones de Active Record</a></dd>
                  <dd><a href="active_record_callbacks.html">Devolución (callbacks) de Llamadas de Active Record</a></dd>
                  <dd><a href="association_basics.html">Asociaciones de Active Record</a></dd>
                  <dd><a href="active_record_querying.html">Interfaz de Consulta de Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Vistas</dt>
                  <dd><a href="layouts_and_rendering.html">Diseños y Renderizado en Rails</a></dd>
                  <dd><a href="form_helpers.html">Ayudantes de Formulario de Action</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controladores</dt>
                  <dd><a href="action_controller_overview.html">Descripción General de Action Controller</a></dd>
                  <dd><a href="routing.html">Rails Routing Desde el Exterior Hacia Adentro</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Otros Componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Extensiones de Núcleo de Active Support</a></dd>
                  <dd><a href="action_mailer_basics.html">Conceptos Básicos de Action Mailer</a></dd>
                  <dd><a href="active_job_basics.html">Conceptos Básicos de Active Job</a></dd>
                  <dd><a href="active_storage_overview.html">Descripción General de Active Storage</a></dd>
                  <dd><a href="action_cable_overview.html">Descripción General de Action Cable</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Temas Avanzados</dt>
                  <dd><a href="i18n.html">Rails API de Internacionalización (I18n)</a></dd>
                  <dd><a href="testing.html">Prueba de Aplicaciones de Rails</a></dd>
                  <dd><a href="security.html">Seguridad de Aplicaciones Rails</a></dd>
                  <dd><a href="debugging_rails_applications.html">Depuración de Applications Rails</a></dd>
                  <dd><a href="configuring.html">Configuración de Aplicaciones de Rails</a></dd>
                  <dd><a href="command_line.html">La Línea de Comandos de Rails</a></dd>
                  <dd><a href="asset_pipeline.html">La Canalización de Activos</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Constantes de Autocarga y Recarga (Zeitwerk Mode)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Constantes de Autocarga y Recarga (modo clásico)</a></dd>
                  <dd><a href="caching_with_rails.html">Almacenamiento en Caché con Rails Descripción General</a></dd>
                  <dd><a href="api_app.html">Uso de Rails para Aplicaciones Solo API</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Extending Rails  (toda la sección necesita traducción)</dt>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribuir</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guides Index</option>
              <optgroup label="Empieza Aqui">
                  <option value="getting_started.html">Introducción a Rails</option>
              </optgroup>
              <optgroup label="Modelos">
                  <option value="active_record_basics.html">Conceptos básicos de Active Record</option>
                  <option value="active_record_migrations.html">Migraciones de Active Record</option>
                  <option value="active_record_validations.html">Validaciones de Active Record</option>
                  <option value="active_record_callbacks.html">Devolución (callbacks) de Llamadas de Active Record</option>
                  <option value="association_basics.html">Asociaciones de Active Record</option>
                  <option value="active_record_querying.html">Interfaz de Consulta de Active Record</option>
              </optgroup>
              <optgroup label="Vistas">
                  <option value="layouts_and_rendering.html">Diseños y Renderizado en Rails</option>
                  <option value="form_helpers.html">Ayudantes de Formulario de Action</option>
              </optgroup>
              <optgroup label="Controladores">
                  <option value="action_controller_overview.html">Descripción General de Action Controller</option>
                  <option value="routing.html">Rails Routing Desde el Exterior Hacia Adentro</option>
              </optgroup>
              <optgroup label="Otros Componentes">
                  <option value="active_support_core_extensions.html">Extensiones de Núcleo de Active Support</option>
                  <option value="action_mailer_basics.html">Conceptos Básicos de Action Mailer</option>
                  <option value="active_job_basics.html">Conceptos Básicos de Active Job</option>
                  <option value="active_storage_overview.html">Descripción General de Active Storage</option>
                  <option value="action_cable_overview.html">Descripción General de Action Cable</option>
              </optgroup>
              <optgroup label="Temas Avanzados">
                  <option value="i18n.html">Rails API de Internacionalización (I18n)</option>
                  <option value="testing.html">Prueba de Aplicaciones de Rails</option>
                  <option value="security.html">Seguridad de Aplicaciones Rails</option>
                  <option value="debugging_rails_applications.html">Depuración de Applications Rails</option>
                  <option value="configuring.html">Configuración de Aplicaciones de Rails</option>
                  <option value="command_line.html">La Línea de Comandos de Rails</option>
                  <option value="asset_pipeline.html">La Canalización de Activos</option>
                  <option value="autoloading_and_reloading_constants.html">Constantes de Autocarga y Recarga (Zeitwerk Mode)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Constantes de Autocarga y Recarga (modo clásico)</option>
                  <option value="caching_with_rails.html">Almacenamiento en Caché con Rails Descripción General</option>
                  <option value="api_app.html">Uso de Rails para Aplicaciones Solo API</option>
              </optgroup>
              <optgroup label="Extending Rails  (toda la sección necesita traducción)">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <p><strong>NO LEA ESTE ARCHIVO EN GITHUB, LAS GUÍAS SE PUBLICAN EN <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p><h2>Conceptos Básicos de Action Mailer</h2><p>Esta guía le proporciona todo lo que necesita para comenzar a enviar
correos electrónicos desde y hacia su aplicación, y muchos aspectos internos de Action
Remitente. También cubre cómo probar sus anuncios publicitarios.</p><p>Después de leer esta guía, sabrá:</p>
<ul>
<li>Cómo enviar correo electrónico dentro de una aplicación Rails.</li>
<li>Cómo generar y editar una clase de Action Mailer y una vista de mailer.</li>
<li>Cómo configurar Action Mailer para su entorno.</li>
<li>Cómo probar tus clases de Action Mailer.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#what-is-action-mailer-questionmark">What is Action Mailer?</a></li>
<li>
<a href="#sending-emails">Sending Emails</a>

<ul>
<li><a href="#walkthrough-to-generating-a-mailer">Walkthrough to Generating a Mailer</a></li>
<li><a href="#auto-encoding-header-values">Auto encoding header values</a></li>
<li><a href="#complete-list-of-action-mailer-methods">Complete List of Action Mailer Methods</a></li>
<li><a href="#mailer-views">Mailer Views</a></li>
<li><a href="#action-mailer-layouts">Action Mailer Layouts</a></li>
<li><a href="#previewing-emails">Previewing Emails</a></li>
<li><a href="#generating-urls-in-action-mailer-views">Generating URLs in Action Mailer Views</a></li>
<li><a href="#adding-images-in-action-mailer-views">Adding images in Action Mailer Views</a></li>
<li><a href="#sending-multipart-emails">Sending Multipart Emails</a></li>
<li><a href="#sending-emails-with-dynamic-delivery-options">Sending Emails with Dynamic Delivery Options</a></li>
<li><a href="#sending-emails-sending-emails-without-template-rendering">Sending Emails without Template Rendering</a></li>
<li><a href="#sending-emails-sending-emails-without-template-rendering">Sending Emails without Template Rendering</a></li>
</ul>
</li>
<li><a href="#action-mailer-callbacks">Action Mailer Callbacks</a></li>
<li><a href="#using-action-mailer-helpers">Using Action Mailer Helpers</a></li>
<li>
<a href="#action-mailer-configuration">Action Mailer Configuration</a>

<ul>
<li><a href="#example-action-mailer-configuration">Example Action Mailer Configuration</a></li>
<li><a href="#action-mailer-configuration-for-gmail">Action Mailer Configuration for Gmail</a></li>
</ul>
</li>
<li><a href="#mailer-testing">Mailer Testing</a></li>
<li>
<a href="#intercepting-and-observing-emails">Intercepting and Observing Emails</a>

<ul>
<li><a href="#intercepting-emails">Intercepting Emails</a></li>
<li><a href="#observing-emails">Observing Emails</a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="what-is-action-mailer-questionmark"><a class="anchorlink" href="#what-is-action-mailer-questionmark">1 What is Action Mailer?</a></h3><p>Action Mailer le permite enviar correos electrónicos desde su aplicación utilizando clases de correo
y vistas.</p><h5 id="mailers-are-similar-to-controllers"><a class="anchorlink" href="#mailers-are-similar-to-controllers">1.1 Mailers are similar to controllers</a></h5><p>Heredan de <code>ActionMailer::Base</code> y viven en <code>app/mailers</code>. Los mailers también funcionan
de manera muy similar a los controladores. A continuación se enumeran algunos ejemplos de similitudes.
Los correos tienen:</p>
<ul>
<li>Acciones, y también, vistas asociadas que aparecen en <code>app/views</code>.</li>
<li>Variables de instancia a las que se puede acceder en vistas.</li>
<li>La capacidad de utilizar diseños y parciales.</li>
<li>La capacidad de acceder a un hash de parámetros.</li>
</ul>
<h3 id="sending-emails"><a class="anchorlink" href="#sending-emails">2 Sending Emails</a></h3><p>Esta sección proporcionará una guía paso a paso para crear un envío de correo y su
puntos de vista.</p><h4 id="walkthrough-to-generating-a-mailer"><a class="anchorlink" href="#walkthrough-to-generating-a-mailer">2.1 Walkthrough to Generating a Mailer</a></h4><h5 id="create-the-mailer"><a class="anchorlink" href="#create-the-mailer">2.1.1 Create the Mailer</a></h5><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate mailer UserMailer
<span class="go">create  app/mailers/user_mailer.rb
create  app/mailers/application_mailer.rb
invoke  erb
create    app/views/user_mailer
create    app/views/layouts/mailer.text.erb
create    app/views/layouts/mailer.html.erb
invoke  test_unit
create    test/mailers/user_mailer_test.rb
create    test/mailers/previews/user_mailer_preview.rb
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate mailer UserMailer
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># app/mailers/application_mailer.rb</span>
<span class="k">class</span> <span class="nc">ApplicationMailer</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s2">"from@example.com"</span>
  <span class="n">layout</span> <span class="s1">'mailer'</span>
<span class="k">end</span>

<span class="c1"># app/mailers/user_mailer.rb</span>
<span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# app/mailers/application_mailer.rb
class ApplicationMailer &lt; ActionMailer::Base
  default from: &quot;from@example.com&quot;
  layout 'mailer'
end

# app/mailers/user_mailer.rb
class UserMailer &lt; ApplicationMailer
end
">Copy</button>
</div>
<p>Como puede ver, puede generar anuncios publicitarios del mismo modo que usa otros generadores con
Rieles.</p><p>Si no desea utilizar un generador, puede crear su propio archivo dentro de
<code>app/mailers</code>, solo asegúrate de que herede de <code>ActionMailer::Base</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MyMailer</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MyMailer &lt; ActionMailer::Base
end
">Copy</button>
</div>
<h5 id="edit-the-mailer"><a class="anchorlink" href="#edit-the-mailer">2.1.2 Edit the Mailer</a></h5><p>Los remitentes de correo tienen métodos llamados "acciones" y utilizan vistas para estructurar su contenido.
Donde un controlador genera contenido como HTML para enviar de vuelta al cliente, un Mailer
crea un mensaje que se enviará por correo electrónico.</p><p><code>app/mailers/user_mailer.rb</code> contiene un mailer vacío:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailer &lt; ApplicationMailer
end
">Copy</button>
</div>
<p>Agreguemos un método llamado <code>welcome_email</code>, que enviará un correo electrónico al usuario
Dirección de correo electrónico registrado:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s1">'notifications@example.com'</span>

  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="s1">'http://example.com/login'</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span> <span class="ss">subject: </span><span class="s1">'Welcome to My Awesome Site'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailer &lt; ApplicationMailer
  default from: 'notifications@example.com'

  def welcome_email
    @user = params[:user]
    @url  = 'http://example.com/login'
    mail(to: @user.email, subject: 'Welcome to My Awesome Site')
  end
end
">Copy</button>
</div>
<p>A continuación se ofrece una explicación rápida de los elementos presentados en el método anterior. En
una lista completa de todas las opciones disponibles, eche un vistazo más abajo en la
lista completa de la sección de atributos configurables por el usuario de Action Mailer.</p>
<ul>
<li>
<code>default Hast</code>: este es un hash de valores predeterminados para cualquier correo electrónico que envíe desde
este anuncio publicitario. En este caso, estamos configurando el encabezado <code>:from</code> a un valor para todos
mensajes en esta clase. Esto se puede anular por correo electrónico.</li>
<li>
<code>mail</code> - El mensaje de correo electrónico real, estamos pasando el <code>:to</code> y <code>:subject</code>
encabezados en.</li>
</ul>
<h5 id="create-a-mailer-view"><a class="anchorlink" href="#create-a-mailer-view">2.1.3 Create a Mailer View</a></h5><p>Crea un archivo llamado <code>welcome_email.html.erb</code> en <code>app/views/user_mailer/</code>. Este
será la plantilla utilizada para el correo electrónico, formateada en HTML:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">'text/html; charset=UTF-8'</span> <span class="na">http-equiv=</span><span class="s">'Content-Type'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Welcome to example.com, <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      You have successfully signed up to example.com,
      your username is: <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">login</span> <span class="cp">%&gt;</span>.<span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      To login to the site, just follow this link: <span class="cp">&lt;%=</span> <span class="vi">@url</span> <span class="cp">%&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Thanks for joining and have a great day!<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta content='text/html; charset=UTF-8' http-equiv='Content-Type' /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to example.com, &lt;%= @user.name %&gt;&lt;/h1&gt;
    &lt;p&gt;
      You have successfully signed up to example.com,
      your username is: &lt;%= @user.login %&gt;.&lt;br&gt;
    &lt;/p&gt;
    &lt;p&gt;
      To login to the site, just follow this link: &lt;%= @url %&gt;.
    &lt;/p&gt;
    &lt;p&gt;Thanks for joining and have a great day!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
">Copy</button>
</div>
<p>También hagamos una parte de texto para este correo electrónico. No todos los clientes prefieren los correos electrónicos HTML,
por lo que enviar ambos es una buena práctica. Para hacer esto, cree un archivo llamado
<code>welcome_email.text.erb</code> en <code>app/views/user_mailer/</code>:</p><div class="code_container">
<pre><code class="highlight erb">Welcome to example.com, <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
===============================================

You have successfully signed up to example.com,
your username is: <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">login</span> <span class="cp">%&gt;</span>.

To login to the site, just follow this link: <span class="cp">&lt;%=</span> <span class="vi">@url</span> <span class="cp">%&gt;</span>.

Thanks for joining and have a great day!
</code></pre>
<button class="clipboard-button" data-clipboard-text="Welcome to example.com, &lt;%= @user.name %&gt;
===============================================

You have successfully signed up to example.com,
your username is: &lt;%= @user.login %&gt;.

To login to the site, just follow this link: &lt;%= @url %&gt;.

Thanks for joining and have a great day!
">Copy</button>
</div>
<p>Cuando llame al método <code>mail</code> ahora, Action Mailer detectará las dos plantillas
(texto y HTML) y generara automáticamente un correo electrónico <code>multipart/alternative</code>.</p><h5 id="calling-the-mailer"><a class="anchorlink" href="#calling-the-mailer">2.1.4 Calling the Mailer</a></h5><p>Los anuncios de correo son realmente otra forma de representar una vista. En lugar de representar una
vista y enviarlo a través del protocolo HTTP, simplemente lo están enviando a través de
los protocolos de correo electrónico. Debido a esto, tiene sentido que su
controlador le diga al Mailer que envíe un correo electrónico cuando se cree un usuario con éxito.</p><p>Configurar esto es simple.</p><p>Primero, creemos un andamio simple de <code>User</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate scaffold user name email login
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate scaffold user name email login
bin/rails db:migrate
">Copy</button>
</div>
<p>Ahora que tenemos un modelo de usuario para jugar, simplemente editaremos el
<code>app/controllers/users_controller.rb</code> hace que indique al <code>UserMailer</code> que entregue
un correo electrónico al usuario recién creado editando la acción de creación e insertando un
llamar a <code>UserMailer.with(user:@user).welcome_email</code> justo después de que el usuario se haya guardado correctamente.</p><p>Action Mailer está muy bien integrado con Active Job para que se pueda enviar correos electrónicos al exterior
del ciclo de solicitud-respuesta, por lo que el usuario no tiene que esperarlo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># POST /users</span>
  <span class="c1"># POST /users.json</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">])</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">save</span>
        <span class="c1"># Tell the UserMailer to send a welcome email after save</span>
        <span class="no">UserMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">user: </span><span class="vi">@user</span><span class="p">).</span><span class="nf">welcome_email</span><span class="p">.</span><span class="nf">deliver_later</span>

        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'User was successfully created.'</span><span class="p">)</span> <span class="p">}</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@user</span><span class="p">,</span> <span class="ss">status: :created</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@user</span> <span class="p">}</span>
      <span class="k">else</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">action: </span><span class="s1">'new'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">errors</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UsersController &lt; ApplicationController
  # POST /users
  # POST /users.json
  def create
    @user = User.new(params[:user])

    respond_to do |format|
      if @user.save
        # Tell the UserMailer to send a welcome email after save
        UserMailer.with(user: @user).welcome_email.deliver_later

        format.html { redirect_to(@user, notice: 'User was successfully created.') }
        format.json { render json: @user, status: :created, location: @user }
      else
        format.html { render action: 'new' }
        format.json { render json: @user.errors, status: :unprocessable_entity }
      end
    end
  end
end
">Copy</button>
</div>
<div class="note"><p>El comportamiento predeterminado de Active Job es ejecutar trabajos a través del adaptador <code>:async</code>. Entonces, puedes usar
<code>deliver_later</code> ahora para enviar correos electrónicos de forma asincrónica.
El adaptador predeterminado de Active Job ejecuta trabajos con un grupo de subprocesos en proceso.
Es adecuado para los entornos de desarrollo/prueba, ya que no requiere
cualquier infraestructura externa, pero no se ajusta bien a la producción, ya que cae
trabajos pendientes al reiniciar.
Si necesita un backend persistente, deberá usar un adaptador de Active Job
que tiene un backend persistente (Sidekiq, Resque, etc.).</p></div><div class="note"><p>Al llamar a <code>deliver_later</code>, el trabajo se colocará en la cola de <code>mailers</code>. Asegúrese de que el adaptador de trabajo activo lo admita, de lo contrario, el trabajo puede ignorarse silenciosamente y evitar la entrega de correo electrónico. Puede cambiar eso especificando la opción <code>config.action_mailer.deliver_later_queue_name</code>.</p></div><p>Si desea enviar correos electrónicos de inmediato (desde un cronjob, por ejemplo) simplemente llame
<code>deliver_now</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">SendWeeklySummary</span>
  <span class="k">def</span> <span class="nf">run</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
      <span class="no">UserMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">user: </span><span class="n">user</span><span class="p">).</span><span class="nf">weekly_summary</span><span class="p">.</span><span class="nf">deliver_now</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class SendWeeklySummary
  def run
    User.find_each do |user|
      UserMailer.with(user: user).weekly_summary.deliver_now
    end
  end
end
">Copy</button>
</div>
<p>Cualquier par de clave-valor que se pase a <code>with</code> se convierte en el <code>params</code> del envío de correo
acción. Entonces, <code>with(user:@user,account:@user.account)</code> hace <code>params[:user]</code> y
<code>params[:account]</code> disponible en la acción de correo. Al igual que los controladores
params.</p><p>El método <code>welcome_email</code> devuelve un objeto <code>ActionMailer::MessageDelivery</code> que
entonces simplemente se le puede decir a <code>deliver_now</code> o <code>deliver_later</code> que se envíe a sí mismo.
El objeto <code>ActionMailer::MessageDelivery</code> es solo un envoltorio alrededor de un <code>Mail::Message</code>. Si
desea inspeccionar, alterar o hacer cualquier otra cosa con el objeto <code>Mail::Message</code> que puede
acceda a él con el método <code>message</code> en el objeto <code>ActionMailer::MessageDelivery</code>.</p><h4 id="auto-encoding-header-values"><a class="anchorlink" href="#auto-encoding-header-values">2.2 Auto encoding header values</a></h4><p>Action Mailer maneja la codificación automática de caracteres multibyte dentro de
encabezados y cuerpos.</p><p>Para ejemplos más complejos, como definir conjuntos de caracteres alternativos o
texto de autocodificación primero, consulte la biblioteca
<a href="https://github.com/mikel/mail">Mail</a>.</p><h4 id="complete-list-of-action-mailer-methods"><a class="anchorlink" href="#complete-list-of-action-mailer-methods">2.3 Complete List of Action Mailer Methods</a></h4><p>Solo hay tres métodos que necesita para enviar prácticamente cualquier correo electrónico
mensaje:</p>
<ul>
<li>
<code>headers</code>: especifica cualquier encabezado del correo electrónico que desee. Puedes pasar un hash de
nombres de campo de encabezado y pares de valores, o puede llamar <code>headers[:field_name] =
'value'</code>.</li>
<li>
<code>attachments</code>: le permite agregar archivos adjuntos a su correo electrónico. Por ejemplo,
<code>attachments['file-name.jpg'] = File.read('file-name.jpg')</code>.</li>
<li>
<code>mail</code>: envía el correo electrónico real. Puede pasar encabezados como hash a
el método de correo como parámetro, el correo creará un correo electrónico, ya sea sin formato
texto, o multiparte, según las plantillas de correo electrónico que haya definido.</li>
</ul>
<h5 id="adding-attachments"><a class="anchorlink" href="#adding-attachments">2.3.1 Adding Attachments</a></h5><p>Action Mailer hace que sea muy fácil agregar archivos adjuntos.</p>
<ul>
<li>
<p>Pase el nombre y el contenido del archivo y Action Mailer y la
<a href="https://github.com/mikel/mail">Mail gem</a> adivinará automáticamente el
mime_type, establezca la codificación y cree el archivo adjunto.</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="n">attachments</span><span class="p">[</span><span class="s1">'filename.jpg'</span><span class="p">]</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/path/to/filename.jpg'</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="attachments['filename.jpg'] = File.read('/path/to/filename.jpg')
">Copy</button>
</div>
<p>Cuando se active el método <code>mail</code>, enviará un correo electrónico de varias partes con
un archivo adjunto, correctamente anidado con el nivel superior siendo <code>multipart/mixed</code> y
la primera parte es una <code>multipart/alternative</code> que contiene el texto plano y
Mensajes de correo electrónico HTML.</p>
</li>
</ul>
<div class="note"><p>Mail codificará automáticamente un archivo adjunto en Base64. Si quieres algo
diferente, codifique su contenido y pase el contenido codificado y la codificación en un
<code>Hash</code> al método <code>attachments</code>.</p></div>
<ul>
<li>
<p>Pase el nombre del archivo y especifique los encabezados y el contenido y Action Mailer y Mail
utilizará la configuración que ingrese.</p>
<div class="code_container">
<pre><code class="highlight ruby">  <span class="n">encoded_content</span> <span class="o">=</span> <span class="no">SpecialEncode</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/path/to/filename.jpg'</span><span class="p">))</span>
  <span class="n">attachments</span><span class="p">[</span><span class="s1">'filename.jpg'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">mime_type: </span><span class="s1">'application/gzip'</span><span class="p">,</span>
    <span class="ss">encoding: </span><span class="s1">'SpecialEncoding'</span><span class="p">,</span>
    <span class="ss">content: </span><span class="n">encoded_content</span>
  <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="  encoded_content = SpecialEncode(File.read('/path/to/filename.jpg'))
  attachments['filename.jpg'] = {
    mime_type: 'application/gzip',
    encoding: 'SpecialEncoding',
    content: encoded_content
  }
">Copy</button>
</div>
<div class="note"><p>Si especifica una codificación, Mail asumirá que su contenido ya está
codificado y no intentara codificarlo en Base64.</p></div>
</li>
</ul>
<h5 id="making-inline-attachments"><a class="anchorlink" href="#making-inline-attachments">2.3.2 Making Inline Attachments</a></h5><p>Action Mailer 3.0 crea archivos adjuntos en línea, que implicaron una gran cantidad de piratería en las versiones anteriores a 3.0, mucho más simples y triviales como deberían ser.</p>
<ul>
<li>
<p>Primero, para decirle a Mail que convierta un adjunto en un adjunto en línea, simplemente llame a <code>#inline</code> en el método de adjuntos dentro de su Mailer:</p>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">welcome</span>
  <span class="n">attachments</span><span class="p">.</span><span class="nf">inline</span><span class="p">[</span><span class="s1">'image.jpg'</span><span class="p">]</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'/path/to/image.jpg'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def welcome
  attachments.inline['image.jpg'] = File.read('/path/to/image.jpg')
end
">Copy</button>
</div>

<ul>
<li>Luego, en su opinión, puede hacer referencia a <code>attachments</code> como un hash y especificar
qué archivo adjunto desea mostrar, llamando a <code>url</code> y luego pasando el
resultado en el método <code>image_tag</code>:</li>
</ul>
<div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>Hello there, this is our image<span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">attachments</span><span class="p">[</span><span class="s1">'image.jpg'</span><span class="p">].</span><span class="nf">url</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;p&gt;Hello there, this is our image&lt;/p&gt;

&lt;%= image_tag attachments['image.jpg'].url %&gt;
">Copy</button>
</div>

<ul>
<li>Como esta es una llamada estándar a <code>image_tag</code>, puedes pasar un hash de opciones
después de la URL del archivo adjunto como podría hacerlo con cualquier otra imagen:</li>
</ul>
<div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>Hello there, this is our image<span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">attachments</span><span class="p">[</span><span class="s1">'image.jpg'</span><span class="p">].</span><span class="nf">url</span><span class="p">,</span> <span class="ss">alt: </span><span class="s1">'My Photo'</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'photos'</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;p&gt;Hello there, this is our image&lt;/p&gt;

&lt;%= image_tag attachments['image.jpg'].url, alt: 'My Photo', class: 'photos' %&gt;
">Copy</button>
</div>
</li>
</ul>
<h5 id="sending-email-to-multiple-recipients"><a class="anchorlink" href="#sending-email-to-multiple-recipients">2.3.3 Sending Email To Multiple Recipients</a></h5><p>Es posible enviar un correo electrónico a uno o a más destinatarios en un correo electrónico (por ejemplo,
informando a todos los administradores de un nuevo registro) configurando la lista de correos electrónicos en el <code>:to</code>
llave. La lista de correos electrónicos puede ser una serie de direcciones de correo electrónico o una sola cadena
con las direcciones separadas por comas.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">AdminMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">to: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Admin</span><span class="p">.</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">},</span>
          <span class="ss">from: </span><span class="s1">'notification@example.com'</span>

  <span class="k">def</span> <span class="nf">new_registration</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">subject: </span><span class="s2">"New User Signup: </span><span class="si">#{</span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class AdminMailer &lt; ApplicationMailer
  default to: -&gt; { Admin.pluck(:email) },
          from: 'notification@example.com'

  def new_registration(user)
    @user = user
    mail(subject: &quot;New User Signup: #{@user.email}&quot;)
  end
end
">Copy</button>
</div>
<p>Se puede utilizar el mismo formato para configurar copia carbón (Cc :) y copia carbón oculta
(Cco :), utilizando las teclas <code>:cc</code> y <code>:bcc</code> respectivamente.</p><h5 id="sending-email-with-name"><a class="anchorlink" href="#sending-email-with-name">2.3.4 Sending Email With Name</a></h5><p>A veces desea mostrar el nombre de la persona en lugar de solo su correo electrónico
dirección cuando reciben el correo electrónico. Puede utilizar <code>email_address_with_name</code> para
ese:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">welcome_email</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
  <span class="n">mail</span><span class="p">(</span>
    <span class="ss">to: </span><span class="n">email_address_with_name</span><span class="p">(</span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">name</span><span class="p">),</span>
    <span class="ss">subject: </span><span class="s1">'Welcome to My Awesome Site'</span>
  <span class="p">)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def welcome_email
  @user = params[:user]
  mail(
    to: email_address_with_name(@user.email, @user.name),
    subject: 'Welcome to My Awesome Site'
  )
end
">Copy</button>
</div>
<h4 id="mailer-views"><a class="anchorlink" href="#mailer-views">2.4 Mailer Views</a></h4><p>Las vistas de correo se encuentran en el directorio <code>app/views/name_of_mailer_class</code>.
Las vista de correo específica es conocida por la clase porque su nombre es el mismo que el
método de correo. En nuestro ejemplo anterior, nuestra vista de correo para el
El método <code>welcome_email</code> estará en <code>app/views/user_mailer/welcome_email.html.erb</code>
para la versión HTML y <code>welcome_email.text.erb</code> para la versión de texto sin formato.</p><p>Para cambiar la vista de correo predeterminada para su acción, haga algo como:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s1">'notifications@example.com'</span>

  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="s1">'http://example.com/login'</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s1">'Welcome to My Awesome Site'</span><span class="p">,</span>
         <span class="ss">template_path: </span><span class="s1">'notifications'</span><span class="p">,</span>
         <span class="ss">template_name: </span><span class="s1">'another'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailer &lt; ApplicationMailer
  default from: 'notifications@example.com'

  def welcome_email
    @user = params[:user]
    @url  = 'http://example.com/login'
    mail(to: @user.email,
         subject: 'Welcome to My Awesome Site',
         template_path: 'notifications',
         template_name: 'another')
  end
end
">Copy</button>
</div>
<p>En este caso, buscará plantillas en <code>app/views/Notifications</code> con nombre
<code>another</code>. También se puede especificar una matriz de rutas para <code>template_path</code>, y
se buscará en orden.</p><p>Si desea más flexibilidad, también puede pasar un bloque y renderizar específicos
plantillas o incluso renderizar en línea o texto sin usar un archivo de plantilla:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">default</span> <span class="ss">from: </span><span class="s1">'notifications@example.com'</span>

  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="s1">'http://example.com/login'</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s1">'Welcome to My Awesome Site'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="s1">'another_template'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">text</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">plain: </span><span class="s1">'Render text'</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailer &lt; ApplicationMailer
  default from: 'notifications@example.com'

  def welcome_email
    @user = params[:user]
    @url  = 'http://example.com/login'
    mail(to: @user.email,
         subject: 'Welcome to My Awesome Site') do |format|
      format.html { render 'another_template' }
      format.text { render plain: 'Render text' }
    end
  end
end
">Copy</button>
</div>
<p>Esto representará la plantilla 'another_template.html.erb' para la parte HTML y
utilice el texto renderizado para la parte de texto. El comando de renderizado es el mismo que se usa
dentro de Action Controller, por lo que puede usar las mismas opciones, como
<code>:text</code>,<code>:inline</code> etc.</p><p>Si deseas renderizar una plantilla ubicada fuera del directorio predeterminado <code>app/views/mailer_name/</code>, puedes aplicar el <code>prepend_view_path</code>, así:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">prepend_view_path</span> <span class="s2">"custom/path/to/mailer/view"</span>

  <span class="c1"># This will try to load "custom/path/to/mailer/view/welcome_email" template</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class UserMailer &lt; ApplicationMailer
  prepend_view_path "custom/path/to/mailer/view"

  # This will try to load "custom/path/to/mailer/view/welcome_email" template
  def welcome_email
    # ...
  end
end
'>Copy</button>
</div>
<p>También puede considerar usar el método <a href="https://guides.rubyonrails.org/action_view_overview.html#view-paths">append_view_path</a>.</p><h5 id="caching-mailer-view"><a class="anchorlink" href="#caching-mailer-view">2.4.1 Caching mailer view</a></h5><p>Puede realizar el almacenamiento en caché de fragmentos en vistas de correo como en vistas de aplicaciones utilizando el método <code>cache</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">cache</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@company</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% cache do %&gt;
  &lt;%= @company.name %&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>Y para utilizar esta función, debe configurar su aplicación con esto:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">perform_caching</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="config.action_mailer.perform_caching = true
">Copy</button>
</div>
<p>El almacenamiento en caché de fragmentos también se admite en correos electrónicos de varias partes.
Obtenga más información sobre el almacenamiento en caché en <a href="caching_with_rails.html">Rails caching guide</a>.</p><h4 id="action-mailer-layouts"><a class="anchorlink" href="#action-mailer-layouts">2.5 Action Mailer Layouts</a></h4><p>Al igual que las vistas de controlador, también puede tener diseños de correo. El nombre del diseño
debe ser el mismo que su correo, como <code>user_mailer.html.erb</code> y
<code>user_mailer.text.erb</code> para que su gestor de correo lo reconozca automáticamente como
diseño.</p><p>Para usar un archivo diferente, llame a <code>layout</code> en su mailer:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">layout</span> <span class="s1">'awesome'</span> <span class="c1"># use awesome.(html|text).erb as the layout</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailer &lt; ApplicationMailer
  layout 'awesome' # use awesome.(html|text).erb as the layout
end
">Copy</button>
</div>
<p>Al igual que con las vistas del controlador, use <code>yield</code> para representar la vista dentro del
diseño.</p><p>También puede pasar una opción <code>layout: 'layout_name'</code> a la llamada de renderización dentro
el bloque de formato para especificar diferentes diseños para diferentes formatos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">].</span><span class="nf">email</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">layout: </span><span class="s1">'my_layout'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">text</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailer &lt; ApplicationMailer
  def welcome_email
    mail(to: params[:user].email) do |format|
      format.html { render layout: 'my_layout' }
      format.text
    end
  end
end
">Copy</button>
</div>
<p>Representará la parte HTML usando el archivo <code>my_layout.html.erb</code> y la parte de texto
con el archivo <code>user_mailer.text.erb</code> habitual si existe.</p><h4 id="previewing-emails"><a class="anchorlink" href="#previewing-emails">2.6 Previewing Emails</a></h4><p>Las vistas previas de Action Mailer proporcionan una manera de ver cómo se ven los correos electrónicos visitando un
URL especial que los muestra. En el ejemplo anterior, la clase de vista previa para
<code>UserMailer</code> debe llamarse <code>UserMailerPreview</code> y estar ubicado en
<code>test/mailers/previews/user_mailer_preview.rb</code>. Para ver la vista previa de
<code>welcome_email</code>, implemente un método que tenga el mismo nombre y llame
<code>UserMailer.welcome_email</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailerPreview</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Preview</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="no">UserMailer</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="ss">user: </span><span class="no">User</span><span class="p">.</span><span class="nf">first</span><span class="p">).</span><span class="nf">welcome_email</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class UserMailerPreview &lt; ActionMailer::Preview
  def welcome_email
    UserMailer.with(user: User.first).welcome_email
  end
end
">Copy</button>
</div>
<p>Entonces la vista previa estará disponible en <a href="http://localhost:3000/rails/mailers/user_mailer/welcome_email">http://localhost:3000/rails/mailers/user_mailer/welcome_email</a>.</p><p>Si cambia algo en <code>app/views/user_mailer/welcome_email.html.erb</code>
o el propio mailer, se recargará y renderizará automáticamente para que puedas
vea visualmente el nuevo estilo al instante. También hay disponible una lista de vistas previas
en <a href="http://localhost:3000/rails/mailers">http://localhost:3000/rails/mailers</a>.</p><p>De forma predeterminada, estas clases de vista previa se encuentran en <code>test/mailers/previews</code>.
Esto se puede configurar usando la opción <code>preview_path</code>. Por ejemplo, si tu
desea cambiarlo a <code>lib/mailer_previews</code>, puede configurarlo en
<code>config/application.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">preview_path</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/lib/mailer_previews"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='config.action_mailer.preview_path = "#{Rails.root}/lib/mailer_previews"
'>Copy</button>
</div>
<h4 id="generating-urls-in-action-mailer-views"><a class="anchorlink" href="#generating-urls-in-action-mailer-views">2.7 Generating URLs in Action Mailer Views</a></h4><p>A diferencia de los controladores, la instancia de correo no tiene ningún contexto sobre
la solicitud entrante, por lo que deberá proporcionar el parámetro <code>:host</code> usted mismo.</p><p>Como el <code>:host</code> suele ser coherente en toda la aplicación, puede configurarlo
globalmente en <code>config/application.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">host: </span><span class="s1">'example.com'</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="config.action_mailer.default_url_options = { host: 'example.com' }
">Copy</button>
</div>
<p>Debido a este comportamiento, no puede utilizar ninguno de los ayudantes <code>* _path</code> dentro de
un correo electrónico. En su lugar, necesitará usar el ayudante asociado <code>* _url</code>. Por ejemplo
En lugar de usar</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'welcome'</span><span class="p">,</span> <span class="n">welcome_path</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'welcome', welcome_path %&gt;
">Copy</button>
</div>
<p>Necesitarás usar:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'welcome'</span><span class="p">,</span> <span class="n">welcome_url</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'welcome', welcome_url %&gt;
">Copy</button>
</div>
<p>Al usar la URL completa, sus enlaces ahora funcionarán en sus correos electrónicos.</p><h5 id="generating-urls-with-url-for"><a class="anchorlink" href="#generating-urls-with-url-for">2.7.1 Generating URLs with <code>url_for</code></a></h5><p><code>url_for</code> genera una URL completa por defecto en las plantillas.</p><p>Si no configuró la opción <code>:host</code> globalmente, asegúrese de pasarla a
<code>url_for</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">url_for</span><span class="p">(</span><span class="ss">host: </span><span class="s1">'example.com'</span><span class="p">,</span>
            <span class="ss">controller: </span><span class="s1">'welcome'</span><span class="p">,</span>
            <span class="ss">action: </span><span class="s1">'greeting'</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= url_for(host: 'example.com',
            controller: 'welcome',
            action: 'greeting') %&gt;
">Copy</button>
</div>
<h5 id="generating-urls-with-named-routes"><a class="anchorlink" href="#generating-urls-with-named-routes">2.7.2 Generating URLs with Named Routes</a></h5><p>Los clientes de correo electrónico no tienen contexto web, por lo que las rutas no tienen una base URL para completar
la direcciones web. Por lo tanto, siempre debe usar la variante "_url" de la ruta nombrada ayudantes.</p><p>Si no configuró la opción <code>:host</code> globalmente, asegúrese de pasarla al
asistente de URL.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">user_url</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="ss">host: </span><span class="s1">'example.com'</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= user_url(@user, host: 'example.com') %&gt;
">Copy</button>
</div>
<div class="note"><p>los enlaces que no sean <code>GET</code> requieren <a href="https://github.com/rails/rails/blob/master/actionview/app/assets/javascripts">rails-ujs</a> o
<a href="https://github.com/rails/jquery-ujs">jQuery UJS</a> y no funcionará en plantillas de correo.
Ellas darán lugar a solicitudes normales <code>GET</code>.</p></div><h4 id="adding-images-in-action-mailer-views"><a class="anchorlink" href="#adding-images-in-action-mailer-views">2.8 Adding images in Action Mailer Views</a></h4><p>A diferencia de los controladores, la instancia de correo no tiene ningún contexto sobre el
solicitud entrante, por lo que deberá proporcionar el parámetro <code>:asset_host</code> usted mismo.</p><p>Como el <code>:asset_host</code> suele ser coherente en toda la aplicación, puede
configúrelo globalmente en <code>config/application.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">asset_host</span> <span class="o">=</span> <span class="s1">'http://example.com'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="config.action_mailer.asset_host = 'http://example.com'
">Copy</button>
</div>
<p>Ahora puede mostrar una imagen dentro de su correo electrónico.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="o">&lt;</span><span class="sx">%= image_tag 'image.jpg' %&gt;
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= image_tag 'image.jpg' %&gt;
">Copy</button>
</div>
<h4 id="sending-multipart-emails"><a class="anchorlink" href="#sending-multipart-emails">2.9 Sending Multipart Emails</a></h4><p>Action Mailer enviará automáticamente correos electrónicos de varias partes si tiene diferentes
plantillas para la misma acción. Entonces, para nuestro ejemplo de UserMailer, si tiene
<code>welcome_email.text.erb</code> y <code>welcome_email.html.erb</code> en
<code>app/views/user_mailer</code>, Action Mailer enviará automáticamente un correo electrónico de varias partes
con las versiones HTML y de texto configuradas como partes diferentes.</p><p>El orden de las piezas que se insertan está determinado por el <code>:parts_order</code>
dentro del método <code>ActionMailer::Base.default</code>.</p><h4 id="sending-emails-with-dynamic-delivery-options"><a class="anchorlink" href="#sending-emails-with-dynamic-delivery-options">2.10 Sending Emails with Dynamic Delivery Options</a></h4><p>Si desea anular las opciones de entrega predeterminadas (por ejemplo, credenciales SMTP)
mientras envía correos electrónicos, puede hacerlo usando <code>delivery_method_options</code> en el
acción de correo.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="n">user_url</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">delivery_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">user_name: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_user</span><span class="p">,</span>
                         <span class="ss">password: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_password</span><span class="p">,</span>
                         <span class="ss">address: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_host</span> <span class="p">}</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s2">"Please see the Terms and Conditions attached"</span><span class="p">,</span>
         <span class="ss">delivery_method_options: </span><span class="n">delivery_options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class UserMailer &lt; ApplicationMailer
  def welcome_email
    @user = params[:user]
    @url  = user_url(@user)
    delivery_options = { user_name: params[:company].smtp_user,
                         password: params[:company].smtp_password,
                         address: params[:company].smtp_host }
    mail(to: @user.email,
         subject: "Please see the Terms and Conditions attached",
         delivery_method_options: delivery_options)
  end
end
'>Copy</button>
</div>
<h4 id="sending-emails-sending-emails-without-template-rendering"><a class="anchorlink" href="#sending-emails-sending-emails-without-template-rendering">2.11 Sending Emails without Template Rendering</a></h4><p>Si desea anular las opciones de entrega predeterminadas (por ejemplo, credenciales SMTP)
mientras envía correos electrónicos, puede hacerlo usando <code>delivery_method_options</code> en la
acción de correo.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span>
    <span class="vi">@url</span>  <span class="o">=</span> <span class="n">user_url</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">delivery_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">user_name: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_user</span><span class="p">,</span>
                         <span class="ss">password: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_password</span><span class="p">,</span>
                         <span class="ss">address: </span><span class="n">params</span><span class="p">[</span><span class="ss">:company</span><span class="p">].</span><span class="nf">smtp_host</span> <span class="p">}</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s2">"Please see the Terms and Conditions attached"</span><span class="p">,</span>
         <span class="ss">delivery_method_options: </span><span class="n">delivery_options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class UserMailer &lt; ApplicationMailer
  def welcome_email
    @user = params[:user]
    @url  = user_url(@user)
    delivery_options = { user_name: params[:company].smtp_user,
                         password: params[:company].smtp_password,
                         address: params[:company].smtp_host }
    mail(to: @user.email,
         subject: "Please see the Terms and Conditions attached",
         delivery_method_options: delivery_options)
  end
end
'>Copy</button>
</div>
<h4 id="sending-emails-sending-emails-without-template-rendering"><a class="anchorlink" href="#sending-emails-sending-emails-without-template-rendering">2.12 Sending Emails without Template Rendering</a></h4><p>Puede haber casos en los que desee omitir el paso de representación de la plantilla y
proporcione el cuerpo del correo electrónico como una cadena. Puedes lograr esto usando el <code>:body</code>
opción. En tales casos, no olvide agregar la opción <code>:content_type</code>. Rieles
de lo contrario, estará predeterminado en <code>text/plain</code>.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="k">def</span> <span class="nf">welcome_email</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to: </span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">].</span><span class="nf">email</span><span class="p">,</span>
         <span class="ss">body: </span><span class="n">params</span><span class="p">[</span><span class="ss">:email_body</span><span class="p">],</span>
         <span class="ss">content_type: </span><span class="s2">"text/html"</span><span class="p">,</span>
         <span class="ss">subject: </span><span class="s2">"Already rendered!"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class UserMailer &lt; ApplicationMailer
  def welcome_email
    mail(to: params[:user].email,
         body: params[:email_body],
         content_type: "text/html",
         subject: "Already rendered!")
  end
end
'>Copy</button>
</div>
<h3 id="action-mailer-callbacks"><a class="anchorlink" href="#action-mailer-callbacks">3 Action Mailer Callbacks</a></h3><p>Action Mailer le permite especificar un <code>before_action</code>, <code>after_action</code> y
<code>around_action</code>.</p>
<ul>
<li><p>Los filtros se pueden especificar con un bloque o un símbolo a un método en la clase del
correo similar a los controladores.</p></li>
<li><p>Puede usar un <code>before_action</code> para completar el objeto de correo con valores predeterminados,
delivery_method_options o inserte encabezados y adjuntos predeterminados.</p></li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">InvitationsMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">before_action</span> <span class="p">{</span> <span class="vi">@inviter</span><span class="p">,</span> <span class="vi">@invitee</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:inviter</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="ss">:invitee</span><span class="p">]</span> <span class="p">}</span>
  <span class="n">before_action</span> <span class="p">{</span> <span class="vi">@account</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:inviter</span><span class="p">].</span><span class="nf">account</span> <span class="p">}</span>

  <span class="n">default</span> <span class="ss">to:       </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="vi">@invitee</span><span class="p">.</span><span class="nf">email_address</span> <span class="p">},</span>
          <span class="ss">from:     </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="n">common_address</span><span class="p">(</span><span class="vi">@inviter</span><span class="p">)</span> <span class="p">},</span>
          <span class="ss">reply_to: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="vi">@inviter</span><span class="p">.</span><span class="nf">email_address_with_name</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">account_invitation</span>
    <span class="n">mail</span> <span class="ss">subject: </span><span class="s2">"</span><span class="si">#{</span><span class="vi">@inviter</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> invited you to their Basecamp (</span><span class="si">#{</span><span class="vi">@account</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">)"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">project_invitation</span>
    <span class="vi">@project</span>    <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:project</span><span class="p">]</span>
    <span class="vi">@summarizer</span> <span class="o">=</span> <span class="no">ProjectInvitationSummarizer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@project</span><span class="p">.</span><span class="nf">bucket</span><span class="p">)</span>

    <span class="n">mail</span> <span class="ss">subject: </span><span class="s2">"</span><span class="si">#{</span><span class="vi">@inviter</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">familiar</span><span class="si">}</span><span class="s2"> added you to a project in Basecamp (</span><span class="si">#{</span><span class="vi">@account</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">)"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class InvitationsMailer &lt; ApplicationMailer
  before_action { @inviter, @invitee = params[:inviter], params[:invitee] }
  before_action { @account = params[:inviter].account }

  default to:       -&gt; { @invitee.email_address },
          from:     -&gt; { common_address(@inviter) },
          reply_to: -&gt; { @inviter.email_address_with_name }

  def account_invitation
    mail subject: "#{@inviter.name} invited you to their Basecamp (#{@account.name})"
  end

  def project_invitation
    @project    = params[:project]
    @summarizer = ProjectInvitationSummarizer.new(@project.bucket)

    mail subject: "#{@inviter.name.familiar} added you to a project in Basecamp (#{@account.name})"
  end
end
'>Copy</button>
</div>

<ul>
<li>Podrías usar un <code>after_action</code> para hacer una configuración similar a un <code>before_action</code> pero
se usan variables de instancia establecidas en su acción de correo.</li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="no">ApplicationMailer</span>
  <span class="n">before_action</span> <span class="p">{</span> <span class="vi">@business</span><span class="p">,</span> <span class="vi">@user</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:business</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span> <span class="p">}</span>

  <span class="n">after_action</span> <span class="ss">:set_delivery_options</span><span class="p">,</span>
               <span class="ss">:prevent_delivery_to_guests</span><span class="p">,</span>
               <span class="ss">:set_business_headers</span>

  <span class="k">def</span> <span class="nf">feedback_message</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">campaign_message</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">set_delivery_options</span>
      <span class="c1"># You have access to the mail instance,</span>
      <span class="c1"># @business and @user instance variables here</span>
      <span class="k">if</span> <span class="vi">@business</span> <span class="o">&amp;&amp;</span> <span class="vi">@business</span><span class="p">.</span><span class="nf">has_smtp_settings?</span>
        <span class="n">mail</span><span class="p">.</span><span class="nf">delivery_method</span><span class="p">.</span><span class="nf">settings</span><span class="p">.</span><span class="nf">merge!</span><span class="p">(</span><span class="vi">@business</span><span class="p">.</span><span class="nf">smtp_settings</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">prevent_delivery_to_guests</span>
      <span class="k">if</span> <span class="vi">@user</span> <span class="o">&amp;&amp;</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">guest?</span>
        <span class="n">mail</span><span class="p">.</span><span class="nf">perform_deliveries</span> <span class="o">=</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">set_business_headers</span>
      <span class="k">if</span> <span class="vi">@business</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">"X-SMTPAPI-CATEGORY"</span><span class="p">]</span> <span class="o">=</span> <span class="vi">@business</span><span class="p">.</span><span class="nf">code</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class UserMailer &lt; ApplicationMailer
  before_action { @business, @user = params[:business], params[:user] }

  after_action :set_delivery_options,
               :prevent_delivery_to_guests,
               :set_business_headers

  def feedback_message
  end

  def campaign_message
  end

  private

    def set_delivery_options
      # You have access to the mail instance,
      # @business and @user instance variables here
      if @business &amp;&amp; @business.has_smtp_settings?
        mail.delivery_method.settings.merge!(@business.smtp_settings)
      end
    end

    def prevent_delivery_to_guests
      if @user &amp;&amp; @user.guest?
        mail.perform_deliveries = false
      end
    end

    def set_business_headers
      if @business
        headers["X-SMTPAPI-CATEGORY"] = @business.code
      end
    end
end
'>Copy</button>
</div>

<ul>
<li>Los filtros de correo anulan el procesamiento posterior si el cuerpo se establece en un valor distinto de nulo.</li>
</ul>
<h3 id="using-action-mailer-helpers"><a class="anchorlink" href="#using-action-mailer-helpers">4 Using Action Mailer Helpers</a></h3><p>Action Mailer hereda de <code>AbstractController</code>, por lo que tiene acceso a la mayoría
de los mismos ayudantes que hay en  Action Controller.</p><p>También hay algunos métodos de ayuda específicos de Action Mailer disponibles en
<code>ActionMailer::MailHelper</code>. Por ejemplo, estos permiten acceder al correo
instancia desde su vista con <code>mailer</code>, y accediendo al mensaje como <code>message</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="n">mailer</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">underscore</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span><span class="p">.</span><span class="nf">subject</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= stylesheet_link_tag mailer.name.underscore %&gt;
&lt;h1&gt;&lt;%= message.subject %&gt;&lt;/h1&gt;
">Copy</button>
</div>
<h3 id="action-mailer-configuration"><a class="anchorlink" href="#action-mailer-configuration">5 Action Mailer Configuration</a></h3><p>Las siguientes opciones de configuración se realizan mejor en uno de los entornos
archivos (environment.rb, production.rb, etc ...)</p>
<table>
<thead>
<tr>
<th>configuración</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>logger</code></td>
<td>Genera información sobre el envío de correos, si está disponible. Se puede establecer en <code>nil</code> para no registrar. Compatible con los registradores <code>Logger</code> y <code>Log4r</code> de Ruby.</td>
</tr>
<tr>
<td><code>smtp_settings</code></td>
<td>Permite una configuración detallada para método de entrega: <code>:smtp</code> :<ul>
<li>
<code>:address</code> - Le permite utilizar un servidor de correo remoto. Solo cámbialo de su valor predeterminado <code>"localhost"</code>.</li>
<li>
<code>:port</code> - En caso de que su servidor de correo no se ejecute en el puerto 25, puede cambiarlo.</li>
<li>
<code>:domain</code> - Si necesita especificar un dominio HELO, puede hacerlo aquí.</li>
<li>
<code>:user_name</code> - Si su servidor de correo requiere autenticación, configure el nombre de usuario en esta configuración.</li>
<li>
<code>:password</code> - Si su servidor de correo requiere autenticación, configure la contraseña en esta configuración.</li>
<li>
<code>:authentication</code> - Si su servidor de correo requiere autenticación, debe especificar el tipo de autenticación aquí. Este es un símbolo y uno de <code>:plain</code> (enviará la contraseña en claro), <code>:login</code> (enviará la contraseña codificada en Base64) o <code>:cram_md5</code> (combina un mecanismo de desafío / respuesta para intercambiar información y un algoritmo criptográfico Message Digest 5 para codificar información importante)</li>
<li>
<code>:enable_starttls_auto</code> - Detecta si STARTTLS está habilitado en su servidor SMTP y comienza a usarlo. Predeterminado a <code>true</code>.</li>
<li>
<code>:openssl_verify_mode</code> - Al usar TLS, puede configurar cómo OpenSSL verifica el certificado. Esto es realmente útil si necesita validar un certificado autofirmado y / o comodín. Puede usar el nombre de una constante de verificación OpenSSL ('none' o 'peer') o directamente la constante (<code>OpenSSL::SSL::VERIFY_NONE</code> o <code>OpenSSL::SSL::VERIFY_PEER</code>).</li>
<li>
<code>:ssl/:tls</code> - Permite que la conexión SMTP utilice SMTP / TLS (SMTPS: SMTP sobre conexión TLS directa)</li>
</ul>
</td>
</tr>
<tr>
<td><code>sendmail_settings</code></td>
<td>Le permite anular opciones para el método de entrega:<code>:sendmail</code>.<ul>
<li>
<code>:location</code> - La ubicación del ejecutable de sendmail. Predeterminado a <code>/usr/sbin/sendmail</code>.</li>
<li>
<code>:arguments</code> - Los argumentos de la línea de comando que se pasarán a sendmail. Predeterminado a <code>-i</code>.</li>
</ul>
</td>
</tr>
<tr>
<td><code>raise_delivery_errors</code></td>
<td>Si se deben generar errores o no si el correo electrónico no se entrega. Esto solo funciona si el servidor de correo electrónico externo está configurado para entrega inmediata.</td>
</tr>
<tr>
<td><code>delivery_method</code></td>
<td>Define un método de entrega. Los valores posibles son:<ul>
<li>
<code>:smtp</code> (predeterminado), se puede configurar usando <code>config.action_mailer.smtp_settings</code>.</li>
<li>
<code>:sendmail</code>, se puede configurar usando <code>config.action_mailer.sendmail_settings</code>.</li>
<li>
<code>:file</code>: guardar correos electrónicos en archivos; se puede configurar usando <code>config.action_mailer.file_settings</code>.</li>
<li>
<code>:test</code>: guardar correos electrónicos para <code>ActionMailer::Base.deliveries</code> formación.</li>
</ul>Veer <a href="https://edgeapi.rubyonrails.org/classes/ActionMailer/Base.html">API docs</a> para más información.</td>
</tr>
<tr>
<td><code>perform_deliveries</code></td>
<td>Determina si las entregas se llevan a cabo realmente cuando se invoca el método <code>deliver</code> en el mensaje de correo. De forma predeterminada, lo son, pero esto se puede desactivar para ayudar a las pruebas funcionales. Si este valor es <code>false</code>, la matriz de <code>deliveries</code> no se completará incluso si <code>delivery_method</code> es <code>:test</code>.</td>
</tr>
<tr>
<td><code>deliveries</code></td>
<td>Mantiene una matriz de todos los correos electrónicos enviados a través de Action Mailer con delivery_method: test. Más útil para pruebas funcionales y unitarias.</td>
</tr>
<tr>
<td><code>default_options</code></td>
<td>Le permite establecer valores predeterminados para las opciones del método <code>mail</code> (<code>:from</code>, <code>:reply_to</code>, etc.).</td>
</tr>
</tbody>
</table>
<p>Para obtener una descripción completa de las posibles configuraciones, consulte el
<a href="configuring.html#configuring-action-mailer">Configuring Action Mailer</a> en
nuestra guía Configuración de aplicaciones de rieles.</p><h4 id="example-action-mailer-configuration"><a class="anchorlink" href="#example-action-mailer-configuration">5.1 Example Action Mailer Configuration</a></h4><p>Un ejemplo sería agregar lo siguiente a su expediente
<code>config/environments/$RAILS_ENV.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">delivery_method</span> <span class="o">=</span> <span class="ss">:sendmail</span>
<span class="c1"># Defaults to:</span>
<span class="c1"># config.action_mailer.sendmail_settings = {</span>
<span class="c1">#   location: '/usr/sbin/sendmail',</span>
<span class="c1">#   arguments: '-i'</span>
<span class="c1"># }</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">perform_deliveries</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">raise_delivery_errors</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="ss">from: </span><span class="s1">'no-reply@example.com'</span><span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="config.action_mailer.delivery_method = :sendmail
# Defaults to:
# config.action_mailer.sendmail_settings = {
#   location: '/usr/sbin/sendmail',
#   arguments: '-i'
# }
config.action_mailer.perform_deliveries = true
config.action_mailer.raise_delivery_errors = true
config.action_mailer.default_options = {from: 'no-reply@example.com'}
">Copy</button>
</div>
<h4 id="action-mailer-configuration-for-gmail"><a class="anchorlink" href="#action-mailer-configuration-for-gmail">5.2 Action Mailer Configuration for Gmail</a></h4><p>Como Action Mailer ahora usa la <a href="https://github.com/mikel/mail">Mail gem</a>, esto
se vuelve tan simple como agregar a su archivo <code>config/environment/$RAILS_ENV.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">delivery_method</span> <span class="o">=</span> <span class="ss">:smtp</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">smtp_settings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">address:              </span><span class="s1">'smtp.gmail.com'</span><span class="p">,</span>
  <span class="ss">port:                 </span><span class="mi">587</span><span class="p">,</span>
  <span class="ss">domain:               </span><span class="s1">'example.com'</span><span class="p">,</span>
  <span class="ss">user_name:            </span><span class="s1">'&lt;username&gt;'</span><span class="p">,</span>
  <span class="ss">password:             </span><span class="s1">'&lt;password&gt;'</span><span class="p">,</span>
  <span class="ss">authentication:       </span><span class="s1">'plain'</span><span class="p">,</span>
  <span class="ss">enable_starttls_auto: </span><span class="kp">true</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="config.action_mailer.delivery_method = :smtp
config.action_mailer.smtp_settings = {
  address:              'smtp.gmail.com',
  port:                 587,
  domain:               'example.com',
  user_name:            '&lt;username&gt;',
  password:             '&lt;password&gt;',
  authentication:       'plain',
  enable_starttls_auto: true }
">Copy</button>
</div>
<div class="note"><p>A partir del 15 de julio de 2014, Google aumentó <a href="https://support.google.com/accounts/answer/6010255">its security measures</a> y ahora bloquea los intentos de las aplicaciones que considera menos seguras.
Puedes cambiar tu configuración de Gmail <a href="https://www.google.com/settings/security/lesssecureapps">here</a> para permitir los intentos. Si su cuenta de Gmail tiene habilitada la autenticación de 2 factores,
entonces deberás establecer un <a href="https://myaccount.google.com/apppasswords">app password</a> y utilícelo en lugar de su contraseña habitual. Alternativamente, puede
utilice otro ESP para enviar un correo electrónico reemplazando "smtp.gmail.com" arriba con la dirección de su proveedor.</p></div><h3 id="mailer-testing"><a class="anchorlink" href="#mailer-testing">6 Mailer Testing</a></h3><p>Puede encontrar instrucciones detalladas sobre cómo probar sus anuncios en el
<a href="testing.html#testing-your-mailers">testing guide</a>.</p><h3 id="intercepting-and-observing-emails"><a class="anchorlink" href="#intercepting-and-observing-emails">7 Intercepting and Observing Emails</a></h3><p>Action Mailer proporciona enlaces a los métodos de observador e interceptor de correo. Estos le permiten registrar clases que se llaman durante el ciclo de vida de la entrega de correo de cada correo electrónico enviado.</p><h4 id="intercepting-emails"><a class="anchorlink" href="#intercepting-emails">7.1 Intercepting Emails</a></h4><p>Los interceptores le permiten realizar modificaciones en los correos electrónicos antes de que se entreguen a los agentes de entrega. Una clase de interceptor debe implementar el método <code>:deliver_email(message)</code> que será llamado antes de que se envíe el correo electrónico.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">SandboxEmailInterceptor</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">delivering_email</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">message</span><span class="p">.</span><span class="nf">to</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sandbox@example.com'</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class SandboxEmailInterceptor
  def self.delivering_email(message)
    message.to = ['sandbox@example.com']
  end
end
">Copy</button>
</div>
<p>Antes de que el interceptor pueda hacer su trabajo, debe registrarlo con Action
Marco de correo. Puede hacer esto en un archivo inicializador
<code>config/initializers/sandbox_email_interceptor.rb</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">if</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="p">.</span><span class="nf">staging?</span>
  <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">register_interceptor</span><span class="p">(</span><span class="no">SandboxEmailInterceptor</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="if Rails.env.staging?
  ActionMailer::Base.register_interceptor(SandboxEmailInterceptor)
end
">Copy</button>
</div>
<div class="note"><p>El ejemplo anterior utiliza un entorno personalizado llamado "ensayo" para un
producción como servidor pero con fines de prueba. Puedes leer
<a href="configuring.html#creating-rails-environments">Creating Rails environments</a>
para obtener más información sobre los entornos personalizados de Rails.</p></div><h4 id="observing-emails"><a class="anchorlink" href="#observing-emails">7.2 Observing Emails</a></h4><p>Los observadores le dan acceso al mensaje de correo electrónico después de que se haya enviado. Una clase de observador debe implementar el método <code>:deliver_email(message)</code>, que se llamará después de que se envíe el correo electrónico.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">EmailDeliveryObserver</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">delivered_email</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="no">EmailDelivery</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class EmailDeliveryObserver
  def self.delivered_email(message)
    EmailDelivery.log(message)
  end
end
">Copy</button>
</div>
<p>Al igual que los interceptores, debe registrar observadores con el marco de Action Mailer. Puede hacer esto en un archivo inicializador
<code>config/initializers/email_delivery_observer.rb</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">register_observer</span><span class="p">(</span><span class="no">EmailDeliveryObserver</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActionMailer::Base.register_observer(EmailDeliveryObserver)
">Copy</button>
</div>


        <h3>Comentarios Sobre el Contenido</h3>
        <p>
          Las guías de rieles se administran y publican en latinadeveloper/railsguides.es en GitHub.
        </p>
        <p>
          Si lee esta guía y encuentra algún texto o código incorrecto que le interese, no dude en enviar una solicitud de extracción en el repositorio anterior.

          Consulte el archivo README en GitHub para saber cómo enviar una solicitud de extracción.
          Please contribute if you see any typos or factual errors.
        </p>

      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a> License</p>
<p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>

    </div>
  </div>
</body>
</html>
