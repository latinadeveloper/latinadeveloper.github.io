<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Extensiones de Núcleo de Active Support — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/prism/default.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/prism/rails-guides.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/prism.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/responsive-tables.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Extensiones de Núcleo de Active Support — Ruby on Rails Guides" />
  <meta name="description" content="NO LEA ESTE ARCHIVO EN GITHUB, LAS GUÍAS SE PUBLICAN EN https://guides.rubyonrails.org.Extensiones de Núcleo de Active SupportActive Support es el componente Ruby on Rails responsable de proporcionar extensiones de lenguaje Ruby, utilidades y otras cosas transversales.Ofrece un resultado final más rico a nivel de lenguaje, dirigido tanto al desarrollo de aplicaciones Rails como al desarrollo de Ruby on Rails.Después de leer esta guía, sabrá: Qué son las extensiones principales. Cómo cargar todas las extensiones. Cómo seleccionar las extensiones que desee. Qué extensiones proporciona Active Support." />
  <meta property="og:description" content="NO LEA ESTE ARCHIVO EN GITHUB, LAS GUÍAS SE PUBLICAN EN https://guides.rubyonrails.org.Extensiones de Núcleo de Active SupportActive Support es el componente Ruby on Rails responsable de proporcionar extensiones de lenguaje Ruby, utilidades y otras cosas transversales.Ofrece un resultado final más rico a nivel de lenguaje, dirigido tanto al desarrollo de aplicaciones Rails como al desarrollo de Ruby on Rails.Después de leer esta guía, sabrá: Qué son las extensiones principales. Cómo cargar todas las extensiones. Cómo seleccionar las extensiones que desee. Qué extensiones proporciona Active Support." />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
<!--    <img src="images/edge_badge.png" alt="edge-badge" id="edge-badge" />-->
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Más en <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Más Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guías</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://stackoverflow.com/questions/tagged/ruby-on-rails">Pedir Ayuda</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribuir on GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Guías de Ruby on Rails">Guías de Ruby on Rails </a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Inicio</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Index de Guías </a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Empieza Aqui</dt>
                  <dd><a href="getting_started.html">Introducción a Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Modelos</dt>
                  <dd><a href="active_record_basics.html">Conceptos básicos de Active Record</a></dd>
                  <dd><a href="active_record_migrations.html">Migraciones de Active Record</a></dd>
                  <dd><a href="active_record_validations.html">Validaciones de Active Record</a></dd>
                  <dd><a href="active_record_callbacks.html">Devolución (callbacks) de Llamadas de Active Record</a></dd>
                  <dd><a href="association_basics.html">Asociaciones de Active Record</a></dd>
                  <dd><a href="active_record_querying.html">Interfaz de Consulta de Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Vistas</dt>
                  <dd><a href="layouts_and_rendering.html">Diseños y Renderizado en Rails</a></dd>
                  <dd><a href="form_helpers.html">Ayudantes de Formulario de Action</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controladores</dt>
                  <dd><a href="action_controller_overview.html">Descripción General de Action Controller</a></dd>
                  <dd><a href="routing.html">Rails Routing Desde el Exterior Hacia Adentro</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Otros Componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Extensiones de Núcleo de Active Support</a></dd>
                  <dd><a href="action_mailer_basics.html">Conceptos Básicos de Action Mailer</a></dd>
                  <dd><a href="active_job_basics.html">Conceptos Básicos de Active Job</a></dd>
                  <dd><a href="active_storage_overview.html">Descripción General de Active Storage</a></dd>
                  <dd><a href="action_cable_overview.html">Descripción General de Action Cable</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Temas Avanzados</dt>
                  <dd><a href="i18n.html">Rails API de Internacionalización (I18n)</a></dd>
                  <dd><a href="testing.html">Prueba de Aplicaciones de Rails</a></dd>
                  <dd><a href="security.html">Seguridad de Aplicaciones Rails</a></dd>
                  <dd><a href="debugging_rails_applications.html">Depuración de Applications Rails</a></dd>
                  <dd><a href="configuring.html">Configuración de Aplicaciones de Rails</a></dd>
                  <dd><a href="command_line.html">La Línea de Comandos de Rails</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline (necesita traducción)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode) (necesita traducción)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode) (necesita traducción)</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails An Overview (necesita traducción)</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications (necesita traducción)</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Extending Rails  (toda la sección necesita traducción)</dt>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribuir</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guides Index</option>
              <optgroup label="Empieza Aqui">
                  <option value="getting_started.html">Introducción a Rails</option>
              </optgroup>
              <optgroup label="Modelos">
                  <option value="active_record_basics.html">Conceptos básicos de Active Record</option>
                  <option value="active_record_migrations.html">Migraciones de Active Record</option>
                  <option value="active_record_validations.html">Validaciones de Active Record</option>
                  <option value="active_record_callbacks.html">Devolución (callbacks) de Llamadas de Active Record</option>
                  <option value="association_basics.html">Asociaciones de Active Record</option>
                  <option value="active_record_querying.html">Interfaz de Consulta de Active Record</option>
              </optgroup>
              <optgroup label="Vistas">
                  <option value="layouts_and_rendering.html">Diseños y Renderizado en Rails</option>
                  <option value="form_helpers.html">Ayudantes de Formulario de Action</option>
              </optgroup>
              <optgroup label="Controladores">
                  <option value="action_controller_overview.html">Descripción General de Action Controller</option>
                  <option value="routing.html">Rails Routing Desde el Exterior Hacia Adentro</option>
              </optgroup>
              <optgroup label="Otros Componentes">
                  <option value="active_support_core_extensions.html">Extensiones de Núcleo de Active Support</option>
                  <option value="action_mailer_basics.html">Conceptos Básicos de Action Mailer</option>
                  <option value="active_job_basics.html">Conceptos Básicos de Active Job</option>
                  <option value="active_storage_overview.html">Descripción General de Active Storage</option>
                  <option value="action_cable_overview.html">Descripción General de Action Cable</option>
              </optgroup>
              <optgroup label="Temas Avanzados">
                  <option value="i18n.html">Rails API de Internacionalización (I18n)</option>
                  <option value="testing.html">Prueba de Aplicaciones de Rails</option>
                  <option value="security.html">Seguridad de Aplicaciones Rails</option>
                  <option value="debugging_rails_applications.html">Depuración de Applications Rails</option>
                  <option value="configuring.html">Configuración de Aplicaciones de Rails</option>
                  <option value="command_line.html">La Línea de Comandos de Rails</option>
                  <option value="asset_pipeline.html">The Asset Pipeline (necesita traducción)</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode) (necesita traducción)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode) (necesita traducción)</option>
                  <option value="caching_with_rails.html">Caching with Rails An Overview (necesita traducción)</option>
                  <option value="api_app.html">Using Rails for API-only Applications (necesita traducción)</option>
              </optgroup>
              <optgroup label="Extending Rails  (toda la sección necesita traducción)">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <p><strong>NO LEA ESTE ARCHIVO EN GITHUB, LAS GUÍAS SE PUBLICAN EN <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p><h2>Extensiones de Núcleo de Active Support</h2><p>Active Support es el componente Ruby on Rails responsable de proporcionar extensiones de lenguaje Ruby, utilidades y otras cosas transversales.</p><p>Ofrece un resultado final más rico a nivel de lenguaje, dirigido tanto al desarrollo de aplicaciones Rails como al desarrollo de Ruby on Rails.</p><p>Después de leer esta guía, sabrá:</p>
<ul>
<li>Qué son las extensiones principales.</li>
<li>Cómo cargar todas las extensiones.</li>
<li>Cómo seleccionar las extensiones que desee.</li>
<li>Qué extensiones proporciona Active Support.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#how-to-load-core-extensions">How to Load Core Extensions</a>

<ul>
<li><a href="#stand-alone-active-support">Stand-Alone Active Support</a></li>
<li><a href="#active-support-within-a-ruby-on-rails-application">Active Support Within a Ruby on Rails Application</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-all-objects">Extensions to All Objects</a>

<ul>
<li><a href="#blank-questionmark-and-present-questionmark"><code>blank?</code> and <code>present?</code></a></li>
<li><a href="#presence"><code>presence</code></a></li>
<li><a href="#duplicable-questionmark"><code>duplicable?</code></a></li>
</ul>
</li>
<li>
<a href="#deep-dup"><code>deep_dup</code></a>

<ul>
<li><a href="#try"><code>try</code></a></li>
<li><a href="#class-eval-args-block"><code>class_eval(*args, &amp;block)</code></a></li>
<li><a href="#acts-like-questionmark-duck"><code>acts_like?(duck)</code></a></li>
<li><a href="#to-param"><code>to_param</code></a></li>
<li><a href="#to-query"><code>to_query</code></a></li>
<li><a href="#with-options"><code>with_options</code></a></li>
<li><a href="#json-support">JSON support</a></li>
<li><a href="#instance-variables">Instance Variables</a></li>
<li><a href="#silencing-warnings-and-exceptions">Silencing Warnings and Exceptions</a></li>
<li><a href="#in-questionmark"><code>in?</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-module">Extensions to <code>Module</code></a>

<ul>
<li><a href="#attributes">Attributes</a></li>
<li><a href="#parents">Parents</a></li>
<li><a href="#anonymous">Anonymous</a></li>
<li><a href="#method-delegation">Method Delegation</a></li>
<li><a href="#redefining-methods">Redefining Methods</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-class">Extensions to <code>Class</code></a>

<ul>
<li><a href="#class-attributes">Class Attributes</a></li>
<li><a href="#subclasses-descendants">Subclasses &amp; Descendants</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-string">Extensions to <code>String</code></a>

<ul>
<li><a href="#output-safety">Output Safety</a></li>
<li><a href="#transformation">Transformation</a></li>
<li><a href="#remove"><code>remove</code></a></li>
<li><a href="#squish"><code>squish</code></a></li>
<li><a href="#truncate"><code>truncate</code></a></li>
<li><a href="#truncate-bytes"><code>truncate_bytes</code></a></li>
<li><a href="#truncate-words"><code>truncate_words</code></a></li>
<li><a href="#inquiry"><code>inquiry</code></a></li>
<li><a href="#extensions-to-string-starts-with-questionmark-and-ends-with-questionmark"><code>starts_with?</code> and <code>ends_with?</code></a></li>
<li><a href="#strip-heredoc"><code>strip_heredoc</code></a></li>
<li><a href="#access">Access</a></li>
<li><a href="#inflections">Inflections</a></li>
<li><a href="#extensions-to-string-conversions">Conversions</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-symbol">Extensions to <code>Symbol</code></a>

<ul>
<li><a href="#extensions-to-symbol-starts-with-questionmark-and-ends-with-questionmark"><code>starts_with?</code> and <code>ends_with?</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-numeric">Extensions to <code>Numeric</code></a>

<ul>
<li><a href="#bytes">Bytes</a></li>
<li><a href="#extensions-to-numeric-time">Time</a></li>
<li><a href="#formatting">Formatting</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-integer">Extensions to <code>Integer</code></a>

<ul>
<li><a href="#multiple-of-questionmark"><code>multiple_of?</code></a></li>
<li><a href="#ordinal"><code>ordinal</code></a></li>
<li><a href="#ordinalize"><code>ordinalize</code></a></li>
<li><a href="#extensions-to-integer-time">Time</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-bigdecimal">Extensions to <code>BigDecimal</code></a>

<ul>
<li><a href="#extensions-to-bigdecimal-to-s"><code>to_s</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-enumerable">Extensions to <code>Enumerable</code></a>

<ul>
<li><a href="#sum"><code>sum</code></a></li>
<li><a href="#index-by"><code>index_by</code></a></li>
<li><a href="#index-with"><code>index_with</code></a></li>
<li><a href="#many-questionmark"><code>many?</code></a></li>
<li><a href="#exclude-questionmark"><code>exclude?</code></a></li>
<li><a href="#including"><code>including</code></a></li>
<li><a href="#excluding"><code>excluding</code></a></li>
<li><a href="#pluck"><code>pluck</code></a></li>
<li><a href="#pick"><code>pick</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-array">Extensions to <code>Array</code></a>

<ul>
<li><a href="#accessing">Accessing</a></li>
<li><a href="#extensions-to-array-extracting">Extracting</a></li>
<li><a href="#options-extraction">Options Extraction</a></li>
<li><a href="#extensions-to-array-conversions">Conversions</a></li>
<li><a href="#wrapping">Wrapping</a></li>
<li><a href="#duplicating">Duplicating</a></li>
<li><a href="#grouping">Grouping</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-hash">Extensions to <code>Hash</code></a>

<ul>
<li><a href="#extensions-to-hash-conversions">Conversions</a></li>
<li><a href="#merging">Merging</a></li>
<li><a href="#deep-duplicating">Deep duplicating</a></li>
<li><a href="#working-with-keys">Working with Keys</a></li>
<li><a href="#working-with-values">Working with Values</a></li>
<li><a href="#slicing">Slicing</a></li>
<li><a href="#extensions-to-hash-extracting">Extracting</a></li>
<li><a href="#indifferent-access">Indifferent Access`</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-regexp">Extensions to <code>Regexp</code></a>

<ul>
<li><a href="#multiline-questionmark"><code>multiline?</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-range">Extensions to <code>Range</code></a>

<ul>
<li><a href="#extensions-to-range-to-s"><code>to_s</code></a></li>
<li><a href="#overlaps-questionmark"><code>overlaps?</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-date">Extensions to <code>Date</code></a>

<ul>
<li><a href="#extensions-to-date-calculations">Calculations</a></li>
<li><a href="#extensions-to-date-conversions">Conversions</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-datetime">Extensions to <code>DateTime</code></a>

<ul>
<li><a href="#extensions-to-datetime-calculations">Calculations</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-time">Extensions to <code>Time</code></a>

<ul>
<li><a href="#calculations">Calculations</a></li>
<li><a href="#time-constructors">Time Constructors</a></li>
</ul>
</li>
<li>
<a href="#extensions-to-file">Extensions to <code>File</code></a>

<ul>
<li><a href="#atomic-write"><code>atomic_write</code></a></li>
</ul>
</li>
<li>
<a href="#extensions-to-marshal">Extensions to <code>Marshal</code></a>

<ul>
<li><a href="#load"><code>load</code></a></li>
</ul>
</li>
<li><a href="#extensions-to-nameerror">Extensions to <code>NameError</code></a></li>
<li><a href="#extensions-to-loaderror">Extensions to <code>LoadError</code></a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="how-to-load-core-extensions"><a class="anchorlink" href="#how-to-load-core-extensions">1 How to Load Core Extensions</a></h3><h4 id="stand-alone-active-support"><a class="anchorlink" href="#stand-alone-active-support">1.1 Stand-Alone Active Support</a></h4><p>Para tener una huella predeterminada cercana a cero, Active Support no carga nada de forma predeterminada. Está dividido en pedazos pequeños para que pueda cargar justo lo que necesita, y también tiene algunos puntos de entrada convenientes para cargar extensiones relacionadas de una sola vez, incluso todo.</p><p>Por lo tanto, después de un simple requerimiento como:</p><div class="code_container">
<pre><code class="language-ruby">require "active_support"
</code></pre>
</div>
<p>objects do not even respond to <code>blank?</code>. Let's see how to load its definition.</p><h5 id="cherry-picking-a-definition"><a class="anchorlink" href="#cherry-picking-a-definition">1.1.1 Cherry-picking a Definition</a></h5><p>La forma más ligera de dejar <code>blank?</code> es seleccionar el archivo que lo define.</p><p>Para cada método definido como una extensión principal, esta guía tiene una nota que dice dónde se define dicho método. En el caso de <code>blank?</code>, La nota dice:</p><div class="note"><p>Definido en <code>active_support/core_ext/object/blank.rb</code>.</p></div><p>Eso significa que puede solicitarlo así:</p><div class="code_container">
<pre><code class="language-ruby">require "active_support"
require "active_support/core_ext/object/blank"
</code></pre>
</div>
<p>Active Support se ha revisado cuidadosamente para que la selección de un archivo solo cargue las dependencias estrictamente necesarias, si las hubiera.</p><h5 id="loading-grouped-core-extensions"><a class="anchorlink" href="#loading-grouped-core-extensions">1.1.2 Loading Grouped Core Extensions</a></h5><p>El siguiente nivel es simplemente cargar todas las extensiones en <code>Object</code>. Como regla general, las extensiones de <code>SomeClass</code> están disponibles de una sola vez cargando <code>active_support/core_ext/some_class</code>.</p><p>Por lo tanto, para cargar todas las extensiones a <code>Object</code> (incluyendo <code>blank?</code>):</p><div class="code_container">
<pre><code class="language-ruby">require "active_support"
require "active_support/core_ext/object"
</code></pre>
</div>
<h5 id="loading-all-core-extensions"><a class="anchorlink" href="#loading-all-core-extensions">1.1.3 Loading All Core Extensions</a></h5><p>Es posible que prefiera cargar todas las extensiones principales, hay un archivo para eso:</p><div class="code_container">
<pre><code class="language-ruby">require "active_support"
require "active_support/core_ext"
</code></pre>
</div>
<h5 id="loading-all-active-support"><a class="anchorlink" href="#loading-all-active-support">1.1.4 Loading All Active Support</a></h5><p>Y finalmente, si desea tener disponible todo el Soporte activo, simplemente emita:</p><div class="code_container">
<pre><code class="language-ruby">require "active_support/all"
</code></pre>
</div>
<p>Eso ni siquiera pone todo el Active Support en la memoria por adelantado, de hecho, algunas cosas se configuran mediante <code>autoload</code>, por lo que solo se carga si se usa.</p><h4 id="active-support-within-a-ruby-on-rails-application"><a class="anchorlink" href="#active-support-within-a-ruby-on-rails-application">1.2 Active Support Within a Ruby on Rails Application</a></h4><p>Una aplicación Ruby on Rails carga todo el soporte activo a menos que <code>config.active_support.bare</code> sea verdadero. En ese caso, la aplicación solo cargará lo que el propio marco elija para sus propias necesidades, y aún puede hacerlo en cualquier nivel de granularidad, como se explicó en la sección anterior.</p><h3 id="extensions-to-all-objects"><a class="anchorlink" href="#extensions-to-all-objects">2 Extensions to All Objects</a></h3><h4 id="blank-questionmark-and-present-questionmark"><a class="anchorlink" href="#blank-questionmark-and-present-questionmark">2.1 <code>blank?</code> and <code>present?</code></a></h4><p>The following values are considered to be blank in a Rails application:</p>
<ul>
<li><p><code>nil</code> y<code>false</code>,</p></li>
<li><p>cadenas compuestas solo de espacios en blanco (ver nota a continuación),</p></li>
<li><p>matrices y hashes vacíos, y</p></li>
<li><p>cualquier otro objeto que responda a "¿vacío?" y esté vacío.</p></li>
</ul>
<div class="info"><p>El predicado para cadenas utiliza la clase de caracteres compatible con Unicode <code>[:space:]</code>, por lo que, por ejemplo, U + 2029 (separador de párrafo) se considera un espacio en blanco.</p></div><div class="warning"><p>Tenga en cuenta que no se mencionan los números. En particular, 0 y 0.0 son ** no ** en blanco.</p></div><p>Por ejemplo, este método de <code>ActionController::HttpAuthentication::Token::ControllerMethods</code> usa <code>blank?</code> Para verificar si un token está presente:</p><div class="code_container">
<pre><code class="language-ruby">def authenticate(controller, &amp;login_procedure)
  token, options = token_and_options(controller.request)
  unless token.blank?
    login_procedure.call(token, options)
  end
end
</code></pre>
</div>
<p>El método <code>present?</code> Es equivalente a <code>!blank?</code>. Este ejemplo está tomado de <code>ActionDispatch::Http::Cache::Response</code>:</p><div class="code_container">
<pre><code class="language-ruby">def set_conditional_cache_control!
  return if self["Cache-Control"].present?
  ...
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/blank.rb</code>.</p></div><h4 id="presence"><a class="anchorlink" href="#presence">2.2 <code>presence</code></a></h4><p>El método <code>presence</code> devuelve su receptor si <code>present?</code> y <code>nil</code> en caso contrario. Es útil para modismos como este:</p><div class="code_container">
<pre><code class="language-ruby">host = config[:host].presence || 'localhost'
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/blank.rb</code>.</p></div><h4 id="duplicable-questionmark"><a class="anchorlink" href="#duplicable-questionmark">2.3 <code>duplicable?</code></a></h4><p>A partir de Ruby 2.5, la mayoría de los objetos se pueden duplicar mediante <code>dup</code> o <code>clone</code>:</p><div class="code_container">
<pre><code class="language-ruby">"foo".dup           # =&gt; "foo"
"".dup              # =&gt; ""
Rational(1).dup     # =&gt; (1/1)
Complex(0).dup      # =&gt; (0+0i)
1.method(:+).dup    # =&gt; TypeError (allocator undefined for Method)
</code></pre>
</div>
<p>Active Support proporciona <code>duplicable?</code> Para consultar un objeto sobre esto:</p><div class="code_container">
<pre><code class="language-ruby">"foo".duplicable?           # =&gt; true
"".duplicable?              # =&gt; true
Rational(1).duplicable?     # =&gt; true
Complex(1).duplicable?      # =&gt; true
1.method(:+).duplicable?    # =&gt; false
</code></pre>
</div>
<div class="warning"><p>Cualquier clase puede prohibir la duplicación eliminando <code>dup</code> y <code>clone</code> o generando excepciones. Por lo tanto, solo "rescue" puede decir si un objeto arbitrario dado es duplicable. <code>duplicable?</code> depende de la lista codificada anterior, pero es mucho más rápido que <code>rescue</code>. Úselo solo si sabe que la lista codificada es suficiente en su caso de uso.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/object/duplicable.rb</code>.</p></div><h3 id="deep-dup"><a class="anchorlink" href="#deep-dup">3 <code>deep_dup</code></a></h3><p>The <code>deep_dup</code> El método devuelve una copia profunda de un objeto dado. Normalmente, cuando <code>dup</code> un objeto que contiene otros objetos, Ruby no los "duplica", por lo que crea una copia superficial del objeto. Si tiene una matriz con una cadena, por ejemplo, se verá así:</p><div class="code_container">
<pre><code class="language-ruby">array     = ['string']
duplicate = array.dup

duplicate.push 'another-string'

# the object was duplicated, so the element was added only to the duplicate
array     # =&gt; ['string']
duplicate # =&gt; ['string', 'another-string']

duplicate.first.gsub!('string', 'foo')

# first element was not duplicated, it will be changed in both arrays
array     # =&gt; ['foo']
duplicate # =&gt; ['foo', 'another-string']
</code></pre>
</div>
<p>Como puede ver, después de duplicar la instancia de <code>Array</code>, obtuvimos otro objeto, por lo tanto, podemos modificarlo y el objeto original permanecerá sin cambios. Sin embargo, esto no es cierto para los elementos de la matriz. Dado que <code>dup</code> no hace una copia profunda, la cadena dentro de la matriz sigue siendo el mismo objeto.</p><p>Si necesita una copia profunda de un objeto, debe usar <code>deep_dup</code>. Aquí hay un ejemplo:</p><div class="code_container">
<pre><code class="language-ruby">array     = ['string']
duplicate = array.deep_dup

duplicate.first.gsub!('string', 'foo')

array     # =&gt; ['string']
duplicate # =&gt; ['foo']
</code></pre>
</div>
<p>Si el objeto no es duplicable, <code>deep_dup</code> simplemente lo devolverá:</p><div class="code_container">
<pre><code class="language-ruby">number = 1
duplicate = number.deep_dup
number.object_id == duplicate.object_id   # =&gt; true
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id="try"><a class="anchorlink" href="#try">3.1 <code>try</code></a></h4><p>Cuando desea llamar a un método en un objeto solo si no es <code>nil</code>, la forma más sencilla de lograrlo es con declaraciones condicionales, agregando desorden innecesario. La alternativa es usar <code>try</code>. <code>try</code> es como<code>Object # send</code> excepto que devuelve <code>nil</code> si se envía a<code>nil</code>.</p><p>Aquí hay un ejemplo:</p><div class="code_container">
<pre><code class="language-ruby"># without try
unless @number.nil?
  @number.next
end

# with try
@number.try(:next)
</code></pre>
</div>
<p>Otro ejemplo es este código de <code>ActiveRecord::ConnectionAdapters::AbstractAdapter</code> donde <code>@logger</code> podría ser<code>nil</code>. Puede ver que el código usa <code>try</code> y evita una verificación innecesaria.</p><div class="code_container">
<pre><code class="language-ruby">def log_info(sql, name, ms)
  if @logger.try(:debug?)
    name = '%s (%.1fms)' % [name || 'SQL', ms]
    @logger.debug(format_log_entry(name, sql.squeeze(' ')))
  end
end
</code></pre>
</div>
<p><code>try</code> también se puede llamar sin argumentos pero un bloque, que solo se ejecutará si el objeto no es nil:</p><div class="code_container">
<pre><code class="language-ruby">@person.try { |p| "#{p.first_name} #{p.last_name}" }
</code></pre>
</div>
<p>Tenga en cuenta que <code>try</code> se tragará los errores sin método, devolviendo nil en su lugar. Si desea protegerse contra errores tipográficos, utilice <code>try!</code> En su lugar:</p><div class="code_container">
<pre><code class="language-ruby">@number.try(:nest)  # =&gt; nil
@number.try!(:nest) # NoMethodError: undefined method `nest' for 1:Integer
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/try.rb</code>.</p></div><h4 id="class-eval-args-block"><a class="anchorlink" href="#class-eval-args-block">3.2 <code>class_eval(*args, &amp;block)</code></a></h4><p>Puede evaluar código en el contexto de la clase singleton de cualquier objeto usando <code>class_eval</code>:</p><div class="code_container">
<pre><code class="language-ruby">class Proc
  def bind(object)
    block, time = self, Time.current
    object.class_eval do
      method_name = "__bind_#{time.to_i}_#{time.usec}"
      define_method(method_name, &amp;block)
      method = instance_method(method_name)
      remove_method(method_name)
      method
    end.bind(object)
  end
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/kernel/singleton_class.rb</code>.</p></div><h4 id="acts-like-questionmark-duck"><a class="anchorlink" href="#acts-like-questionmark-duck">3.3 <code>acts_like?(duck)</code></a></h4><p>El método <code>acts_libe?</code> Proporciona una manera de comprobar si alguna clase actúa como otra clase basándose en una convención simple: una clase que proporciona la misma interfaz que define <code>String</code></p><div class="code_container">
<pre><code class="language-ruby">def acts_like_string?
end
</code></pre>
</div>
<p>que es solo un marcador, su cuerpo o valor de retorno son irrelevantes. Luego, el código del cliente puede consultar la seguridad del tipo pato de esta manera:</p><div class="code_container">
<pre><code class="language-ruby">some_klass.acts_like?(:string)
</code></pre>
</div>
<p>Rails tiene clases que actúan como <code>Date</code> o <code>Time</code> y siguen este contrato.</p><div class="note"><p>Definido en <code>active_support/core_ext/object/acts_like.rb</code>.</p></div><h4 id="to-param"><a class="anchorlink" href="#to-param">3.4 <code>to_param</code></a></h4><p>Todos los objetos en Rails responden al método <code>to_param</code>, que está destinado a devolver algo que los represente como valores en una cadena de consulta o como fragmentos de URL.</p><p>Por defecto, <code>to_param</code> solo llama a <code>to_s</code>:</p><div class="code_container">
<pre><code class="language-ruby">7.to_param # =&gt; "7"
</code></pre>
</div>
<p>El valor de retorno de <code>to_param</code> <strong>no</strong> debe escaparse:</p><div class="code_container">
<pre><code class="language-ruby">"Tom &amp; Jerry".to_param # =&gt; "Tom &amp; Jerry"
</code></pre>
</div>
<p>Varias clases de Rails sobrescriben este método.</p><p>Por ejemplo, <code>nil</code>,<code>true</code> y <code>false</code> se devuelven ellos mismos. <code>Array#to_param</code> llama a <code>to_param</code> en los elementos y une el resultado con "/":</p><div class="code_container">
<pre><code class="language-ruby">[0, true, String].to_param # =&gt; "0/true/String"
</code></pre>
</div>
<p>En particular, el sistema de enrutamiento Rails llama a <code>to_param</code> en los modelos para obtener un valor para el marcador de posición<code>: id</code>. <code>ActiveRecord :: Base # to_param</code> devuelve el <code>id</code> de un modelo, pero puedes redefinir ese método en tus modelos. Por ejemplo, dado</p><div class="code_container">
<pre><code class="language-ruby">class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
</code></pre>
</div>
<p>Nosotras obtenemos:</p><div class="code_container">
<pre><code class="language-ruby">user_path(@user) # =&gt; "/users/357-john-smith"
</code></pre>
</div>
<p>ADVERTENCIA. Los controladores deben estar al tanto de cualquier redefinición de <code>to_param</code> porque cuando una solicitud como esa viene en "357-john-smith" es el valor de <code>params[:id]</code>.</p><p>NOTA: Definido en <code>active_support/core_ext/object/to_param.rb</code>.</p><h4 id="to-query"><a class="anchorlink" href="#to-query">3.5 <code>to_query</code></a></h4><p>A excepción de los hash, dada una <code>key</code> sin escape, este método construye la parte de una cadena de consulta que mapeará dicha clave a lo que devuelve <code>to_param</code>. Por ejemplo, dado</p><div class="code_container">
<pre><code class="language-ruby">class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
</code></pre>
</div>
<p>Nosotras obtenemos:</p><div class="code_container">
<pre><code class="language-ruby">current_user.to_query('user') # =&gt; "user=357-john-smith"
</code></pre>
</div>
<p>Este método escapa a lo que sea necesario, tanto para la clave como para el valor:</p><div class="code_container">
<pre><code class="language-ruby">account.to_query('company[name]')
# =&gt; "company%5Bname%5D=Johnson+%26+Johnson"
</code></pre>
</div>
<p>por lo que su salida está lista para usarse en una cadena de consulta.</p><p>Las matrices devuelven el resultado de aplicar <code>to_query</code> a cada elemento con <code>key[]</code> como clave, y unen el resultado con "&amp;":</p><div class="code_container">
<pre><code class="language-ruby">[3.4, -45.6].to_query('sample')
# =&gt; "sample%5B%5D=3.4&amp;sample%5B%5D=-45.6"
</code></pre>
</div>
<p>Los hash también responden a <code>to_query</code> pero con una firma diferente. Si no se pasa ningún argumento, una llamada genera una serie ordenada de asignaciones de clave / valor que llaman a <code>to_query(key)</code> en sus valores. Luego une el resultado con "&amp;":</p><div class="code_container">
<pre><code class="language-ruby">{c: 3, b: 2, a: 1}.to_query # =&gt; "a=1&amp;b=2&amp;c=3"
</code></pre>
</div>
<p>El método <code>Hash#to_query</code> acepta un espacio de nombre opcional para las claves:</p><div class="code_container">
<pre><code class="language-ruby">{id: 89, name: "John Smith"}.to_query('user')
# =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"
</code></pre>
</div>
<p>NOTA: Definido en <code>active_support/core_ext/object/to_query.rb</code>.</p><h4 id="with-options"><a class="anchorlink" href="#with-options">3.6 <code>with_options</code></a></h4><p>El método <code>with_options</code> proporciona una manera de descartar opciones comunes en una serie de llamadas a métodos.</p><p>Dado un hash de opciones predeterminado, <code>with_options</code> cede un objeto proxy a un bloque. Dentro del bloque, los métodos llamados en el proxy se envían al receptor con sus opciones fusionadas. Por ejemplo, se deshace de la duplicación en:</p><div class="code_container">
<pre><code class="language-ruby">class Account &lt; ApplicationRecord
  has_many :customers, dependent: :destroy
  has_many :products,  dependent: :destroy
  has_many :invoices,  dependent: :destroy
  has_many :expenses,  dependent: :destroy
end
</code></pre>
</div>
<p>de esta manera:</p><div class="code_container">
<pre><code class="language-ruby">class Account &lt; ApplicationRecord
  with_options dependent: :destroy do |assoc|
    assoc.has_many :customers
    assoc.has_many :products
    assoc.has_many :invoices
    assoc.has_many :expenses
  end
end
</code></pre>
</div>
<p>Ese idioma también puede transmitir <em>grouping</em> al lector. Por ejemplo, digamos que desea enviar un boletín cuyo idioma depende del usuario. En algún lugar del correo, podría agrupar bits dependientes de la configuración regional como este:</p><div class="code_container">
<pre><code class="language-ruby">I18n.with_options locale: user.locale, scope: "newsletter" do |i18n|
  subject i18n.t :subject
  body    i18n.t :body, user_name: user.name
end
</code></pre>
</div>
<div class="info"><p>Since <code>with_options</code> forwards calls to its receiver they can be nested. Each nesting level will merge inherited defaults in addition to their own.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/object/with_options.rb</code>.</p></div><h4 id="json-support"><a class="anchorlink" href="#json-support">3.7 JSON support</a></h4><p>Active Support proporciona una mejor implementación de <code>to_json</code> que la gem <code>json</code> que normalmente proporciona para los objetos Ruby. Esto se debe a que algunas clases, como <code>Hash</code>, <code>OrderedHash</code> y <code>Process::Status</code> necesitan un manejo especial para proporcionar una representación JSON adecuada.</p><p>NOTA: Definido en <code>active_support/core_ext/object/json.rb</code>.</p><h4 id="instance-variables"><a class="anchorlink" href="#instance-variables">3.8 Instance Variables</a></h4><p>Active Support proporciona varios métodos para facilitar el acceso a las variables de instancia.</p><h5 id="instance-values"><a class="anchorlink" href="#instance-values">3.8.1 <code>instance_values</code></a></h5><p>El método <code>instance_values</code> devuelve un hash que asigna los nombres de las variables de instancia sin" @ "a su
valores correspondientes. Las claves son cadenas:</p><div class="code_container">
<pre><code class="language-ruby">class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_values # =&gt; {"x" =&gt; 0, "y" =&gt; 1}
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/instance_variables.rb</code>.</p></div><h5 id="instance-variable-names"><a class="anchorlink" href="#instance-variable-names">3.8.2 <code>instance_variable_names</code></a></h5><p>El método <code>instance_variable_names</code> devuelve una matriz. Cada nombre incluye el signo "@".</p><div class="code_container">
<pre><code class="language-ruby">class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_variable_names # =&gt; ["@x", "@y"]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/instance_variables.rb</code>.</p></div><h4 id="silencing-warnings-and-exceptions"><a class="anchorlink" href="#silencing-warnings-and-exceptions">3.9 Silencing Warnings and Exceptions</a></h4><p>Los métodos <code>silent_warnings</code> y <code>enable_warnings</code> cambian el valor de <code>$VERBOSE</code> en consecuencia durante la duración de su bloqueo, y lo restablecen después:</p><div class="code_container">
<pre><code class="language-ruby">silence_warnings { Object.const_set "RAILS_DEFAULT_LOGGER", logger }
</code></pre>
</div>
<p>También es posible silenciar las excepciones con <code>suppress</code>. Este método recibe un número arbitrario de clases de excepción. Si se genera una excepción durante la ejecución del bloque y es <code>kind_of?</code> Cualquiera de los argumentos, <code>suppress</code> la captura y regresa silenciosamente. De lo contrario, la excepción no se captura:</p><div class="code_container">
<pre><code class="language-ruby"># If the user is locked, the increment is lost, no big deal.
suppress(ActiveRecord::StaleObjectError) do
  current_user.increment! :visits
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/kernel/reporting.rb</code>.</p></div><h4 id="in-questionmark"><a class="anchorlink" href="#in-questionmark">3.10 <code>in?</code></a></h4><p>El predicado <code>in?</code> Prueba si un objeto está incluido en otro objeto. Se generará una excepción <code>ArgumentError</code> si el argumento pasado no responde a <code>include?</code>.</p><p>Ejemplos de <code>in?</code>:</p><div class="code_container">
<pre><code class="language-ruby">1.in?([1,2])        # =&gt; true
"lo".in?("hello")   # =&gt; true
25.in?(30..50)      # =&gt; false
1.in?(1)            # =&gt; ArgumentError
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/inclusion.rb</code>.</p></div><h3 id="extensions-to-module"><a class="anchorlink" href="#extensions-to-module">4 Extensions to <code>Module</code></a></h3><h4 id="attributes"><a class="anchorlink" href="#attributes">4.1 Attributes</a></h4><h5 id="alias-attribute"><a class="anchorlink" href="#alias-attribute">4.1.1 <code>alias_attribute</code></a></h5><div class="code_container">
<pre><code class="language-ruby">class User &lt; ApplicationRecord
  # You can refer to the email column as "login".
  # This can be meaningful for authentication code.
  alias_attribute :login, :email
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/module/aliasing.rb</code>.</p></div><h5 id="internal-attributes"><a class="anchorlink" href="#internal-attributes">4.1.2 Internal Attributes</a></h5><p>Cuando está definiendo un atributo en una clase que está destinado a ser subclasificado, las colisiones de nombres son un riesgo. Eso es muy importante para las bibliotecas.</p><p>Active Support define las macros <code>attr_internal_reader</code>, <code>attr_internal_writer</code> y <code>attr_internal_accessor</code>. Se comportan como sus contrapartes <code>attr_ *</code> incorporadas en Ruby, excepto que nombran la variable de instancia subyacente de una manera que hace que las colisiones sean menos probables.</p><p>La macro <code>attr_internal</code> es sinónimo de <code>attr_internal_accessor</code>:</p><div class="code_container">
<pre><code class="language-ruby"># library
class ThirdPartyLibrary::Crawler
  attr_internal :log_level
end

# client code
class MyCrawler &lt; ThirdPartyLibrary::Crawler
  attr_accessor :log_level
end
</code></pre>
</div>
<p>En el ejemplo anterior podría darse el caso de que <code>:log_level</code> no pertenezca a la interfaz pública de la biblioteca y solo se utilice para desarrollo. El código del cliente, inconsciente del posible conflicto, subclasifica y define su propio <code>: log_level</code>. Gracias a <code>attr_internal</code> no hay colisión.</p><p>De forma predeterminada, la variable de instancia interna se nombra con un guión bajo inicial, <code>@ _log_level</code> en el ejemplo anterior. Eso se puede configurar a través de <code>Module.attr_internal_naming_format</code>, sin embargo, puede pasar cualquier cadena de formato similar a<code>sprintf</code> con una <code>@</code> inicial y un <code>% s</code> en algún lugar, que es donde se colocará el nombre. El valor predeterminado es <code>" @ _% s "</code>.</p><p>Rails usa atributos internos en algunos puntos, como ejemplos de vistas:</p><div class="code_container">
<pre><code class="language-ruby">module ActionView
  class Base
    attr_internal :captures
    attr_internal :request, :layout
    attr_internal :controller, :template
  end
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/module/attr_internal.rb</code>.</p></div><h5 id="module-attributes"><a class="anchorlink" href="#module-attributes">4.1.3 Module Attributes</a></h5><p>Las macros <code>mattr_reader</code>, <code>mattr_writer</code> y <code>mattr_accessor</code> son las mismas que las macros <code>cattr_ *</code>definidas para la clase. De hecho, las macros <code>cattr_ *</code> son solo alias para las macros <code>mattr_ *</code>. Marque <a href="#class-attributes">Class Attributes</a>.</p><p>Por ejemplo, el mecanismo de dependencias las usa:</p><div class="code_container">
<pre><code class="language-ruby">module ActiveSupport
  module Dependencies
    mattr_accessor :warnings_on_first_load
    mattr_accessor :history
    mattr_accessor :loaded
    mattr_accessor :mechanism
    mattr_accessor :load_paths
    mattr_accessor :load_once_paths
    mattr_accessor :autoloaded_constants
    mattr_accessor :explicitly_unloadable_constants
    mattr_accessor :constant_watch_stack
    mattr_accessor :constant_watch_stack_mutex
  end
end
</code></pre>
</div>
<p><code>active_support/core_ext/module/attribute_accessors.rb</code>.</p><h4 id="parents"><a class="anchorlink" href="#parents">4.2 Parents</a></h4><h5 id="module-parent"><a class="anchorlink" href="#module-parent">4.2.1 <code>module_parent</code></a></h5><p>El método <code>module_parent</code> en un módulo con nombre anidado devuelve el módulo que contiene su constante correspondiente:</p><div class="code_container">
<pre><code class="language-ruby">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent # =&gt; X::Y
M.module_parent       # =&gt; X::Y
</code></pre>
</div>
<p>Si el módulo es anónimo o pertenece al nivel superior, <code>module_parent</code> devuelve <code>Object</code>.</p><div class="warning"><p>Tenga en cuenta que en ese caso <code>module_parent_name</code> devuelve <code>nil</code>.</p></div><div class="note"><p>Definido en  <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h5 id="module-parent-name"><a class="anchorlink" href="#module-parent-name">4.2.2 <code>module_parent_name</code></a></h5><p>El método <code>module_parent_name</code> en un módulo con nombre anidado devuelve el nombre completo del módulo que contiene su constante correspondiente:</p><div class="code_container">
<pre><code class="language-ruby">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent_name # =&gt; "X::Y"
M.module_parent_name       # =&gt; "X::Y"
</code></pre>
</div>
<p>Para módulos anónimos o de nivel superior, <code>module_parent_name</code> devuelve <code>nil</code>.</p><div class="warning"><p>Tenga en cuenta que en ese caso <code>module_parent</code> devuelve <code>Object</code>.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h5 id="module-parents"><a class="anchorlink" href="#module-parents">4.2.3 <code>module_parents</code></a></h5><p>El método <code>module_parents</code> llama a <code>module_parent</code> en el receptor y hacia arriba hasta que se alcanza el <code>Object</code>. La cadena se devuelve en una matriz, de abajo hacia arriba:</p><div class="code_container">
<pre><code class="language-ruby">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parents # =&gt; [X::Y, X, Object]
M.module_parents       # =&gt; [X::Y, X, Object]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h4 id="anonymous"><a class="anchorlink" href="#anonymous">4.3 Anonymous</a></h4><p>Un módulo puede tener o no un nombre:</p><div class="code_container">
<pre><code class="language-ruby">module M
end
M.name # =&gt; "M"

N = Module.new
N.name # =&gt; "N"

Module.new.name # =&gt; nil
</code></pre>
</div>
<p>Puede comprobar si un módulo tiene un nombre con el predicado <code>anonymous?</code>:</p><div class="code_container">
<pre><code class="language-ruby">module M
end
M.anonymous? # =&gt; false

Module.new.anonymous? # =&gt; true
</code></pre>
</div>
<p>Tenga en cuenta que ser inalcanzable no implica ser anónimo:</p><div class="code_container">
<pre><code class="language-ruby">module M
end

m = Object.send(:remove_const, :M)

m.anonymous? # =&gt; false
</code></pre>
</div>
<p>aunque un módulo anónimo es inalcanzable por definición.</p><div class="note"><p>Definido en <code>active_support/core_ext/module/anonymous.rb</code>.</p></div><h4 id="method-delegation"><a class="anchorlink" href="#method-delegation">4.4 Method Delegation</a></h4><h5 id="delegate"><a class="anchorlink" href="#delegate">4.4.1 <code>delegate</code></a></h5><p>La macro <code>delegate</code> ofrece una manera fácil de reenviar métodos.</p><p>Imaginemos que los usuarios de alguna aplicación tienen información de inicio de sesión en el modelo <code>User</code>, pero el nombre y otros datos en un modelo <code>Profile</code> separado:</p><div class="code_container">
<pre><code class="language-ruby">class User &lt; ApplicationRecord
  has_one :profile
end
</code></pre>
</div>
<p>Con esa configuración, obtienes el nombre de un usuario a través de su perfil, <code>user.profile.name</code>, pero podría ser útil poder acceder a dicho atributo directamente:</p><div class="code_container">
<pre><code class="language-ruby">class User &lt; ApplicationRecord
  has_one :profile

  def name
    profile.name
  end
end
</code></pre>
</div>
<p>Eso es lo que <code>delegate</code> hace por ti:</p><div class="code_container">
<pre><code class="language-ruby">class User &lt; ApplicationRecord
  has_one :profile

  delegate :name, to: :profile
end
</code></pre>
</div>
<p>Es más corto y la intención más obvia.</p><p>El método debe ser público en el destino.</p><p>La macro <code>delegate</code> acepta varios métodos:</p><div class="code_container">
<pre><code class="language-ruby">delegate :name, :age, :address, :twitter, to: :profile
</code></pre>
</div>
<p>Cuando se interpola en una cadena, la opción <code>:to</code> debería convertirse en una expresión que evalúe el objeto al que se delega el método. Normalmente una cadena o un símbolo. Tal expresión se evalúa en el contexto del receptor:</p><div class="code_container">
<pre><code class="language-ruby"># delegates to the Rails constant
delegate :logger, to: :Rails

# delegates to the receiver's class
delegate :table_name, to: :class
</code></pre>
</div>
<div class="warning"><p>Si la opción <code>:prefix</code> es <code>true</code>, esto es menos genérico, ver más abajo.</p></div><p>De forma predeterminada, si la delegación genera "NoMethodError" y el objetivo es "nil", la excepción se propaga. Puede pedir que se devuelva <code>nil</code> en su lugar con la opción <code>:allow_nil</code>:</p><div class="code_container">
<pre><code class="language-ruby">delegate :name, to: :profile, allow_nil: true
</code></pre>
</div>
<p>Con <code>:allow_nil</code> la llamada <code>user.name</code> devuelve <code>nil</code> si el usuario no tiene perfil.</p><p>La opción <code>:prefix</code> agrega un prefijo al nombre del método generado. Esto puede ser útil, por ejemplo, para obtener un mejor nombre:</p><div class="code_container">
<pre><code class="language-ruby">delegate :street, to: :address, prefix: true
</code></pre>
</div>
<p>El ejemplo anterior genera <code>address_street</code> en lugar de <code>street</code>.</p><div class="warning"><p>Dado que en este caso el nombre del método generado está compuesto por el objeto de destino y los nombres del método de destino, la opción <code>: to</code> debe ser un nombre de método.</p></div><p>También se puede configurar un prefijo personalizado:</p><div class="code_container">
<pre><code class="language-ruby">delegate :size, to: :attachment, prefix: :avatar
</code></pre>
</div>
<p>En el ejemplo anterior, la macro genera <code>avatar_size</code> en lugar de <code>size</code>.</p><p>La opción <code>:private</code> cambia el alcance de los métodos:</p><div class="code_container">
<pre><code class="language-ruby">delegate :date_of_birth, to: :profile, private: true
</code></pre>
</div>
<p>Los métodos delegados son públicos de forma predeterminada. Pase <code>private: true</code> para cambiar eso.</p><div class="note"><p>Definido en <code>active_support/core_ext/module/delegation.rb</code></p></div><h5 id="delegate-missing-to"><a class="anchorlink" href="#delegate-missing-to">4.4.2 <code>delegate_missing_to</code></a></h5><p>Imagina que te gustaría delegar todo lo que falta en el objeto <code>User</code>,
al de <code>Profile</code>. La macro <code>delegate_missing_to</code> le permite implementar esto
en una brisa:</p><div class="code_container">
<pre><code class="language-ruby">class User &lt; ApplicationRecord
  has_one :profile

  delegate_missing_to :profile
end
</code></pre>
</div>
<p>El objetivo puede ser cualquier cosa invocable dentro del objeto, p. Ej. variables de instancia,
métodos, constantes, etc. Sólo se delegan los métodos públicos del objetivo.</p><div class="note"><p>Definido en <code>active_support/core_ext/module/delegation.rb</code>.</p></div><h4 id="redefining-methods"><a class="anchorlink" href="#redefining-methods">4.5 Redefining Methods</a></h4><p>Hay casos en los que necesitas definir un método con <code>define_method</code>, pero no sabes si ya existe un método con ese nombre. Si es así, se emite una advertencia si están habilitados. No es gran cosa, pero tampoco limpia.</p><p>El método <code>redefine_method</code> previene tal advertencia potencial, eliminando el método existente antes si es necesario.</p><p>También puede usar <code>silent_redefinition_of_method</code> si necesita definir
el método de reemplazo usted mismo (porque está usando <code>delegate</code>, para
ejemplo).</p><div class="note"><p>Definido en <code>active_support/core_ext/module/redefine_method.rb</code>.</p></div><h3 id="extensions-to-class"><a class="anchorlink" href="#extensions-to-class">5 Extensions to <code>Class</code></a></h3><h4 id="class-attributes"><a class="anchorlink" href="#class-attributes">5.1 Class Attributes</a></h4><h5 id="class-attribute"><a class="anchorlink" href="#class-attribute">5.1.1 <code>class_attribute</code></a></h5><p>El método <code>class_attribute</code> declara uno o más atributos de clase heredables que pueden anularse en cualquier nivel de la jerarquía.</p><div class="code_container">
<pre><code class="language-ruby">class A
  class_attribute :x
end

class B &lt; A; end

class C &lt; B; end

A.x = :a
B.x # =&gt; :a
C.x # =&gt; :a

B.x = :b
A.x # =&gt; :a
C.x # =&gt; :b

C.x = :c
A.x # =&gt; :a
B.x # =&gt; :b
</code></pre>
</div>
<p>Por ejemplo, <code>ActionMailer::Base</code> define:</p><div class="code_container">
<pre><code class="language-ruby">class_attribute :default_params
self.default_params = {
  mime_version: "1.0",
  charset: "UTF-8",
  content_type: "text/plain",
  parts_order: [ "text/plain", "text/enriched", "text/html" ]
}.freeze
</code></pre>
</div>
<p>También se puede acceder a ellos y anularlos a nivel de instancia.</p><div class="code_container">
<pre><code class="language-ruby">A.x = 1

a1 = A.new
a2 = A.new
a2.x = 2

a1.x # =&gt; 1, comes from A
a2.x # =&gt; 2, overridden in a2
</code></pre>
</div>
<p>La generación del método de instancia de escritor se puede evitar configurando la opción <code>:instance_writer</code> en <code>false</code>.</p><div class="code_container">
<pre><code class="language-ruby">module ActiveRecord
  class Base
    class_attribute :table_name_prefix, instance_writer: false, default: "my"
  end
end
</code></pre>
</div>
<p>Un modelo puede encontrar esa opción útil como una forma de evitar que la asignación masiva establezca el atributo.</p><p>La generación del método de la instancia del lector puede evitarse configurando la opción <code>:instance_reader</code> en <code>false</code>.</p><div class="code_container">
<pre><code class="language-ruby">class A
  class_attribute :x, instance_reader: false
end

A.new.x = 1
A.new.x # NoMethodError
</code></pre>
</div>
<p>Por conveniencia, <code>class_attribute</code> también define un predicado de instancia que es la doble negación de lo que devuelve el lector de instancias. En los ejemplos anteriores se llamaría <code>x?</code>.</p><p>Cuando <code>:instance_reader</code> es <code>false</code>, el predicado de instancia devuelve un <code>NoMethodError</code> al igual que el método reader.</p><p>Si no desea el predicado de instancia, pase <code>instance_predicate: false</code> y no se definirá.</p><div class="note"><p>Definido en  <code>active_support/core_ext/class/attribute.rb</code>.</p></div><h5 id="cattr-reader-cattr-writer-and-cattr-accessor"><a class="anchorlink" href="#cattr-reader-cattr-writer-and-cattr-accessor">5.1.2 <code>cattr_reader</code>, <code>cattr_writer</code>, and <code>cattr_accessor</code></a></h5><p>Las macros <code>cattr_reader</code>,<code>cattr_writer</code> y <code>cattr_accessor</code> son análogas a sus contrapartes<code>attr_ *</code>pero para clases. Inicializan una variable de clase en <code>nil</code> a menos que ya exista, y generan los métodos de clase correspondientes para acceder a ella:</p><div class="code_container">
<pre><code class="language-ruby">class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans.
  cattr_accessor :emulate_booleans
end
</code></pre>
</div>
<p>Además, puede pasar un bloque a <code>cattr_ *</code> para configurar el atributo con un valor predeterminado:</p><div class="code_container">
<pre><code class="language-ruby">class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans with default value of true.
  cattr_accessor :emulate_booleans, default: true
end
</code></pre>
</div>
<p>Los métodos de instancia también se crean por conveniencia, son solo sustitutos del atributo de clase. Por lo tanto, las instancias pueden cambiar el atributo de clase, pero no pueden anularlo como sucede con <code>class_attribute</code> (ver más arriba). Por ejemplo dado</p><div class="code_container">
<pre><code class="language-ruby">module ActionView
  class Base
    cattr_accessor :field_error_proc, default: Proc.new { ... }
  end
end
</code></pre>
</div>
<p>podemos acceder a <code>field_error_proc</code> en las vistas.</p><p>La generación del método de instancia del lector se puede evitar configurando <code>:instance_reader</code> en <code>false</code> y la generación del método de instancia del escritor se puede evitar configurando <code>:instance_writer</code> en <code>false</code>. La generación de ambos métodos se puede evitar configurando <code>:instance_accessor</code> en <code>false</code>. En todos los casos, el valor debe ser exactamente <code>false</code> y no ningún valor falso.</p><div class="code_container">
<pre><code class="language-ruby">module A
  class B
    # No first_name instance reader is generated.
    cattr_accessor :first_name, instance_reader: false
    # No last_name= instance writer is generated.
    cattr_accessor :last_name, instance_writer: false
    # No surname instance reader or surname= writer is generated.
    cattr_accessor :surname, instance_accessor: false
  end
end
</code></pre>
</div>
<p>Un modelo puede encontrar útil establecer <code>:instance_accessor</code> en <code>false</code> como una forma de evitar que la asignación masiva establezca el atributo.</p><div class="note"><p>Definido en <code>active_support/core_ext/module/attribute_accessors.rb</code>.</p></div><h4 id="subclasses-descendants"><a class="anchorlink" href="#subclasses-descendants">5.2 Subclasses &amp; Descendants</a></h4><h5 id="subclasses"><a class="anchorlink" href="#subclasses">5.2.1 <code>subclasses</code></a></h5><p>El método <code>subclasses</code> devuelve las subclases del receptor:</p><div class="code_container">
<pre><code class="language-ruby">class C; end
C.subclasses # =&gt; []

class B &lt; C; end
C.subclasses # =&gt; [B]

class A &lt; B; end
C.subclasses # =&gt; [B]

class D &lt; C; end
C.subclasses # =&gt; [B, D]
</code></pre>
</div>
<p>El orden en el que se devuelven estas clases no se especifica.</p><div class="note"><p>Definido en <code>active_support/core_ext/class/subclasses.rb</code>.</p></div><h5 id="descendants"><a class="anchorlink" href="#descendants">5.2.2 <code>descendants</code></a></h5><p>El método <code>descendants</code> devuelve todas las clases que son<code>&lt;</code>que su receptor:</p><div class="code_container">
<pre><code class="language-ruby">class C; end
C.descendants # =&gt; []

class B &lt; C; end
C.descendants # =&gt; [B]

class A &lt; B; end
C.descendants # =&gt; [B, A]

class D &lt; C; end
C.descendants # =&gt; [B, A, D]
</code></pre>
</div>
<p>El orden en el que se devuelven estas clases no se especifica.</p><div class="note"><p>Definido en <code>active_support/core_ext/class/subclasses.rb</code>.</p></div><h3 id="extensions-to-string"><a class="anchorlink" href="#extensions-to-string">6 Extensions to <code>String</code></a></h3><h4 id="output-safety"><a class="anchorlink" href="#output-safety">6.1 Output Safety</a></h4><h5 id="motivation"><a class="anchorlink" href="#motivation">6.1.1 Motivation</a></h5><p>Insertar datos en plantillas HTML requiere un cuidado especial. Por ejemplo, no puede simplemente interpolar <code>@review.title</code> literalmente en una página HTML. Por un lado, si el título de la reseña es "Flanagan &amp; Matz rules!" la salida no estará bien formada porque un ampersand debe escaparse como "&amp;amp;". Además, dependiendo de la aplicación, eso puede ser un gran agujero de seguridad porque los usuarios pueden inyectar HTML malicioso configurando un título de revisión hecho a mano. Consulte la sección sobre secuencias de comandos entre sitios en la <a href="security.html#cross-site-scripting-xss">Security guide</a> para obtener más información sobre los riesgos.</p><h5 id="safe-strings"><a class="anchorlink" href="#safe-strings">6.1.2 Safe Strings</a></h5><p>Active Support tiene el concepto de <em>(html) safe</em> strings. Una cadena segura es aquella que está marcada como insertable en HTML tal cual. Es de confianza, sin importar si se ha escapado o no.</p><p>Las cadenas se consideran <em>inseguras</em> por defecto:</p><div class="code_container">
<pre><code class="language-ruby">"".html_safe? # =&gt; false
</code></pre>
</div>
<p>Puede obtener una cadena segura de una determinada con el método <code>html_safe</code>:</p><div class="code_container">
<pre><code class="language-ruby">s = "".html_safe
s.html_safe? # =&gt; true
</code></pre>
</div>
<p>Es importante entender que <code>html_safe</code> no realiza ningún tipo de escape, es solo una afirmación:</p><div class="code_container">
<pre><code class="language-ruby">s = "&lt;script&gt;...&lt;/script&gt;".html_safe
s.html_safe? # =&gt; true
s            # =&gt; "&lt;script&gt;...&lt;/script&gt;"
</code></pre>
</div>
<p>Es su responsabilidad asegurarse de que llamar a <code>html_safe</code> en una cadena en particular esté bien.</p><p>Si agrega una cadena segura, ya sea en el lugar con <code>concat</code>/<code>&lt;&lt;</code>, o con <code>+</code>, el resultado es una cadena segura. Se escapan los argumentos inseguros:</p><div class="code_container">
<pre><code class="language-ruby">"".html_safe + "&lt;" # =&gt; "&amp;lt;"
</code></pre>
</div>
<p>Los argumentos seguros se añaden directamente:</p><div class="code_container">
<pre><code class="language-ruby">"".html_safe + "&lt;".html_safe # =&gt; "&lt;"
</code></pre>
</div>
<p>Estos métodos no deben utilizarse en vistas normales. Los valores no seguros se escapan automáticamente:</p><div class="code_container">
<pre><code class="language-erb">&lt;%= @review.title %&gt; &lt;%# fine, escaped if needed %&gt;
</code></pre>
</div>
<p>Para insertar algo textualmente use el ayudante <code>raw</code> en lugar de llamar a <code>html_safe</code>:</p><div class="code_container">
<pre><code class="language-erb">&lt;%= raw @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
</code></pre>
</div>
<p>o, de manera equivalente, use <code>&lt;%==</code>:</p><div class="code_container">
<pre><code class="language-erb">&lt;%== @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
</code></pre>
</div>
<p>El ayudante <code>raw</code> llama a <code>html_safe</code> para usted:</p><div class="code_container">
<pre><code class="language-ruby">def raw(stringish)
  stringish.to_s.html_safe
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/output_safety.rb</code>.</p></div><h4 id="transformation"><a class="anchorlink" href="#transformation">6.2 Transformation</a></h4><p>Como regla general, excepto quizás para la concatenación como se explicó anteriormente, cualquier método que pueda cambiar una cadena le da una cadena insegura. Estos son <code>downcase</code>,<code>gsub</code>, <code>strip</code>,<code>chomp</code>, <code>underscore</code>, etc.</p><p>En el caso de transformaciones in situ como <code>gsub!</code>, El receptor en sí se vuelve inseguro.</p><div class="info"><p>El bit de seguridad se pierde siempre, sin importar si la transformación realmente cambió algo.</p></div><h5 id="conversion-and-coercion"><a class="anchorlink" href="#conversion-and-coercion">6.2.1 Conversion and Coercion</a></h5><p>Llamar a <code>to_s</code> en una cadena segura devuelve una cadena segura, pero la coerción con <code>to_str</code> devuelve una cadena insegura.</p><h5 id="copying"><a class="anchorlink" href="#copying">6.2.2 Copying</a></h5><p>Llamar a <code>dup</code> o <code>clone</code> en cadenas seguras produce cadenas seguras.</p><h4 id="remove"><a class="anchorlink" href="#remove">6.3 <code>remove</code></a></h4><p>El método <code>remove</code> eliminará todas las apariciones del patrón:</p><div class="code_container">
<pre><code class="language-ruby">"Hello World".remove(/Hello /) # =&gt; "World"
</code></pre>
</div>
<p>También existe la versión destructiva <code>String#remove!</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="squish"><a class="anchorlink" href="#squish">6.4 <code>squish</code></a></h4><p>El método <code>squish</code> elimina los espacios en blanco iniciales y finales, y sustituye los espacios en blanco con un solo espacio cada uno:</p><div class="code_container">
<pre><code class="language-ruby">" \n  foo\n\r \t bar \n".squish # =&gt; "foo bar"
</code></pre>
</div>
<p>También existe la versión destructiva <code>String#squish!</code>.</p><p>Tenga en cuenta que maneja espacios en blanco ASCII y Unicode.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="truncate"><a class="anchorlink" href="#truncate">6.5 <code>truncate</code></a></h4><p>El método <code>truncate</code> devuelve una copia de su receptor truncado después de una <code>length</code> dada:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate(20)
# =&gt; "Oh dear! Oh dear!..."
</code></pre>
</div>
<p>La elipsis se puede personalizar con la opción <code>:omission</code>:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate(20, omission: '&amp;hellip;')
# =&gt; "Oh dear! Oh &amp;hellip;"
</code></pre>
</div>
<p>Tenga en cuenta en particular que el truncamiento tiene en cuenta la longitud de la cadena de omisión.</p><p>Pase un <code>:separator</code> para truncar la cadena en un salto natural:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate(18)
# =&gt; "Oh dear! Oh dea..."
"Oh dear! Oh dear! I shall be late!".truncate(18, separator: ' ')
# =&gt; "Oh dear! Oh..."
</code></pre>
</div>
<p>La opción <code>:separator</code> puede ser una expresión regular:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate(18, separator: /\s/)
# =&gt; "Oh dear! Oh..."
</code></pre>
</div>
<p>En los ejemplos anteriores, "dear" se corta primero, pero luego <code>:separator</code> lo impide.</p><h4 id="truncate-bytes"><a class="anchorlink" href="#truncate-bytes">6.6 <code>truncate_bytes</code></a></h4><p>El método <code>truncate_bytes</code> devuelve una copia de su receptor truncado como máximo en bytes de <code>bytesize</code>:</p><div class="code_container">
<pre><code class="language-ruby">"👍👍👍👍".truncate_bytes(15)
# =&gt; "👍👍👍…"
</code></pre>
</div>
<p>La elipsis se puede personalizar con la opción <code>: omission</code>:</p><div class="code_container">
<pre><code class="language-ruby">"👍👍👍👍".truncate_bytes(15, omission: "🖖")
# =&gt; "👍👍🖖"
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="truncate-words"><a class="anchorlink" href="#truncate-words">6.7 <code>truncate_words</code></a></h4><p>El método <code>truncate_words</code> devuelve una copia de su receptor truncado después de un número determinado de palabras:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate_words(4)
# =&gt; "Oh dear! Oh dear!..."
</code></pre>
</div>
<p>La elipsis se puede personalizar con la opción <code>:omission</code>:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate_words(4, omission: '&amp;hellip;')
# =&gt; "Oh dear! Oh dear!&amp;hellip;"
</code></pre>
</div>
<p>Pase un <code>:separator</code> para truncar la cadena en un salto natural:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate_words(3, separator: '!')
# =&gt; "Oh dear! Oh dear! I shall be late..."
</code></pre>
</div>
<p>La opción <code>:separator</code> puede ser una expresión regular:</p><div class="code_container">
<pre><code class="language-ruby">"Oh dear! Oh dear! I shall be late!".truncate_words(4, separator: /\s/)
# =&gt; "Oh dear! Oh dear!..."
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id="inquiry"><a class="anchorlink" href="#inquiry">6.8 <code>inquiry</code></a></h4><p>El método <code>query</code> convierte una cadena en un objeto <code>StringInquirer</code> haciendo más bonitas las verificaciones de igualdad.</p><div class="code_container">
<pre><code class="language-ruby">"production".inquiry.production? # =&gt; true
"active".inquiry.inactive?       # =&gt; false
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/query.rb</code>.</p></div><h4 id="extensions-to-string-starts-with-questionmark-and-ends-with-questionmark"><a class="anchorlink" href="#extensions-to-string-starts-with-questionmark-and-ends-with-questionmark">6.9 <code>starts_with?</code> and <code>ends_with?</code></a></h4><p>Active Support define los alias en tercera persona de <code>String#start_with?</code> y <code>String#end_with?</code>:</p><div class="code_container">
<pre><code class="language-ruby">"foo".starts_with?("f") # =&gt; true
"foo".ends_with?("o")   # =&gt; true
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/starts_ends_with.rb</code>.</p></div><h4 id="strip-heredoc"><a class="anchorlink" href="#strip-heredoc">6.10 <code>strip_heredoc</code></a></h4><p>El método <code>strip_heredoc</code> elimina la sangría en heredocs.</p><p>Por ejemplo en</p><div class="code_container">
<pre><code class="language-ruby">if options[:usage]
  puts &lt;&lt;-USAGE.strip_heredoc
    This command does such and such.

    Supported options are:
      -h         This message
      ...
  USAGE
end
</code></pre>
</div>
<p>el usuario vería el mensaje de uso alineado con el margen izquierdo.</p><p>Técnicamente, busca la línea con menos sangría en toda la cadena y elimina
esa cantidad de espacios en blanco iniciales.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/strip.rb</code>.</p></div><p> ### <code>indent</code></p><p>Sangra las líneas en el receptor:</p><div class="code_container">
<pre><code class="language-ruby">&lt;&lt;EOS.indent(2)
def some_method
  some_code
end
EOS
# =&gt;
  def some_method
    some_code
  end
</code></pre>
</div>
<p>El segundo argumento, <code>indent_string</code>, especifica qué cadena de sangría usar. El valor predeterminado es <code>nil</code>, que le dice al método que haga una conjetura educada mirando la primera línea con sangría, y retroceda a un espacio si no hay ninguno.</p><div class="code_container">
<pre><code class="language-ruby">"  foo".indent(2)        # =&gt; "    foo"
"foo\n\t\tbar".indent(2) # =&gt; "\t\tfoo\n\t\t\t\tbar"
"foo".indent(2, "\t")    # =&gt; "\t\tfoo"
</code></pre>
</div>
<p>Si bien <code>indent_string</code> suele ser un espacio o tabulación, puede ser cualquier cadena.</p><p>El tercer argumento, <code>indent_empty_lines</code>, es una bandera que indica si las líneas vacías deben tener sangría. El valor predeterminado es falso.</p><div class="code_container">
<pre><code class="language-ruby">"foo\n\nbar".indent(2)            # =&gt; "  foo\n\n  bar"
"foo\n\nbar".indent(2, nil, true) # =&gt; "  foo\n  \n  bar"
</code></pre>
</div>
<p>El método <code>indent!</code> Realiza la sangría en el lugar.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/indent.rb</code>.</p></div><h4 id="access"><a class="anchorlink" href="#access">6.11 Access</a></h4><h5 id="at-position"><a class="anchorlink" href="#at-position">6.11.1 <code>at(position)</code></a></h5><p>Devuelve el carácter de la cadena en la posición <code>position</code>:</p><div class="code_container">
<pre><code class="language-ruby">"hello".at(0)  # =&gt; "h"
"hello".at(4)  # =&gt; "o"
"hello".at(-1) # =&gt; "o"
"hello".at(10) # =&gt; nil
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id="from-position"><a class="anchorlink" href="#from-position">6.11.2 <code>from(position)</code></a></h5><p>Devuelve la subcadena de la cadena que comienza en la posición <code>position</code>:</p><div class="code_container">
<pre><code class="language-ruby">"hello".from(0)  # =&gt; "hello"
"hello".from(2)  # =&gt; "llo"
"hello".from(-2) # =&gt; "lo"
"hello".from(10) # =&gt; nil
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/access.rb</code>.</p></div><p> #### <code>to(position)</code></p><p>Devuelve la subcadena de la cadena hasta la posición <code>position</code>:</p><div class="code_container">
<pre><code class="language-ruby">"hello".to(0)  # =&gt; "h"
"hello".to(2)  # =&gt; "hel"
"hello".to(-2) # =&gt; "hell"
"hello".to(10) # =&gt; "hello"
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id="first-limit-1"><a class="anchorlink" href="#first-limit-1">6.11.3 <code>first(limit = 1)</code></a></h5><p>La llamada <code>str.first(n)</code> es equivalente a <code>str.to(n-1)</code> si <code>n</code> &gt; 0, y devuelve una cadena vacía para<code>n</code> == 0.</p><p>NOTA: Definido en <code>active_support/core_ext/string/access.rb</code>.</p><h5 id="last-limit-1"><a class="anchorlink" href="#last-limit-1">6.11.4 <code>last(limit = 1)</code></a></h5><p>La llamada <code>str.last (n)</code> es equivalente a <code>str.from (-n)</code> si <code>n</code>&gt; 0, y devuelve una cadena vacía para<code>n</code> == 0.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/access.rb</code>.</p></div><h4 id="inflections"><a class="anchorlink" href="#inflections">6.12 Inflections</a></h4><h5 id="pluralize"><a class="anchorlink" href="#pluralize">6.12.1 <code>pluralize</code></a></h5><p>El método <code>pluralize</code> devuelve el plural de su receptor:</p><div class="code_container">
<pre><code class="language-ruby">"table".pluralize     # =&gt; "tables"
"ruby".pluralize      # =&gt; "rubies"
"equipment".pluralize # =&gt; "equipment"
</code></pre>
</div>
<p>Como muestra el ejemplo anterior, Active Support conoce algunos plurales irregulares y sustantivos incontables. Las reglas integradas se pueden ampliar en <code>config/initializers/inflections.rb</code>. Este archivo es generado por defecto por el comando <code>rails new</code> y tiene instrucciones en los comentarios.</p><p><code>pluralize</code> también puede tomar un parámetro opcional <code>count</code>. Si <code>count == 1</code> se devolverá la forma singular. Para cualquier otro valor de <code>count</code> se devolverá la forma plural:</p><div class="code_container">
<pre><code class="language-ruby">"dude".pluralize(0) # =&gt; "dudes"
"dude".pluralize(1) # =&gt; "dude"
"dude".pluralize(2) # =&gt; "dudes"
</code></pre>
</div>
<p>Active Record utiliza este método para calcular el nombre de tabla predeterminado que corresponde a un modelo:</p><div class="code_container">
<pre><code class="language-ruby"># active_record/model_schema.rb
def undecorated_table_name(class_name = base_class.name)
  table_name = class_name.to_s.demodulize.underscore
  pluralize_table_names ? table_name.pluralize : table_name
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="singularize"><a class="anchorlink" href="#singularize">6.12.2 <code>singularize</code></a></h5><p>El inverso de <code>pluralize</code>:</p><div class="code_container">
<pre><code class="language-ruby">"tables".singularize    # =&gt; "table"
"rubies".singularize    # =&gt; "ruby"
"equipment".singularize # =&gt; "equipment"
</code></pre>
</div>
<p>Las asociaciones calculan el nombre de la clase asociada predeterminada correspondiente utilizando este método:</p><div class="code_container">
<pre><code class="language-ruby"># active_record/reflection.rb
def derive_class_name
  class_name = name.to_s.camelize
  class_name = class_name.singularize if collection?
  class_name
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="camelize"><a class="anchorlink" href="#camelize">6.12.3 <code>camelize</code></a></h5><p>El método <code>camelize</code> devuelve su receptor en caso de camello:</p><div class="code_container">
<pre><code class="language-ruby">"product".camelize    # =&gt; "Product"
"admin_user".camelize # =&gt; "AdminUser"
</code></pre>
</div>
<p>Como regla general, puede pensar en este método como el que transforma las rutas en nombres de módulos o clases Ruby, donde se cortan espacios de nombres separados:</p><div class="code_container">
<pre><code class="language-ruby">"backoffice/session".camelize # =&gt; "Backoffice::Session"
</code></pre>
</div>
<p>Por ejemplo, Action Pack usa este método para cargar la clase que proporciona una determinada tienda de sesión:</p><div class="code_container">
<pre><code class="language-ruby"># action_controller/metal/session_management.rb
def session_store=(store)
  @@session_store = store.is_a?(Symbol) ?
    ActionDispatch::Session.const_get(store.to_s.camelize) :
    store
end
</code></pre>
</div>
<p><code>camelize</code> acepta un argumento opcional, que puede ser<code>:upper</code> (predeterminado) o <code>:lower</code>. Con este último la primera letra se vuelve minúscula:</p><div class="code_container">
<pre><code class="language-ruby">"visual_effect".camelize(:lower) # =&gt; "visualEffect"
</code></pre>
</div>
<p>Eso puede ser útil para calcular nombres de métodos en un lenguaje que siga esa convención, por ejemplo JavaScript.</p><div class="info"><p>Como regla general, puede pensar en <code>camelize</code> como el inverso de <code>undercore</code>, aunque hay casos en los que eso no se cumple: <code>" SSLError ".underscore.camelize</code> devuelve<code>"SslError"</code>. Para apoyar casos como este, Active Support le permite especificar acrónimos en <code>config/initializers/inflections.rb</code>:</p></div><div class="code_container">
<pre><code class="language-ruby">ActiveSupport::Inflector.inflections do |inflect|
  inflect.acronym 'SSL'
end

"SSLError".underscore.camelize # =&gt; "SSLError"
</code></pre>
</div>
<p><code>camelize</code> tiene el alias de <code>camelcase</code>.</p><div class="note"><p>Definido en  <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="underscore"><a class="anchorlink" href="#underscore">6.12.4 <code>underscore</code></a></h5><p>El método <code>underscore</code> va al revés, desde el caso del camello hasta las rutas:</p><div class="code_container">
<pre><code class="language-ruby">"Product".underscore   # =&gt; "product"
"AdminUser".underscore # =&gt; "admin_user"
</code></pre>
</div>
<p>También convierte "::" a "/":</p><div class="code_container">
<pre><code class="language-ruby">"Backoffice::Session".underscore # =&gt; "backoffice/session"
</code></pre>
</div>
<p>y entiende cadenas que comienzan con minúsculas:</p><div class="code_container">
<pre><code class="language-ruby">"visualEffect".underscore # =&gt; "visual_effect"
</code></pre>
</div>
<p>Sin embargo, el <code>underscore</code> no acepta ningún argumento.</p><p>La carga automática de módulos y clases de Rails utiliza un guión bajo para inferir la ruta relativa sin extensión de un archivo que definiría una constante faltante dada:</p><div class="code_container">
<pre><code class="language-ruby"># active_support/dependencies.rb
def load_missing_constant(from_mod, const_name)
  ...
  qualified_name = qualified_name_for from_mod, const_name
  path_suffix = qualified_name.underscore
  ...
end
</code></pre>
</div>
<div class="info"><p>Como regla general, puede pensar en <code>underscore</code> como el inverso de <code>camelize</code>, aunque hay casos en los que eso no se cumple. Por ejemplo, <code>" SSLError ".underscore.camelize</code> devuelve<code>"SslError"</code>.</p></div><p>NOTA: Definido en<code>active_support/core_ext/string/inflections.rb</code>.</p><h5 id="titleize"><a class="anchorlink" href="#titleize">6.12.5 <code>titleize</code></a></h5><p>El método <code>titleize</code> capitaliza las palabras en el receptor:</p><div class="code_container">
<pre><code class="language-ruby">"alice in wonderland".titleize # =&gt; "Alice In Wonderland"
"fermat's enigma".titleize     # =&gt; "Fermat's Enigma"
</code></pre>
</div>
<p><code>titleize</code> tiene el alias de <code>titlecase</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="dasherize"><a class="anchorlink" href="#dasherize">6.12.6 <code>dasherize</code></a></h5><p>El método <code>dasherize</code> reemplaza los guiones bajos en el receptor con guiones:</p><div class="code_container">
<pre><code class="language-ruby">"name".dasherize         # =&gt; "name"
"contact_data".dasherize # =&gt; "contact-data"
</code></pre>
</div>
<p>El serializador XML de modelos utiliza este método para dividir los nombres de los nodos:</p><div class="code_container">
<pre><code class="language-ruby"># active_model/serializers/xml.rb
def reformat_name(name)
  name = name.camelize if camelize?
  dasherize? ? name.dasherize : name
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="demodulize"><a class="anchorlink" href="#demodulize">6.12.7 <code>demodulize</code></a></h5><p>Given a string with a qualified constant name, <code>demodulize</code> returns the very constant name, that is, the rightmost part of it:</p><div class="code_container">
<pre><code class="language-ruby">"Product".demodulize                        # =&gt; "Product"
"Backoffice::UsersController".demodulize    # =&gt; "UsersController"
"Admin::Hotel::ReservationUtils".demodulize # =&gt; "ReservationUtils"
"::Inflections".demodulize                  # =&gt; "Inflections"
"".demodulize                               # =&gt; ""

</code></pre>
</div>
<p>Active Record, por ejemplo, utiliza este método para calcular el nombre de una columna de caché de contador:</p><div class="code_container">
<pre><code class="language-ruby"># active_record/reflection.rb
def counter_cache_column
  if options[:counter_cache] == true
    "#{active_record.name.demodulize.underscore.pluralize}_count"
  elsif options[:counter_cache]
    options[:counter_cache]
  end
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="deconstantize"><a class="anchorlink" href="#deconstantize">6.12.8 <code>deconstantize</code></a></h5><p>Dada una cadena con una expresión de referencia constante calificada, <code>deconstantize</code> elimina el segmento más a la derecha, generalmente dejando el nombre del contenedor de la constante:</p><div class="code_container">
<pre><code class="language-ruby">"Product".deconstantize                        # =&gt; ""
"Backoffice::UsersController".deconstantize    # =&gt; "Backoffice"
"Admin::Hotel::ReservationUtils".deconstantize # =&gt; "Admin::Hotel"
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="parameterize"><a class="anchorlink" href="#parameterize">6.12.9 <code>parameterize</code></a></h5><p>El método <code>parameterize</code> normaliza su receptor de una forma que se puede utilizar en URL bonitas.</p><div class="code_container">
<pre><code class="language-ruby">"John Smith".parameterize # =&gt; "john-smith"
"Kurt Gödel".parameterize # =&gt; "kurt-godel"
</code></pre>
</div>
<p>Para preservar el caso de la cadena, establezca el argumento <code>preserve_case</code> en verdadero. De forma predeterminada, <code>preserve_case</code> se establece en falso.</p><div class="code_container">
<pre><code class="language-ruby">"John Smith".parameterize(preserve_case: true) # =&gt; "John-Smith"
"Kurt Gödel".parameterize(preserve_case: true) # =&gt; "Kurt-Godel"
</code></pre>
</div>
<p>Para usar un separador personalizado, anule el argumento <code>separator</code>.</p><div class="code_container">
<pre><code class="language-ruby">"John Smith".parameterize(separator: "_") # =&gt; "john\_smith"
"Kurt Gödel".parameterize(separator: "_") # =&gt; "kurt\_godel"
</code></pre>
</div>
<div class="note"><p>Definido en  <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="tableize"><a class="anchorlink" href="#tableize">6.12.10 <code>tableize</code></a></h5><p>El método <code>tableize</code> es<code>underscore</code> seguido de <code>pluralize</code>.</p><div class="code_container">
<pre><code class="language-ruby">"Person".tableize      # =&gt; "people"
"Invoice".tableize     # =&gt; "invoices"
"InvoiceLine".tableize # =&gt; "invoice_lines"
</code></pre>
</div>
<p>Como regla general, <code>tableize</code> devuelve el nombre de la tabla que corresponde a un modelo dado para casos simples. De hecho, la implementación real en Active Record no es un "tableize" directo, porque también demoduliza el nombre de la clase y verifica algunas opciones que pueden afectar la cadena devuelta.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="classify"><a class="anchorlink" href="#classify">6.12.11 <code>classify</code></a></h5><p>El método <code>classify</code> es el inverso de <code>tableize</code>. Te da el nombre de clase correspondiente al nombre de una tabla:</p><div class="code_container">
<pre><code class="language-ruby">"people".classify        # =&gt; "Person"
"invoices".classify      # =&gt; "Invoice"
"invoice_lines".classify # =&gt; "InvoiceLine"
</code></pre>
</div>
<p>El método comprende tabla calificada</p><div class="code_container">
<pre><code class="language-ruby">"highrise_production.companies".classify # =&gt; "Company"
</code></pre>
</div>
<p>Tenga en cuenta que <code>classify</code> devuelve un nombre de clase como una cadena. Puede obtener el objeto de clase real invocando <code>constantize</code>, explicado a continuación.</p><div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="constantize"><a class="anchorlink" href="#constantize">6.12.12 <code>constantize</code>~</a></h5><p>El método <code>constantize</code> resuelve la expresión de referencia constante en su receptor:</p><div class="code_container">
<pre><code class="language-ruby">"Integer".constantize # =&gt; Integer

module M
  X = 1
end
"M::X".constantize # =&gt; 1
</code></pre>
</div>
<p>Si la cadena no se evalúa como una constante conocida, o su contenido ni siquiera es un nombre de constante válido, <code>constantize</code> genera <code>NameError</code>.</p><p>La resolución constante de nombres por <code>constantize</code> comienza siempre en el <code>Object</code> de nivel superior, incluso si no hay un "::" inicial.</p><div class="code_container">
<pre><code class="language-ruby">X = :in_Object
module M
  X = :in_M

  X                 # =&gt; :in_M
  "::X".constantize # =&gt; :in_Object
  "X".constantize   # =&gt; :in_Object (!)
end
</code></pre>
</div>
<p>Entonces, en general, no es equivalente a lo que haría Ruby en el mismo lugar, si se evaluara una constante real.</p><p>Los casos de prueba de mailer obtienen el mailer que se está probando a partir del nombre de la clase de prueba usando <code>constantize</code>:</p><div class="code_container">
<pre><code class="language-ruby"># action_mailer/test_case.rb
def determine_default_mailer(name)
  name.sub(/Test$/, '').constantize
rescue NameError =&gt; e
  raise NonInferrableMailerError.new(name)
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="humanize"><a class="anchorlink" href="#humanize">6.12.13 <code>humanize</code></a></h5><p>El método <code>humanize</code> modifica un nombre de atributo para mostrarlo a los usuarios finales.</p><p>Específicamente realiza estas transformaciones:</p>
<ul>
<li>Aplica reglas de inflexión humana al argumento.</li>
<li>Elimina los guiones bajos iniciales, si los hay.</li>
<li>Elimina un sufijo "_id" si está presente.</li>
<li>Reemplaza los guiones bajos con espacios, si los hubiera.</li>
<li>Reduce todas las palabras excepto los acrónimos.</li>
<li>Capitaliza la primera palabra.</li>
</ul>
<p>La mayúscula de la primera palabra se puede desactivar configurando la
opción <code>:capitalize</code> en falso (el valor predeterminado es verdadero).</p><div class="code_container">
<pre><code class="language-ruby">"name".humanize                         # =&gt; "Name"
"author_id".humanize                    # =&gt; "Author"
"author_id".humanize(capitalize: false) # =&gt; "author"
"comments_count".humanize               # =&gt; "Comments count"
"_id".humanize                          # =&gt; "Id"
</code></pre>
</div>
<p>Si "SSL" se definió como un acrónimo:</p><div class="code_container">
<pre><code class="language-ruby">'ssl_error'.humanize # =&gt; "SSL error"
</code></pre>
</div>
<p>El método auxiliar <code>full_messages</code> usa <code>humanize</code> como alternativa para incluir
nombres de atributos:</p><div class="code_container">
<pre><code class="language-ruby">def full_messages
  map { |attribute, message| full_message(attribute, message) }
end

def full_message
  ...
  attr_name = attribute.to_s.tr('.', '_').humanize
  attr_name = @base.class.human_attribute_name(attribute, default: attr_name)
  ...
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id="foreign-key"><a class="anchorlink" href="#foreign-key">6.12.14 <code>foreign_key</code></a></h5><p>El método <code>foreign_key</code> da un nombre de columna de clave externa de un nombre de clase. Para hacerlo, demoduliza, subraya y agrega "_id":</p><div class="code_container">
<pre><code class="language-ruby">"User".foreign_key           # =&gt; "user_id"
"InvoiceLine".foreign_key    # =&gt; "invoice_line_id"
"Admin::Session".foreign_key # =&gt; "session_id"
</code></pre>
</div>
<p>Pase un argumento falso si no desea el guión bajo en "_id":</p><div class="code_container">
<pre><code class="language-ruby">"User".foreign_key(false) # =&gt; "userid"
</code></pre>
</div>
<p>Las asociaciones usan este método para inferir claves externas, por ejemplo, <code>has_one</code> y <code>has_many</code> hacen esto:</p><div class="code_container">
<pre><code class="language-ruby"># active_record/associations.rb
foreign_key = options[:foreign_key] || reflection.active_record.name.foreign_key
</code></pre>
</div>
<div class="note"><p>Definido en  <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h4 id="extensions-to-string-conversions"><a class="anchorlink" href="#extensions-to-string-conversions">6.13 Conversions</a></h4><h5 id="to-date-to-time-to-datetime"><a class="anchorlink" href="#to-date-to-time-to-datetime">6.13.1 <code>to_date</code>, <code>to_time</code>, <code>to_datetime</code></a></h5><p>Los métodos <code>to_date</code>, <code>to_time</code> y <code>to_datetime</code> son básicamente envoltorios de conveniencia alrededor de <code>Date._parse</code>:</p><div class="code_container">
<pre><code class="language-ruby">"2010-07-27".to_date              # =&gt; Tue, 27 Jul 2010
"2010-07-27 23:37:00".to_time     # =&gt; 2010-07-27 23:37:00 +0200
"2010-07-27 23:37:00".to_datetime # =&gt; Tue, 27 Jul 2010 23:37:00 +0000
</code></pre>
</div>
<p><code>to_time</code> recibe un argumento opcional<code>:utc</code> o <code>:local</code>, para indicar en qué zona horaria quieres la hora:</p><div class="code_container">
<pre><code class="language-ruby">"2010-07-27 23:42:00".to_time(:utc)   # =&gt; 2010-07-27 23:42:00 UTC
"2010-07-27 23:42:00".to_time(:local) # =&gt; 2010-07-27 23:42:00 +0200
</code></pre>
</div>
<p>El valor predeterminado es <code>:local</code>.</p><p>Consulte la documentación de <code>Date._parse</code> para obtener más detalles.</p><div class="info"><p>Los tres devuelven <code>nil</code> para los receptores en blanco.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/string/conversions.rb</code>.</p></div><h3 id="extensions-to-symbol"><a class="anchorlink" href="#extensions-to-symbol">7 Extensions to <code>Symbol</code></a></h3><h4 id="extensions-to-symbol-starts-with-questionmark-and-ends-with-questionmark"><a class="anchorlink" href="#extensions-to-symbol-starts-with-questionmark-and-ends-with-questionmark">7.1 <code>starts_with?</code> and <code>ends_with?</code></a></h4><p>Active Support define los alias en tercera persona de <code>Symbol#start_with?</code> y <code>Symbol#end_with?</code>:</p><div class="code_container">
<pre><code class="language-ruby">:foo.starts_with?("f") # =&gt; true
:foo.ends_with?("o")   # =&gt; true
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/symbol/starts_ends_with.rb</code>.</p></div><h3 id="extensions-to-numeric"><a class="anchorlink" href="#extensions-to-numeric">8 Extensions to <code>Numeric</code></a></h3><h4 id="bytes"><a class="anchorlink" href="#bytes">8.1 Bytes</a></h4><p>Todos los números responden a estos métodos:</p><div class="code_container">
<pre><code class="language-ruby">bytes
kilobytes
megabytes
gigabytes
terabytes
petabytes
exabytes
</code></pre>
</div>
<p>Devuelven la cantidad correspondiente de bytes, usando un factor de conversión de 1024:</p><div class="code_container">
<pre><code class="language-ruby">2.kilobytes   # =&gt; 2048
3.megabytes   # =&gt; 3145728
3.5.gigabytes # =&gt; 3758096384
-4.exabytes   # =&gt; -4611686018427387904
</code></pre>
</div>
<p>Las formas singulares tienen un alias para que pueda decir:</p><div class="code_container">
<pre><code class="language-ruby">1.megabyte # =&gt; 1048576
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/numeric/bytes.rb</code>.</p></div><h4 id="extensions-to-numeric-time"><a class="anchorlink" href="#extensions-to-numeric-time">8.2 Time</a></h4><p>Permite el uso de cálculos y declaraciones de tiempo, como <code>45.minutes + 2.hours + 4.weeks</code>.</p><p>Estos métodos usan Time # advance para cálculos de fecha precisos cuando se usa from_now, ago, etc.
así como sumar o restar sus resultados de un objeto Time. Por ejemplo:</p><div class="code_container">
<pre><code class="language-ruby"># equivalent to Time.current.advance(months: 1)
1.month.from_now

# equivalent to Time.current.advance(weeks: 2)
2.weeks.from_now

# equivalent to Time.current.advance(months: 4, weeks: 5)
(4.months + 5.weeks).from_now
</code></pre>
</div>
<div class="warning"><p>Para otras duraciones, consulte las extensiones de tiempo para <code>Integer</code>.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/numeric/time.rb</code>.</p></div><h4 id="formatting"><a class="anchorlink" href="#formatting">8.3 Formatting</a></h4><p>Habilita el formateo de números de varias formas.</p><p>Producir una representación de cadena de un número como un número de teléfono:</p><div class="code_container">
<pre><code class="language-ruby">5551234.to_s(:phone)
# =&gt; 555-1234
1235551234.to_s(:phone)
# =&gt; 123-555-1234
1235551234.to_s(:phone, area_code: true)
# =&gt; (123) 555-1234
1235551234.to_s(:phone, delimiter: " ")
# =&gt; 123 555 1234
1235551234.to_s(:phone, area_code: true, extension: 555)
# =&gt; (123) 555-1234 x 555
1235551234.to_s(:phone, country_code: 1)
# =&gt; +1-123-555-1234
</code></pre>
</div>
<p>Produzca una representación de cadena de un número como moneda:</p><div class="code_container">
<pre><code class="language-ruby">1234567890.50.to_s(:currency)                 # =&gt; $1,234,567,890.50
1234567890.506.to_s(:currency)                # =&gt; $1,234,567,890.51
1234567890.506.to_s(:currency, precision: 3)  # =&gt; $1,234,567,890.506
</code></pre>
</div>
<p>Produzca una representación de cadena de un número como porcentaje:</p><div class="code_container">
<pre><code class="language-ruby">100.to_s(:percentage)
# =&gt; 100.000%
100.to_s(:percentage, precision: 0)
# =&gt; 100%
1000.to_s(:percentage, delimiter: '.', separator: ',')
# =&gt; 1.000,000%
302.24398923423.to_s(:percentage, precision: 5)
# =&gt; 302.24399%
</code></pre>
</div>
<p>Produce una representación de cadena de un número en forma delimitada:</p><div class="code_container">
<pre><code class="language-ruby">12345678.to_s(:delimited)                     # =&gt; 12,345,678
12345678.05.to_s(:delimited)                  # =&gt; 12,345,678.05
12345678.to_s(:delimited, delimiter: ".")     # =&gt; 12.345.678
12345678.to_s(:delimited, delimiter: ",")     # =&gt; 12,345,678
12345678.05.to_s(:delimited, separator: " ")  # =&gt; 12,345,678 05
</code></pre>
</div>
<p>Produce una representación de cadena de un número redondeado con una precisión:</p><div class="code_container">
<pre><code class="language-ruby">123.to_s(:human_size)                  # =&gt; 123 Bytes
1234.to_s(:human_size)                 # =&gt; 1.21 KB
12345.to_s(:human_size)                # =&gt; 12.1 KB
1234567.to_s(:human_size)              # =&gt; 1.18 MB
1234567890.to_s(:human_size)           # =&gt; 1.15 GB
1234567890123.to_s(:human_size)        # =&gt; 1.12 TB
1234567890123456.to_s(:human_size)     # =&gt; 1.1 PB
1234567890123456789.to_s(:human_size)  # =&gt; 1.07 EB
</code></pre>
</div>
<p>Produzca una representación de cadena de un número en palabras legibles por humanos:</p><div class="code_container">
<pre><code class="language-ruby">123.to_s(:human)               # =&gt; "123"
1234.to_s(:human)              # =&gt; "1.23 Thousand"
12345.to_s(:human)             # =&gt; "12.3 Thousand"
1234567.to_s(:human)           # =&gt; "1.23 Million"
1234567890.to_s(:human)        # =&gt; "1.23 Billion"
1234567890123.to_s(:human)     # =&gt; "1.23 Trillion"
1234567890123456.to_s(:human)  # =&gt; "1.23 Quadrillion"
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/numeric/conversions.rb</code>.</p></div><h3 id="extensions-to-integer"><a class="anchorlink" href="#extensions-to-integer">9 Extensions to <code>Integer</code></a></h3><h4 id="multiple-of-questionmark"><a class="anchorlink" href="#multiple-of-questionmark">9.1 <code>multiple_of?</code></a></h4><p>El método <code>multiple_of?</code> Prueba si un número entero es múltiplo del argumento:</p><div class="code_container">
<pre><code class="language-ruby">2.multiple_of?(1) # =&gt; true
1.multiple_of?(2) # =&gt; false
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/integer/multiple.rb</code>.</p></div><h4 id="ordinal"><a class="anchorlink" href="#ordinal">9.2 <code>ordinal</code></a></h4><p>El método <code>ordinal</code> devuelve la cadena de sufijo ordinal correspondiente al entero receptor:</p><div class="code_container">
<pre><code class="language-ruby">1.ordinal    # =&gt; "st"
2.ordinal    # =&gt; "nd"
53.ordinal   # =&gt; "rd"
2009.ordinal # =&gt; "th"
-21.ordinal  # =&gt; "st"
-134.ordinal # =&gt; "th"
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/integer/inflections.rb</code>.</p></div><h4 id="ordinalize"><a class="anchorlink" href="#ordinalize">9.3 <code>ordinalize</code></a></h4><p>El método <code>ordinalize</code> devuelve la cadena ordinal correspondiente al entero receptor. En comparación, tenga en cuenta que el método <code>ordinal</code> devuelve ** solo ** la cadena de sufijo.</p><div class="code_container">
<pre><code class="language-ruby">1.ordinalize    # =&gt; "1st"
2.ordinalize    # =&gt; "2nd"
53.ordinalize   # =&gt; "53rd"
2009.ordinalize # =&gt; "2009th"
-21.ordinalize  # =&gt; "-21st"
-134.ordinalize # =&gt; "-134th"
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/integer/inflections.rb</code>.</p></div><h4 id="extensions-to-integer-time"><a class="anchorlink" href="#extensions-to-integer-time">9.4 Time</a></h4><p>Habilita el uso de declaraciones y cálculos de tiempo, como <code>4.months + 5.years</code>.</p><p>Estos métodos usan Time # advance para cálculos de fecha precisos cuando se usa from_now, ago, etc.
así como sumar o restar sus resultados de un objeto Time. Por ejemplo:</p><div class="code_container">
<pre><code class="language-ruby"># equivalent to Time.current.advance(months: 1)
1.month.from_now

# equivalent to Time.current.advance(years: 2)
2.years.from_now

# equivalent to Time.current.advance(months: 4, years: 5)
(4.months + 5.years).from_now
</code></pre>
</div>
<div class="warning"><p>Para otras duraciones, consulte las extensiones de tiempo para <code>Numeric</code>.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/integer/time.rb</code>.</p></div><h3 id="extensions-to-bigdecimal"><a class="anchorlink" href="#extensions-to-bigdecimal">10 Extensions to <code>BigDecimal</code></a></h3><h4 id="extensions-to-bigdecimal-to-s"><a class="anchorlink" href="#extensions-to-bigdecimal-to-s">10.1 <code>to_s</code></a></h4><p>El método <code>to_s</code> proporciona un especificador predeterminado de" F ". Esto significa que una simple llamada a <code>to_s</code> dará como resultado una representación de punto flotante en lugar de una notación de ingeniería:</p><div class="code_container">
<pre><code class="language-ruby">BigDecimal(5.00, 6).to_s       # =&gt; "5.0"
</code></pre>
</div>
<p>y que también se admiten especificadores de símbolos:</p><div class="code_container">
<pre><code class="language-ruby">BigDecimal(5.00, 6).to_s(:db)  # =&gt; "5.0"
</code></pre>
</div>
<p>Aún se admite la notación de ingeniería:</p><div class="code_container">
<pre><code class="language-ruby">BigDecimal(5.00, 6).to_s("e")  # =&gt; "0.5E1"
</code></pre>
</div>
<h3 id="extensions-to-enumerable"><a class="anchorlink" href="#extensions-to-enumerable">11 Extensions to <code>Enumerable</code></a></h3><h4 id="sum"><a class="anchorlink" href="#sum">11.1 <code>sum</code></a></h4><p>El método <code>sum</code> agrega los elementos de un enumerable:</p><div class="code_container">
<pre><code class="language-ruby">[1, 2, 3].sum # =&gt; 6
(1..100).sum  # =&gt; 5050
</code></pre>
</div>
<p>La adición solo asume que los elementos responden a '+':</p><div class="code_container">
<pre><code class="language-ruby">[[1, 2], [2, 3], [3, 4]].sum    # =&gt; [1, 2, 2, 3, 3, 4]
%w(foo bar baz).sum             # =&gt; "foobarbaz"
{a: 1, b: 2, c: 3}.sum          # =&gt; [:a, 1, :b, 2, :c, 3]
</code></pre>
</div>
<p>La suma de una colección vacía es cero de forma predeterminada, pero es personalizable:</p><div class="code_container">
<pre><code class="language-ruby">[].sum    # =&gt; 0
[].sum(1) # =&gt; 1
</code></pre>
</div>
<p>Si se proporciona un bloque, <code>sum</code> se convierte en un iterador que produce los elementos de la colección y suma los valores devueltos:</p><div class="code_container">
<pre><code class="language-ruby">(1..5).sum {|n| n * 2 } # =&gt; 30
[2, 4, 6, 8, 10].sum    # =&gt; 30
</code></pre>
</div>
<p>La suma de un receptor vacío también se puede personalizar en este formulario:</p><div class="code_container">
<pre><code class="language-ruby">[].sum(1) {|n| n**3} # =&gt; 1
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="index-by"><a class="anchorlink" href="#index-by">11.2 <code>index_by</code></a></h4><p>El método <code>index_by</code> genera un hash con los elementos de un enumerable indexado por alguna clave.</p><p>Repite la colección y pasa cada elemento a un bloque. El elemento estará codificado por el valor devuelto por el bloque:</p><div class="code_container">
<pre><code class="language-ruby">invoices.index_by(&amp;:number)
# =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}
</code></pre>
</div>
<div class="warning"><p>Las claves normalmente deberían ser únicas. Si el bloque devuelve el mismo valor para diferentes elementos, no se crea una colección para esa clave. El último artículo ganará.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="index-with"><a class="anchorlink" href="#index-with">11.3 <code>index_with</code></a></h4><p>El método <code>index_with</code> genera un hash con los elementos de un enumerable como claves. El valor
es un valor predeterminado pasado o devuelto en un bloque.</p><div class="code_container">
<pre><code class="language-ruby">post = Post.new(title: "hey there", body: "what's up?")

%i( title body ).index_with { |attr_name| post.public_send(attr_name) }
# =&gt; { title: "hey there", body: "what's up?" }

WEEKDAYS.index_with(Interval.all_day)
# =&gt; { monday: [ 0, 1440 ], … }
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="many-questionmark"><a class="anchorlink" href="#many-questionmark">11.4 <code>many?</code></a></h4><p>El método <code>many?</code> Es una abreviatura de <code>collection.size &gt; 1</code>:</p><div class="code_container">
<pre><code class="language-erb">&lt;% if pages.many? %&gt;
  &lt;%= pagination_links %&gt;
&lt;% end %&gt;
</code></pre>
</div>
<p>Si se da un bloque opcional, <code>many?</code> Solo tiene en cuenta aquellos elementos que devuelven verdadero:</p><div class="code_container">
<pre><code class="language-ruby">@see_more = videos.many? {|video| video.category == params[:category]}
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="exclude-questionmark"><a class="anchorlink" href="#exclude-questionmark">11.5 <code>exclude?</code></a></h4><p>El predicado <code>exclude?</code> Comprueba si un objeto dado ** no ** pertenece a la colección. Es la negación del <code>include?</code> incorporado:</p><div class="code_container">
<pre><code class="language-ruby">to_visit &lt;&lt; node if visited.exclude?(node)
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="including"><a class="anchorlink" href="#including">11.6 <code>including</code></a></h4><p>El método <code>including</code> devuelve un nuevo enumerable que incluye los elementos pasados:</p><div class="code_container">
<pre><code class="language-ruby">[ 1, 2, 3 ].including(4, 5)                    # =&gt; [ 1, 2, 3, 4, 5 ]
["David", "Rafael"].including %w[ Aaron Todd ] # =&gt; ["David", "Rafael", "Aaron", "Todd"]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="excluding"><a class="anchorlink" href="#excluding">11.7 <code>excluding</code></a></h4><p>El método <code>excluding</code> devuelve una copia de un enumerable con los elementos especificados
remoto:</p><div class="code_container">
<pre><code class="language-ruby">["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
</code></pre>
</div>
<p><code>excluding</code> tiene el alias de<code>without</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="pluck"><a class="anchorlink" href="#pluck">11.8 <code>pluck</code></a></h4><p>El método <code>pluck</code> extrae la clave dada de cada elemento:</p><div class="code_container">
<pre><code class="language-ruby">[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pluck(:name) # =&gt; ["David", "Rafael", "Aaron"]
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pluck(:id, :name) # =&gt; [[1, "David"], [2, "Rafael"]]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id="pick"><a class="anchorlink" href="#pick">11.9 <code>pick</code></a></h4><p>El método <code>pick</code> extrae la clave dada del primer elemento:</p><div class="code_container">
<pre><code class="language-ruby">[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pick(:name) # =&gt; "David"
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pick(:id, :name) # =&gt; [1, "David"]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/enumerable.rb</code>.</p></div><h3 id="extensions-to-array"><a class="anchorlink" href="#extensions-to-array">12 Extensions to <code>Array</code></a></h3><h4 id="accessing"><a class="anchorlink" href="#accessing">12.1 Accessing</a></h4><p>Active Support aumenta la API de matrices para facilitar ciertas formas de acceder a ellas. Por ejemplo, <code>to</code> devuelve el subarreglo de elementos hasta el del índice pasado:</p><div class="code_container">
<pre><code class="language-ruby">%w(a b c d).to(2) # =&gt; ["a", "b", "c"]
[].to(7)          # =&gt; []
</code></pre>
</div>
<p>De manera similar, <code>from</code> devuelve la cola del elemento en el índice pasado hasta el final. Si el índice es mayor que la longitud de la matriz, devuelve una matriz vacía.</p><div class="code_container">
<pre><code class="language-ruby">%w(a b c d).from(2)  # =&gt; ["c", "d"]
%w(a b c d).from(10) # =&gt; []
[].from(0)           # =&gt; []
</code></pre>
</div>
<p>El método <code>including</code> devuelve una nueva matriz que incluye los elementos pasados:</p><div class="code_container">
<pre><code class="language-ruby">[ 1, 2, 3 ].including(4, 5)          # =&gt; [ 1, 2, 3, 4, 5 ]
[ [ 0, 1 ] ].including([ [ 1, 0 ] ]) # =&gt; [ [ 0, 1 ], [ 1, 0 ] ]
</code></pre>
</div>
<p>El método <code>including</code> devuelve una copia del Array excluyendo los elementos especificados.
Esta es una optimización de <code>Enumerable#excluding</code> que usa<code>Array#-</code>
en lugar de "Array # rechazar" por motivos de rendimiento.</p><div class="code_container">
<pre><code class="language-ruby">["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
[ [ 0, 1 ], [ 1, 0 ] ].excluding([ [ 1, 0 ] ])                  # =&gt; [ [ 0, 1 ] ]
</code></pre>
</div>
<p>Los métodos <code>second</code>, <code>third</code>, <code>fourth</code> y <code>fifth</code> devuelven el elemento correspondiente, al igual que <code>second_to_last</code> y <code>third_to_last</code> (<code>first</code> y <code>last</code> están integrados). Gracias a la sabiduría social y a la constructividad positiva en todos lados, <code>forty_two</code> también está disponible.</p><div class="code_container">
<pre><code class="language-ruby">%w(a b c d).third # =&gt; "c"
%w(a b c d).fifth # =&gt; nil
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/array/access.rb</code>.</p></div><h4 id="extensions-to-array-extracting"><a class="anchorlink" href="#extensions-to-array-extracting">12.2 Extracting</a></h4><p>El método <code>extract!</code> Elimina y devuelve los elementos para los que el bloque devuelve un valor verdadero.
Si no se proporciona ningún bloque, se devuelve un enumerador en su lugar.</p><div class="code_container">
<pre><code class="language-ruby">numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
odd_numbers = numbers.extract! { |number| number.odd? } # =&gt; [1, 3, 5, 7, 9]
numbers # =&gt; [0, 2, 4, 6, 8]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/array/extract.rb</code>.</p></div><h4 id="options-extraction"><a class="anchorlink" href="#options-extraction">12.3 Options Extraction</a></h4><p>Cuando el último argumento en una llamada a un método es un hash, excepto quizás por un argumento <code>&amp;block</code>, Ruby le permite omitir los corchetes:</p><div class="code_container">
<pre><code class="language-ruby">User.exists?(email: params[:email])
</code></pre>
</div>
<p>Ese azúcar sintáctico se usa mucho en Rails para evitar argumentos posicionales donde habría demasiados, ofreciendo en su lugar interfaces que emulan parámetros con nombre. En particular, es muy idiomático usar un hash final para las opciones.</p><p>Sin embargo, si un método espera un número variable de argumentos y usa <code>*</code> en su declaración, dicho hash de opciones termina siendo un elemento de la matriz de argumentos, donde pierde su función.</p><p>En esos casos, puede darle a un hash de opciones un tratamiento distinguido con <code>extract_options!</code>. Este método verifica el tipo del último elemento de una matriz. Si es un hash, lo abre y lo devuelve; de ​​lo contrario, devuelve un hash vacío.</p><p>Veamos, por ejemplo, la definición de la macro del controlador <code>caches_action</code>:</p><div class="code_container">
<pre><code class="language-ruby">def caches_action(*actions)
  return unless cache_configured?
  options = actions.extract_options!
  ...
end
</code></pre>
</div>
<p>Este método recibe un número arbitrario de nombres de acción y un hash opcional de opciones como último argumento. Con la llamada a <code>extract_options!</code> Obtienes el hash de opciones y lo eliminas de <code>actions</code> de una manera simple y explícita.</p><div class="note"><p>Definido en <code>active_support/core_ext/array/extract_options.rb</code>.</p></div><h4 id="extensions-to-array-conversions"><a class="anchorlink" href="#extensions-to-array-conversions">12.4 Conversions</a></h4><h5 id="to-sentence"><a class="anchorlink" href="#to-sentence">12.4.1 <code>to_sentence</code></a></h5><p>El método <code>to_sentence</code> convierte una matriz en una cadena que contiene una oración que enumera sus elementos:</p><div class="code_container">
<pre><code class="language-ruby">%w().to_sentence                # =&gt; ""
%w(Earth).to_sentence           # =&gt; "Earth"
%w(Earth Wind).to_sentence      # =&gt; "Earth and Wind"
%w(Earth Wind Fire).to_sentence # =&gt; "Earth, Wind, and Fire"
</code></pre>
</div>
<p>Este método acepta tres opciones:</p>
<ul>
<li>
<code>:two_words_connector</code>: Lo que se utiliza para matrices de longitud 2. El valor predeterminado es "y".</li>
<li>
<code>:words_connector</code>: Lo que se usa para unir los elementos de arreglos con 3 o más elementos, excepto los dos últimos. El valor predeterminado es ",".</li>
<li>
<code>:last_word_connector</code>: Qué se usa para unir los últimos elementos de una matriz con 3 o más elementos. El valor predeterminado es "y".</li>
</ul>
<p>Los valores predeterminados para estas opciones se pueden localizar, sus claves son:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>I18n key</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:two_words_connector</code></td>
<td><code>support.array.two_words_connector</code></td>
</tr>
<tr>
<td><code>:words_connector</code></td>
<td><code>support.array.words_connector</code></td>
</tr>
<tr>
<td><code>:last_word_connector</code></td>
<td><code>support.array.last_word_connector</code></td>
</tr>
</tbody>
</table>
<div class="note"><p>Definido en <code>active_support/core_ext/array/conversions.rb</code>.</p></div><h5 id="to-formatted-s"><a class="anchorlink" href="#to-formatted-s">12.4.2 <code>to_formatted_s</code></a></h5><p>El método <code>to_formatted_s</code> actúa como<code>to_s</code> por defecto.</p><p>Sin embargo, si la matriz contiene elementos que responden a <code>id</code>, el símbolo
<code>:db</code> se puede pasar como argumento. Eso se usa típicamente con
colecciones de objetos Active Record. Las cadenas devueltas son:</p><div class="code_container">
<pre><code class="language-ruby">[].to_formatted_s(:db)            # =&gt; "null"
[user].to_formatted_s(:db)        # =&gt; "8456"
invoice.lines.to_formatted_s(:db) # =&gt; "23,567,556,12"
</code></pre>
</div>
<p>Se supone que los números enteros en el ejemplo anterior provienen de las respectivas llamadas a <code>id</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/array/conversions.rb</code>.</p></div><h5 id="extensions-to-array-conversions-to-xml"><a class="anchorlink" href="#extensions-to-array-conversions-to-xml">12.4.3 <code>to_xml</code></a></h5><p>El método <code>to_xml</code> devuelve una cadena que contiene una representación XML de su receptor:</p><div class="code_container">
<pre><code class="language-ruby">Contributor.limit(2).order(:rank).to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors type="array"&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank type="integer"&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank type="integer"&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</code></pre>
</div>
<p>Para hacerlo, envía <code>to_xml</code> a cada elemento por turno y recopila los resultados en un nodo raíz. Todos los elementos deben responder a <code>to_xml</code>; de lo contrario, se genera una excepción.</p><p>Por defecto, el nombre del elemento raíz es el plural subrayado y discontinuo del nombre de la clase del primer elemento, siempre que el resto de elementos pertenezcan a ese tipo (marcados con <code>is_a?</code>) Y no sean hashes. En el ejemplo anterior, eso es "contribuyentes".</p><p>Si hay algún elemento que no pertenece al tipo del primero, el nodo raíz se convierte en "objetos":</p><div class="code_container">
<pre><code class="language-ruby">[Contributor.first, Commit.first].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;id type="integer"&gt;4583&lt;/id&gt;
#     &lt;name&gt;Aaron Batalion&lt;/name&gt;
#     &lt;rank type="integer"&gt;53&lt;/rank&gt;
#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;author&gt;Joshua Peek&lt;/author&gt;
#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;
#     &lt;branch&gt;origin/master&lt;/branch&gt;
#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;
#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;
#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;
#     &lt;id type="integer"&gt;190316&lt;/id&gt;
#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;
#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;
#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
</code></pre>
</div>
<p>Si el receptor es una matriz de hashes, el elemento raíz por defecto también es "objetos":</p><div class="code_container">
<pre><code class="language-ruby">[{a: 1, b: 2}, {c: 3}].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;b type="integer"&gt;2&lt;/b&gt;
#     &lt;a type="integer"&gt;1&lt;/a&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;c type="integer"&gt;3&lt;/c&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
</code></pre>
</div>
<div class="warning"><p>Si la colección está vacía, el elemento raíz es por defecto "nil-classes". Eso es un problema, por ejemplo, el elemento raíz de la lista de contribuyentes anterior no sería "contribuyentes" si la colección estuviera vacía, sino "nil-classes". Puede usar la opción <code>:root</code> para asegurar un elemento raíz consistente.</p></div><p>El nombre de los nodos hijos es por defecto el nombre del nodo raíz singularizado. En los ejemplos anteriores, hemos visto "contribuyente" y "objeto". La opción <code>:children</code> le permite establecer estos nombres de nodo.</p><p>El constructor XML predeterminado es una instancia nueva de <code>Builder::XmlMarkup</code>. Puede configurar su propio constructor a través de la opción <code>:builder</code>. El método también acepta opciones como <code>:dasherize</code> y amigos, se reenvían al constructor:</p><div class="code_container">
<pre><code class="language-ruby">Contributor.limit(2).order(:rank).to_xml(skip_types: true)
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/array/conversions.rb</code>.</p></div><h4 id="wrapping"><a class="anchorlink" href="#wrapping">12.5 Wrapping</a></h4><p>El método <code>Array.wrap</code> envuelve su argumento en una matriz a menos que ya sea una matriz (o similar a una matriz).</p><p>Específicamente:</p>
<ul>
<li>Si el argumento es <code>nil</code>, se devuelve una matriz vacía.</li>
<li>De lo contrario, si el argumento responde a <code>to_ary</code> se invoca, y si el valor de<code>to_ary</code> no es <code>nil</code>, se devuelve.</li>
<li>De lo contrario, se devuelve una matriz con el argumento como elemento único.</li>
</ul>
<div class="code_container">
<pre><code class="language-ruby">Array.wrap(nil)       # =&gt; []
Array.wrap([1, 2, 3]) # =&gt; [1, 2, 3]
Array.wrap(0)         # =&gt; [0]
</code></pre>
</div>
<p>Este método tiene un propósito similar al de <code>Kernel#Array</code>, pero hay algunas diferencias:</p>
<ul>
<li>Si el argumento responde a <code>to_ary</code>, se invoca el método. <code>Kernel#Array</code> pasa a intentar <code>to_a</code> si el valor devuelto es <code>nil</code>, pero <code>Array.wrap</code> devuelve una matriz con el argumento como su único elemento de inmediato.</li>
<li>Si el valor devuelto de <code>to_ary</code> no es ni<code>nil</code> ni un objeto <code>Array</code>, <code>Kernel#Array</code> genera una excepción, mientras que <code>Array.wrap</code> no lo hace, simplemente devuelve el valor.</li>
<li>No llama a <code>to_a</code> en el argumento, si el argumento no responde a<code>to_ary</code>, devuelve una matriz con el argumento como su único elemento.</li>
</ul>
<p>El último punto es particularmente digno de comparar para algunos enumerables:</p><div class="code_container">
<pre><code class="language-ruby">Array.wrap(foo: :bar) # =&gt; [{:foo=&gt;:bar}]
Array(foo: :bar)      # =&gt; [[:foo, :bar]]
</code></pre>
</div>
<p>También hay un modismo relacionado que usa el operador splat:</p><div class="code_container">
<pre><code class="language-ruby">[*object]
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/array/wrap.rb</code>.</p></div><h4 id="duplicating"><a class="anchorlink" href="#duplicating">12.6 Duplicating</a></h4><p>El método <code>Array#deep_dup</code> se duplica a sí mismo y a todos los objetos dentro
de forma recursiva con el método de soporte activo <code>Object#deep_dup</code>. Funciona como <code>Array#map</code> con el envío del método <code>deep_dup</code> a cada objeto dentro.</p><div class="code_container">
<pre><code class="language-ruby">array = [1, [2, 3]]
dup = array.deep_dup
dup[1][2] = 4
array[1][2] == nil   # =&gt; true
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id="grouping"><a class="anchorlink" href="#grouping">12.7 Grouping</a></h4><h5 id="in-groups-of-number-fill-with-nil"><a class="anchorlink" href="#in-groups-of-number-fill-with-nil">12.7.1 <code>in_groups_of(number, fill_with = nil)</code></a></h5><p>El método <code>in_groups_of</code> divide una matriz en grupos consecutivos de cierto tamaño. Devuelve una matriz con los grupos:</p><div class="code_container">
<pre><code class="language-ruby">[1, 2, 3].in_groups_of(2) # =&gt; [[1, 2], [3, nil]]
</code></pre>
</div>
<p>O los cede a su vez si se pasa un bloque:</p><div class="code_container">
<pre><code class="language-erb">&lt;% sample.in_groups_of(3) do |a, b, c| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= a %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= b %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= c %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
</code></pre>
</div>
<p>El primer ejemplo muestra que <code>in_groups_of</code> llena el último grupo con tantos elementos<code>nil</code> como sea necesario para tener el tamaño solicitado. Puede cambiar este valor de relleno utilizando el segundo argumento opcional:</p><div class="code_container">
<pre><code class="language-ruby">[1, 2, 3].in_groups_of(2, 0) # =&gt; [[1, 2], [3, 0]]
</code></pre>
</div>
<p>Y puede decirle al método que no complete el último grupo pasando <code>false</code>:</p><div class="code_container">
<pre><code class="language-ruby">[1, 2, 3].in_groups_of(2, false) # =&gt; [[1, 2], [3]]
</code></pre>
</div>
<p>Como consecuencia, <code>false</code> no se puede utilizar como valor de relleno.</p><div class="note"><p>Definido en <code>active_support/core_ext/array/grouping.rb</code>.</p></div><h5 id="in-groups-number-fill-with-nil"><a class="anchorlink" href="#in-groups-number-fill-with-nil">12.7.2 <code>in_groups(number, fill_with = nil)</code></a></h5><p>El método <code>in_groups</code> divide una matriz en un cierto número de grupos. El método devuelve una matriz con los grupos:</p><div class="code_container">
<pre><code class="language-ruby">%w(1 2 3 4 5 6 7).in_groups(3)
# =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]
</code></pre>
</div>
<p>o los cede a su vez si se pasa un bloque:</p><div class="code_container">
<pre><code class="language-ruby">%w(1 2 3 4 5 6 7).in_groups(3) {|group| p group}
["1", "2", "3"]
["4", "5", nil]
["6", "7", nil]
</code></pre>
</div>
<p>Los ejemplos anteriores muestran que <code>in_groups</code> llena algunos grupos con un elemento <code>nil</code> final según sea necesario. Un grupo puede obtener como máximo uno de estos elementos adicionales, el más a la derecha si lo hay. Y los grupos que los tienen son siempre los últimos.</p><p>Puede cambiar este valor de relleno utilizando el segundo argumento opcional:</p><div class="code_container">
<pre><code class="language-ruby">%w(1 2 3 4 5 6 7).in_groups(3, "0")
# =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]
</code></pre>
</div>
<p>Y puede decirle al método que no complete los grupos más pequeños pasando <code>false</code>:</p><div class="code_container">
<pre><code class="language-ruby">%w(1 2 3 4 5 6 7).in_groups(3, false)
# =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]
</code></pre>
</div>
<p>Como consecuencia, "false" no se puede utilizar como valor de relleno.</p><div class="note"><p>Definido en <code>active_support/core_ext/array/grouping.rb</code>.</p></div><h5 id="split-value-nil"><a class="anchorlink" href="#split-value-nil">12.7.3 <code>split(value = nil)</code></a></h5><p>El método <code>split</code> divide una matriz por un separador y devuelve los fragmentos resultantes.</p><p>Si se pasa un bloque, los separadores son aquellos elementos de la matriz para los que el bloque devuelve verdadero:</p><div class="code_container">
<pre><code class="language-ruby">(-5..5).to_a.split { |i| i.multiple_of?(4) }
# =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]
</code></pre>
</div>
<p>De lo contrario, el valor recibido como argumento, cuyo valor predeterminado es <code>nil</code>, es el separador:</p><div class="code_container">
<pre><code class="language-ruby">[0, 1, -5, 1, 1, "foo", "bar"].split(1)
# =&gt; [[0], [-5], [], ["foo", "bar"]]
</code></pre>
</div>
<div class="info"><p>Observe en el ejemplo anterior que los separadores consecutivos dan como resultado matrices vacías.</p></div><p>NOTA: Definido en <code>active_support/core_ext/array/grouping.rb</code>.</p><h3 id="extensions-to-hash"><a class="anchorlink" href="#extensions-to-hash">13 Extensions to <code>Hash</code></a></h3><h4 id="extensions-to-hash-conversions"><a class="anchorlink" href="#extensions-to-hash-conversions">13.1 Conversions</a></h4><h5 id="conversions-to-xml"><a class="anchorlink" href="#conversions-to-xml">13.1.1 <code>to_xml</code></a></h5><p>El método <code>to_xml</code> devuelve una cadena que contiene una representación XML de su receptor:</p><div class="code_container">
<pre><code class="language-ruby">{"foo" =&gt; 1, "bar" =&gt; 2}.to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;hash&gt;
#   &lt;foo type="integer"&gt;1&lt;/foo&gt;
#   &lt;bar type="integer"&gt;2&lt;/bar&gt;
# &lt;/hash&gt;
</code></pre>
</div>
<p>Para hacerlo, el método recorre los pares y construye nodos que dependen de los <em>valores</em>. Dado un par de <code>clave</code>,<code>valor</code>:</p>
<ul>
<li><p>Si <code>value</code> es un hash, hay una llamada recursiva con <code>key</code> como <code>:root</code>.</p></li>
<li><p>Si <code>value</code> es una matriz, hay una llamada recursiva con <code>key</code> como <code>:root</code>, y<code>key</code> singularizada como <code>: children</code>.</p></li>
<li><p>Si <code>valor</code> es un objeto invocable, debe esperar uno o dos argumentos. Dependiendo de la aridad, el invocable se invoca con el hash <code>options</code> como primer argumento con <code>key</code> como <code>:root</code>, y<code>key</code> singularizado como segundo argumento. Su valor de retorno se convierte en un nuevo nodo.</p></li>
<li><p>Si <code>value</code> responde a<code>to_xml</code>, el método se invoca con <code>key</code> como <code>:root</code>.</p></li>
<li><p>De lo contrario, se crea un nodo con <code>key</code> como etiqueta con una representación de cadena de <code>value</code> como nodo de texto. Si <code>value</code> es<code>nil</code>, se agrega un atributo "nil" establecido en "true". A menos que la opción <code>:skip_types</code> exista y sea verdadera, también se agrega un atributo "tipo" de acuerdo con la siguiente asignación:</p></li>
</ul>
<div class="code_container">
<pre><code class="language-ruby">XML_TYPE_NAMES = {
  "Symbol"     =&gt; "symbol",
  "Integer"    =&gt; "integer",
  "BigDecimal" =&gt; "decimal",
  "Float"      =&gt; "float",
  "TrueClass"  =&gt; "boolean",
  "FalseClass" =&gt; "boolean",
  "Date"       =&gt; "date",
  "DateTime"   =&gt; "datetime",
  "Time"       =&gt; "datetime"
}
</code></pre>
</div>
<p>Por defecto, el nodo raíz es "hash", pero eso se puede configurar a través de la opción <code>:root</code>.</p><p>El constructor XML predeterminado es una instancia nueva de <code>Builder::XmlMarkup</code>. Puede configurar su propio constructor con la opción <code>:constructor</code>. El método también acepta opciones como <code>:dasherize</code> y amigos, se reenvían al constructor.</p><p>NOTA: Definido en <code>active_support/core_ext/hash/conversions.rb</code>.</p><h4 id="merging"><a class="anchorlink" href="#merging">13.2 Merging</a></h4><p>Ruby tiene un método incorporado <code>Hash#merge</code> que fusiona dos hashes:</p><div class="code_container">
<pre><code class="language-ruby">{a: 1, b: 1}.merge(a: 0, c: 2)
# =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}
</code></pre>
</div>
<p>Active Support define algunas formas más de fusionar hashes que pueden ser convenientes.</p><h5 id="reverse-merge-and-reverse-merge-bang"><a class="anchorlink" href="#reverse-merge-and-reverse-merge-bang">13.2.1 <code>reverse_merge</code> and <code>reverse_merge!</code></a></h5><p>En caso de colisión, la clave en el hash del argumento gana en <code>merge</code>. Puede admitir hash de opciones con valores predeterminados de una manera compacta con este modismo:</p><div class="code_container">
<pre><code class="language-ruby">options = {length: 30, omission: "..."}.merge(options)
</code></pre>
</div>
<p>Active Support define <code>reverse_merge</code> en caso de que prefiera esta notación alternativa:</p><div class="code_container">
<pre><code class="language-ruby">options = options.reverse_merge(length: 30, omission: "...")
</code></pre>
</div>
<p>Y una versión explosiva <code>reverse_merge!</code> Que realiza la fusión en su lugar:</p><div class="code_container">
<pre><code class="language-ruby">options.reverse_merge!(length: 30, omission: "...")
</code></pre>
</div>
<div class="warning"><p>Tenga en cuenta que <code>reverse_merge!</code> Puede cambiar el hash en la persona que llama, lo que puede ser una buena idea o no.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/hash/reverse_merge.rb</code>.</p></div><h5 id="reverse-update"><a class="anchorlink" href="#reverse-update">13.2.2 <code>reverse_update</code></a></h5><p>El método <code>reverse_update</code> es un alias de<code>reverse_merge!</code>, Explicado anteriormente.</p><div class="warning"><p>Tenga en cuenta que "reverse_update" no tiene explosión.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/hash/reverse_merge.rb</code>.</p></div><h5 id="deep-merge-and-deep-merge-bang"><a class="anchorlink" href="#deep-merge-and-deep-merge-bang">13.2.3 <code>deep_merge</code> and <code>deep_merge!</code></a></h5><p>Como puede ver en el ejemplo anterior, si se encuentra una clave en ambos hashes, gana el valor del que está en el argumento.</p><p>Active Support define <code>Hash#deep_merge</code>. En una fusión profunda, si se encuentra una clave en ambos hashes y sus valores son hashes a su vez, su <em>merge</em> se convierte en el valor del hash resultante:</p><div class="code_container">
<pre><code class="language-ruby">{a: {b: 1}}.deep_merge(a: {c: 2})
# =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}
</code></pre>
</div>
<p>El método <code>deep_merge!</code> Realiza una fusión profunda en su lugar.</p><div class="note"><p>Definido en <code>active_support/core_ext/hash/deep_merge.rb</code>.</p></div><h4 id="deep-duplicating"><a class="anchorlink" href="#deep-duplicating">13.3 Deep duplicating</a></h4><p>El método <code>Hash # deep_dup</code> se duplica a sí mismo y a todas las claves y valores
dentro de forma recursiva con el método de soporte activo <code>Object#deep_dup</code>. Funciona como <code>Enumerator#each_with_object</code> con el envío del método <code>deep_dup</code> a cada par dentro.</p><div class="code_container">
<pre><code class="language-ruby">hash = { a: 1, b: { c: 2, d: [3, 4] } }

dup = hash.deep_dup
dup[:b][:e] = 5
dup[:b][:d] &lt;&lt; 5

hash[:b][:e] == nil      # =&gt; true
hash[:b][:d] == [3, 4]   # =&gt; true
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id="working-with-keys"><a class="anchorlink" href="#working-with-keys">13.4 Working with Keys</a></h4><h5 id="except-and-except-bang"><a class="anchorlink" href="#except-and-except-bang">13.4.1 <code>except</code> and <code>except!</code></a></h5><p>El método <code>except</code> devuelve un hash con las claves de la lista de argumentos eliminadas, si están presentes:</p><div class="code_container">
<pre><code class="language-ruby">{a: 1, b: 2}.except(:a) # =&gt; {:b=&gt;2}
</code></pre>
</div>
<p>Si el receptor responde a <code>convert_key</code>, se llama al método en cada uno de los argumentos. Esto permite que <code>except</code> juegue bien con hashes con acceso indiferente, por ejemplo:</p><div class="code_container">
<pre><code class="language-ruby">{a: 1}.with_indifferent_access.except(:a)  # =&gt; {}
{a: 1}.with_indifferent_access.except("a") # =&gt; {}
</code></pre>
</div>
<p>There's also the bang variant <code>except!</code> that removes keys in the very receiver.</p><div class="note"><p>Definido en <code>active_support/core_ext/hash/except.rb</code>.</p></div><h5 id="stringify-keys-and-stringify-keys-bang"><a class="anchorlink" href="#stringify-keys-and-stringify-keys-bang">13.4.2 <code>stringify_keys</code> and <code>stringify_keys!</code></a></h5><p>El método <code>stringify_keys</code> devuelve un hash que tiene una versión en cadena de las claves en el receptor. Lo hace enviándoles <code>to_s</code>:</p><div class="code_container">
<pre><code class="language-ruby">{nil =&gt; nil, 1 =&gt; 1, a: :a}.stringify_keys
# =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}
</code></pre>
</div>
<p>En caso de colisión de claves, el valor será el que se haya insertado más recientemente en el hash:</p><div class="code_container">
<pre><code class="language-ruby">{"a" =&gt; 1, a: 2}.stringify_keys
# The result will be
# =&gt; {"a"=&gt;2}
</code></pre>
</div>
<p>This method may be useful for example to easily accept both symbols and strings as options. For instance <code>ActionView::Helpers::FormHelper</code> defines:</p><div class="code_container">
<pre><code class="language-ruby">def to_check_box_tag(options = {}, checked_value = "1", unchecked_value = "0")
  options = options.stringify_keys
  options["type"] = "checkbox"
  ...
end
</code></pre>
</div>
<p>La segunda línea puede acceder de forma segura a la tecla "tipo" y permitir que el usuario pase ": tipo" o "tipo".</p><p>También existe la variante bang <code>stringify_keys!</code> Que secuencia las claves en el mismo receptor.</p><p>Además de eso, uno puede usar <code>deep_stringify_keys</code> y <code>deep_stringify_keys!</code> para secuenciar todas las claves en el hash dado y todos los hash anidados en él. Un ejemplo del resultado es:</p><div class="code_container">
<pre><code class="language-ruby">{nil =&gt; nil, 1 =&gt; 1, nested: {a: 3, 5 =&gt; 5}}.deep_stringify_keys
# =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h5 id="symbolize-keys-and-symbolize-keys-bang"><a class="anchorlink" href="#symbolize-keys-and-symbolize-keys-bang">13.4.3 <code>symbolize_keys</code> and <code>symbolize_keys!</code></a></h5><p>El método <code>symbolize_keys</code> devuelve un hash que tiene una versión simbolizada de las claves en el receptor, cuando es posible. Lo hace enviándoles <code>to_sym</code>:</p><div class="code_container">
<pre><code class="language-ruby">{nil =&gt; nil, 1 =&gt; 1, "a" =&gt; "a"}.symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}
</code></pre>
</div>
<div class="warning"><p>Tenga en cuenta que en el ejemplo anterior solo se simbolizó una tecla.</p></div><p>En caso de colisión de claves, el valor será el que se haya insertado más recientemente en el hash:</p><div class="code_container">
<pre><code class="language-ruby">{"a" =&gt; 1, a: 2}.symbolize_keys
# The result will be
# =&gt; {:a=&gt;2}
</code></pre>
</div>
<p>Este método puede ser útil, por ejemplo, para aceptar fácilmente símbolos y cadenas como opciones. Por ejemplo, <code>ActionText::TagHelper</code> define</p><div class="code_container">
<pre><code class="language-ruby">def rich_text_area_tag(name, value = nil, options = {})
  options = options.symbolize_keys

  options[:input] ||= "trix_input_#{ActionText::TagHelper.id += 1}
  ...
end
</code></pre>
</div>
<p>La tercera línea puede acceder de forma segura a la tecla <code>:input</code>, y permitir que el usuario pase<code>: input</code> o "input".</p><p>También existe la variante bang <code>symbolize_keys!</code> Que simboliza las teclas en el mismo receptor.</p><p>Además de eso, uno puede usar <code>deep_symbolize_keys</code> y <code>deep_symbolize_keys!</code> para simbolizar todas las claves en el hash dado y todos los hashes anidados en él. Un ejemplo del resultado es:</p><div class="code_container">
<pre><code class="language-ruby">{nil =&gt; nil, 1 =&gt; 1, "nested" =&gt; {"a" =&gt; 3, 5 =&gt; 5}}.deep_symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h5 id="to-options-and-to-options-bang"><a class="anchorlink" href="#to-options-and-to-options-bang">13.4.4 <code>to_options</code> and <code>to_options!</code></a></h5><p>Los métodos <code>to_options</code> y<code>to_options!</code>Son, respectivamente, alias de <code>symbolize_keys</code> y <code>symbolize_keys!</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h5 id="assert-valid-keys"><a class="anchorlink" href="#assert-valid-keys">13.4.5 <code>assert_valid_keys</code></a></h5><p>El método <code>assert_valid_keys</code> recibe un número arbitrario de argumentos y comprueba si el receptor tiene alguna clave fuera de esa lista blanca. Si lo hace, se genera ArgumentError.</p><div class="code_container">
<pre><code class="language-ruby">{a: 1}.assert_valid_keys(:a)  # passes
{a: 1}.assert_valid_keys("a") # ArgumentError
</code></pre>
</div>
<p>Active Record no acepta opciones desconocidas al crear asociaciones, por ejemplo. Implementa ese control a través de <code>assert_valid_keys</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h4 id="working-with-values"><a class="anchorlink" href="#working-with-values">13.5 Working with Values</a></h4><h5 id="deep-transform-values-and-deep-transform-values-bang"><a class="anchorlink" href="#deep-transform-values-and-deep-transform-values-bang">13.5.1 <code>deep_transform_values</code> and <code>deep_transform_values!</code></a></h5><p>El método <code>deep_transform_values</code> devuelve un nuevo hash con todos los valores convertidos por la operación de bloque. Esto incluye los valores del hash raíz y de todos los hash y matrices anidados.</p><div class="code_container">
<pre><code class="language-ruby">hash = { person: { name: 'Rob', age: '28' } }

hash.deep_transform_values{ |value| value.to_s.upcase }
# =&gt; {person: {name: "ROB", age: "28"}}
</code></pre>
</div>
<p>También existe la variante bang <code>deep_transform_values!</code> Que convierte destructivamente todos los valores mediante la operación de bloque.</p><div class="note"><p>Definido en <code>active_support/core_ext/hash/deep_transform_values.rb</code>.</p></div><h4 id="slicing"><a class="anchorlink" href="#slicing">13.6 Slicing</a></h4><p>El método <code>slice!</code> Reemplaza el hash solo con las claves dadas y devuelve un hash que contiene los pares clave/valor eliminados.</p><div class="code_container">
<pre><code class="language-ruby">hash = {a: 1, b: 2}
rest = hash.slice!(:a) # =&gt; {:b=&gt;2}
hash                   # =&gt; {:a=&gt;1}
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/hash/slice.rb</code>.</p></div><h4 id="extensions-to-hash-extracting"><a class="anchorlink" href="#extensions-to-hash-extracting">13.7 Extracting</a></h4><p>El método <code>extract!</code> Elimina y devuelve los pares clave/valor que coinciden con las claves dadas.</p><div class="code_container">
<pre><code class="language-ruby">hash = {a: 1, b: 2}
rest = hash.extract!(:a) # =&gt; {:a=&gt;1}
hash                     # =&gt; {:b=&gt;2}
</code></pre>
</div>
<p>El método <code>extract!</code> Devuelve la misma subclase de Hash que el receptor.</p><div class="code_container">
<pre><code class="language-ruby">hash = {a: 1, b: 2}.with_indifferent_access
rest = hash.extract!(:a).class
# =&gt; ActiveSupport::HashWithIndifferentAccess
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/hash/slice.rb</code>.</p></div><h4 id="indifferent-access"><a class="anchorlink" href="#indifferent-access">13.8 Indifferent Access`</a></h4><p>El método <code>with_indifferent_access</code> devuelve un<code>ActiveSupport::HashWithIndifferentAccess</code> de su receptor:</p><div class="code_container">
<pre><code class="language-ruby">{a: 1}.with_indifferent_access["a"] # =&gt; 1
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/hash/indifferent_access.rb</code>.</p></div><h3 id="extensions-to-regexp"><a class="anchorlink" href="#extensions-to-regexp">14 Extensions to <code>Regexp</code></a></h3><h4 id="multiline-questionmark"><a class="anchorlink" href="#multiline-questionmark">14.1 <code>multiline?</code></a></h4><p>El método <code>multiline?</code> Dice si una expresión regular tiene el indicador <code>/ m</code> establecido, es decir, si el punto coincide con las nuevas líneas.</p><div class="code_container">
<pre><code class="language-ruby">%r{.}.multiline?  # =&gt; false
%r{.}m.multiline? # =&gt; true

Regexp.new('.').multiline?                    # =&gt; false
Regexp.new('.', Regexp::MULTILINE).multiline? # =&gt; true
</code></pre>
</div>
<p>Rails utiliza este método en un solo lugar, también en el código de enrutamiento. Las expresiones regulares multilínea no están permitidas para los requisitos de ruta y este indicador facilita la aplicación de esa restricción.</p><div class="code_container">
<pre><code class="language-ruby">def verify_regexp_requirements(requirements)
  ...
  if requirement.multiline?
    raise ArgumentError, "Regexp multiline option is not allowed in routing requirements: #{requirement.inspect}"
  end
  ...
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/regexp.rb</code>.</p></div><h3 id="extensions-to-range"><a class="anchorlink" href="#extensions-to-range">15 Extensions to <code>Range</code></a></h3><h4 id="extensions-to-range-to-s"><a class="anchorlink" href="#extensions-to-range-to-s">15.1 <code>to_s</code></a></h4><p>Active Support extiende el método <code>Range#to_s</code> para que comprenda un argumento de formato opcional. En el momento de escribir estas líneas, el único formato no predeterminado admitido es <code>:db</code>:
```ruby
(Date.today..Date.tomorrow).to_s</p><h2>=&gt; "2009-10-25..2009-10-26"</h2><p>(Date.today..Date.tomorrow).to_s(:db)</p><h2>=&gt; "BETWEEN '2009-10-25' AND '2009-10-26'"</h2><div class="code_container">
<pre><code class="language-plain">
Como muestra el ejemplo, el formato `:db` genera una cláusula SQL` BETWEEN`. Eso lo utiliza Active Record en su apoyo a valores de rango en condiciones.

NOTE: Definido en `active_support/core_ext/range/conversions.rb`.

### `===`, `include?`, and `cover?`

Los métodos `Range#===`, `Range#include?` y `Range#cover?` Dicen si algún valor se encuentra entre los extremos de una instancia determinada:

```ruby
(2..3).include?(Math::E) # =&gt; true
</code></pre>
</div>
<p>Active Support amplía estos métodos para que el argumento pueda ser otro rango a su vez. En ese caso, probamos si los extremos del rango del argumento pertenecen al receptor mismo:</p><div class="code_container">
<pre><code class="language-ruby">(1..10) === (3..7)  # =&gt; true
(1..10) === (0..7)  # =&gt; false
(1..10) === (3..11) # =&gt; false
(1...9) === (3..9)  # =&gt; false

(1..10).include?(3..7)  # =&gt; true
(1..10).include?(0..7)  # =&gt; false
(1..10).include?(3..11) # =&gt; false
(1...9).include?(3..9)  # =&gt; false

(1..10).cover?(3..7)  # =&gt; true
(1..10).cover?(0..7)  # =&gt; false
(1..10).cover?(3..11) # =&gt; false
(1...9).cover?(3..9)  # =&gt; false
</code></pre>
</div>
<div class="note"><p>Definido en  <code>active_support/core_ext/range/compare_range.rb</code>.</p></div><h4 id="overlaps-questionmark"><a class="anchorlink" href="#overlaps-questionmark">15.2 <code>overlaps?</code></a></h4><p>El método <code>Range#overlaps?</code> dice si dos rangos dados tienen una intersección no nula:        </p><div class="code_container">
<pre><code class="language-ruby">(1..10).overlaps?(7..11)  # =&gt; true
(1..10).overlaps?(0..7)   # =&gt; true
(1..10).overlaps?(11..27) # =&gt; false
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/range/overlaps.rb</code>.</p></div><h3 id="extensions-to-date"><a class="anchorlink" href="#extensions-to-date">16 Extensions to <code>Date</code></a></h3><h4 id="extensions-to-date-calculations"><a class="anchorlink" href="#extensions-to-date-calculations">16.1 Calculations</a></h4><div class="info"><p>Los siguientes métodos de cálculo tienen casos extremos en octubre de 1582, ya que los días 5..14 simplemente no existen. Esta guía no documenta su comportamiento en esos días por brevedad, pero basta con decir que hacen lo que cabría esperar. Es decir, <code>Date.new(1582, 10, 4).Tomorrow</code> devuelve<code>Date.new (1582, 10, 15)</code>y así sucesivamente. Compruebe <code>test/core_ext/date_ext_test.rb</code> en el conjunto de pruebas de Active Support para conocer el comportamiento esperado.</p></div><h5 id="date-current"><a class="anchorlink" href="#date-current">16.1.1 <code>Date.current</code></a></h5><p>Active Support define "Date.current" como hoy en la zona horaria actual. Eso es como <code>Date.today</code>, excepto que respeta la zona horaria del usuario, si está definida. También define <code>Date.yesterday</code> y <code>Date.tomorrow</code>, y la instancia predica <code>past?</code>, <code>today?</code>, <code>tomorrow?</code>, <code>next_day?</code>, <code>yesterday?</code>, <code>prev_day?</code>, <code>future?</code>, <code>on_weekday?</code> y <code>on_weekend?</code>, todos ellos relativos a <code>Date.current</code>.</p><p>Cuando realice comparaciones de fechas utilizando métodos que respeten la zona horaria del usuario, asegúrese de utilizar <code>Date.current</code> y no <code>Date.today</code>. Hay casos en los que la zona horaria del usuario podría estar en el futuro en comparación con la zona horaria del sistema, que <code>Date.today</code> usa de forma predeterminada. Esto significa que <code>Date.today</code> puede ser igual a <code>Date.yesterday</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id="named-dates"><a class="anchorlink" href="#named-dates">16.1.2 Named dates</a></h5><h6 id="beginning-of-week-end-of-week"><a class="anchorlink" href="#beginning-of-week-end-of-week">16.1.2.1 <code>beginning_of_week</code>, <code>end_of_week</code></a></h6><p>Los métodos <code>begin_of_week</code> y <code>end_of_week</code> devuelven las fechas para
principio y fin de semana, respectivamente. Se supone que las semanas comienzan en
Lunes, pero eso se puede cambiar pasando un argumento, configurando el hilo local
<code>Date.beginning_of_week</code> o <code>config.beginning_of_week</code>.</p><div class="code_container">
<pre><code class="language-ruby">d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.beginning_of_week          # =&gt; Mon, 03 May 2010
d.beginning_of_week(:sunday) # =&gt; Sun, 02 May 2010
d.end_of_week                # =&gt; Sun, 09 May 2010
d.end_of_week(:sunday)       # =&gt; Sat, 08 May 2010
</code></pre>
</div>
<p><code>beginning_of_week</code> tiene el alias de <code>at_beginning_of_week</code> y <code>end_of_week</code> tiene el alias de<code>at_end_of_week</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="monday-sunday"><a class="anchorlink" href="#monday-sunday">16.1.2.2 <code>monday</code>, <code>sunday</code></a></h6><p>Los métodos <code>monday</code> y <code>sunday</code> devuelven las fechas del lunes anterior y
el próximo domingo, respectivamente.</p><div class="code_container">
<pre><code class="language-ruby">d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.monday                     # =&gt; Mon, 03 May 2010
d.sunday                     # =&gt; Sun, 09 May 2010

d = Date.new(2012, 9, 10)    # =&gt; Mon, 10 Sep 2012
d.monday                     # =&gt; Mon, 10 Sep 2012

d = Date.new(2012, 9, 16)    # =&gt; Sun, 16 Sep 2012
d.sunday                     # =&gt; Sun, 16 Sep 2012
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="prev-week-next-week"><a class="anchorlink" href="#prev-week-next-week">16.1.2.3 <code>prev_week</code>, <code>next_week</code></a></h6><p>El método <code>next_week</code> recibe un símbolo con un nombre de día en inglés (por defecto es el hilo local <code>Date.beginning_of_week</code>, o <code>config.beginning_of_week</code>, o <code>:monday</code>) y devuelve la fecha correspondiente a ese día.</p><div class="code_container">
<pre><code class="language-ruby">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.next_week              # =&gt; Mon, 10 May 2010
d.next_week(:saturday)   # =&gt; Sat, 15 May 2010
</code></pre>
</div>
<p>El método <code>prev_week</code> es análogo:</p><div class="code_container">
<pre><code class="language-ruby">d.prev_week              # =&gt; Mon, 26 Apr 2010
d.prev_week(:saturday)   # =&gt; Sat, 01 May 2010
d.prev_week(:friday)     # =&gt; Fri, 30 Apr 2010
</code></pre>
</div>
<p><code>prev_week</code> tiene el alias de <code>last_week</code>.</p><p>Tanto <code>next_week</code> como <code>prev_week</code> funcionan como se esperaba cuando se configuran <code>Date.beginning_of_week</code> o <code>config.beginning_of_week</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="beginning-of-month-end-of-month"><a class="anchorlink" href="#beginning-of-month-end-of-month">16.1.2.4 <code>beginning_of_month</code>, <code>end_of_month</code></a></h6><p>Los métodos <code>begin_of_month</code> y <code>end_of_month</code> devuelven las fechas para el comienzo y el final del mes:</p><div class="code_container">
<pre><code class="language-ruby">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_month     # =&gt; Sat, 01 May 2010
d.end_of_month           # =&gt; Mon, 31 May 2010
</code></pre>
</div>
<p><code>begin_of_month</code> tiene un alias de <code>at_beginning_of_month</code>, y <code>end_of_month</code> tiene un alias de <code>at_end_of_month</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="beginning-of-quarter-end-of-quarter"><a class="anchorlink" href="#beginning-of-quarter-end-of-quarter">16.1.2.5 <code>beginning_of_quarter</code>, <code>end_of_quarter</code></a></h6><p>Los métodos <code>begin_of_quarter</code> y <code>end_of_quarter</code> devuelven las fechas para el inicio y el final del trimestre del año calendario del receptor:</p><div class="code_container">
<pre><code class="language-ruby">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_quarter   # =&gt; Thu, 01 Apr 2010
d.end_of_quarter         # =&gt; Wed, 30 Jun 2010
</code></pre>
</div>
<p><code>begin_of_quarter</code> tiene el alias de <code>at_beginning_of_quarter</code>, y <code>end_of_quarter</code> tiene el alias de <code>at_end_of_quarter</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="beginning-of-year-end-of-year"><a class="anchorlink" href="#beginning-of-year-end-of-year">16.1.2.6 <code>beginning_of_year</code>, <code>end_of_year</code></a></h6><p>Los métodos <code>begin_of_year</code> y <code>end_of_year</code> devuelven las fechas para el comienzo y el final del año:</p><div class="code_container">
<pre><code class="language-ruby">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_year      # =&gt; Fri, 01 Jan 2010
d.end_of_year            # =&gt; Fri, 31 Dec 2010
</code></pre>
</div>
<p><code>beginning_of_year</code> is aliased to <code>at_beginning_of_year</code>, and <code>end_of_year</code> is aliased to <code>at_end_of_year</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h5 id="other-date-computations"><a class="anchorlink" href="#other-date-computations">16.1.3 Other Date Computations</a></h5><h6 id="years-ago-years-since"><a class="anchorlink" href="#years-ago-years-since">16.1.3.1 <code>years_ago</code>, <code>years_since</code></a></h6><p>El método <code>years_ago</code> recibe un número de años y devuelve la misma fecha que hace muchos años:</p><div class="code_container">
<pre><code class="language-ruby">date = Date.new(2010, 6, 7)
date.years_ago(10) # =&gt; Wed, 07 Jun 2000
</code></pre>
</div>
<p><code>years_since</code> moves forward in time:</p><div class="code_container">
<pre><code class="language-ruby">date = Date.new(2010, 6, 7)
date.years_since(10) # =&gt; Sun, 07 Jun 2020
</code></pre>
</div>
<p>If such a day does not exist, the last day of the corresponding month is returned:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2012, 2, 29).years_ago(3)     # =&gt; Sat, 28 Feb 2009
Date.new(2012, 2, 29).years_since(3)   # =&gt; Sat, 28 Feb 2015
</code></pre>
</div>
<p><code>last_year</code> is short-hand for <code>#years_ago(1)</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="months-ago-months-since"><a class="anchorlink" href="#months-ago-months-since">16.1.3.2 <code>months_ago</code>, <code>months_since</code></a></h6><p>Los métodos <code>months_ago</code> y <code>months_since</code> funcionan de manera análoga durante meses:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 4, 30).months_ago(2)   # =&gt; Sun, 28 Feb 2010
Date.new(2010, 4, 30).months_since(2) # =&gt; Wed, 30 Jun 2010
</code></pre>
</div>
<p>Si ese día no existe, se devuelve el último día del mes correspondiente:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 4, 30).months_ago(2)    # =&gt; Sun, 28 Feb 2010
Date.new(2009, 12, 31).months_since(2) # =&gt; Sun, 28 Feb 2010
</code></pre>
</div>
<p><code>last_month</code> is short-hand for <code>#months_ago(1)</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="weeks-ago"><a class="anchorlink" href="#weeks-ago">16.1.3.3 <code>weeks_ago</code></a></h6><p>The method <code>weeks_ago</code> works analogously for weeks:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 5, 24).weeks_ago(1)    # =&gt; Mon, 17 May 2010
Date.new(2010, 5, 24).weeks_ago(2)    # =&gt; Mon, 10 May 2010
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id="other-date-computations-advance"><a class="anchorlink" href="#other-date-computations-advance">16.1.3.4 <code>advance</code></a></h6><p>La forma más genérica de saltar a otros días es "avance". Este método recibe un hash con las claves <code>: años</code>,<code>: meses</code>, <code>: semanas</code>,<code>: días</code>, y devuelve una fecha avanzada tanto como las claves presentes indican:</p><div class="code_container">
<pre><code class="language-ruby">date = Date.new(2010, 6, 6)
date.advance(years: 1, weeks: 2)  # =&gt; Mon, 20 Jun 2011
date.advance(months: 2, days: -2) # =&gt; Wed, 04 Aug 2010
</code></pre>
</div>
<p>Tenga en cuenta en el ejemplo anterior que los incrementos pueden ser negativos.</p><p>Para realizar el cálculo, el método primero incrementa años, luego meses, luego semanas y finalmente días. Este orden es importante hacia finales de meses. Digamos, por ejemplo, que estamos a finales de febrero de 2010 y queremos avanzar un mes y un día.</p><p>El método <code>advance</code> avanza primero un mes, y luego un día, el resultado es:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 2, 28).advance(months: 1, days: 1)
# =&gt; Sun, 29 Mar 2010
</code></pre>
</div>
<p>Mientras que si lo hiciera al revés el resultado sería diferente:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 2, 28).advance(days: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id="extensions-to-date-calculations-changing-components"><a class="anchorlink" href="#extensions-to-date-calculations-changing-components">16.1.4 Changing Components</a></h5><p>El método <code>change</code> le permite obtener una nueva fecha que es la misma que la del receptor, excepto para el año, mes o día dado:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 12, 23).change(year: 2011, month: 11)
# =&gt; Wed, 23 Nov 2011
</code></pre>
</div>
<p>Este método no es tolerante con fechas inexistentes, si el cambio no es válido, se genera un error de argumento:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(2010, 1, 31).change(month: 2)
# =&gt; ArgumentError: invalid date
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id="extensions-to-date-calculations-durations"><a class="anchorlink" href="#extensions-to-date-calculations-durations">16.1.5 Durations</a></h5><p>Las duraciones se pueden sumar y restar de las fechas:</p><div class="code_container">
<pre><code class="language-ruby">d = Date.current
# =&gt; Mon, 09 Aug 2010
d + 1.year
# =&gt; Tue, 09 Aug 2011
d - 3.hours
# =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00
</code></pre>
</div>
<p>Se traducen en llamadas a <code>since</code> o <code>advance</code>. Por ejemplo aquí obtenemos el salto correcto en la reforma del calendario:</p><div class="code_container">
<pre><code class="language-ruby">Date.new(1582, 10, 4) + 1.day
# =&gt; Fri, 15 Oct 1582
</code></pre>
</div>
<h5 id="timestamps"><a class="anchorlink" href="#timestamps">16.1.6 Timestamps</a></h5><div class="info"><p>Los siguientes métodos devuelven un objeto <code>Time</code> si es posible, de lo contrario un<code>DateTime</code>. Si se configura, respetan la zona horaria del usuario.</p></div><h6 id="beginning-of-day-end-of-day"><a class="anchorlink" href="#beginning-of-day-end-of-day">16.1.6.1 <code>beginning_of_day</code>, <code>end_of_day</code></a></h6><p>El método <code>begin_of_day</code> devuelve una marca de tiempo al comienzo del día (00:00:00):</p><div class="code_container">
<pre><code class="language-ruby">date = Date.new(2010, 6, 7)
date.beginning_of_day # =&gt; Mon Jun 07 00:00:00 +0200 2010
</code></pre>
</div>
<p>The method <code>end_of_day</code> returns a timestamp at the end of the day (23:59:59):</p><div class="code_container">
<pre><code class="language-ruby">date = Date.new(2010, 6, 7)
date.end_of_day # =&gt; Mon Jun 07 23:59:59 +0200 2010
</code></pre>
</div>
<p><code>begin_of_day</code> tiene el alias de <code>at_beginning_of_day</code>, <code>midnight</code>, <code>at_midnight</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h6 id="beginning-of-hour-end-of-hour"><a class="anchorlink" href="#beginning-of-hour-end-of-hour">16.1.6.2 <code>beginning_of_hour</code>, <code>end_of_hour</code></a></h6><p>El método <code>begin_of_hour</code> devuelve una marca de tiempo al comienzo de la hora (hh: 00: 00):</p><div class="code_container">
<pre><code class="language-ruby">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_hour # =&gt; Mon Jun 07 19:00:00 +0200 2010
</code></pre>
</div>
<p>El método <code>end_of_hour</code> devuelve una marca de tiempo al final de la hora (hh: 59: 59):</p><div class="code_container">
<pre><code class="language-ruby">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_hour # =&gt; Mon Jun 07 19:59:59 +0200 2010
</code></pre>
</div>
<p><code>begin_of_hour</code> tiene el alias de <code>at_beginning_of_hour</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id="beginning-of-minute-end-of-minute"><a class="anchorlink" href="#beginning-of-minute-end-of-minute">16.1.6.3 <code>beginning_of_minute</code>, <code>end_of_minute</code></a></h6><p>The method <code>beginning_of_minute</code> returns a timestamp at the beginning of the minute (hh:mm:00):</p><div class="code_container">
<pre><code class="language-ruby">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_minute # =&gt; Mon Jun 07 19:55:00 +0200 2010
</code></pre>
</div>
<p>El método <code>end_of_minute</code> devuelve una marca de tiempo al final del minuto (hh: mm: 59):</p><div class="code_container">
<pre><code class="language-ruby">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_minute # =&gt; Mon Jun 07 19:55:59 +0200 2010
</code></pre>
</div>
<p><code>begin_of_minute</code> tiene el alias de <code>at_beginning_of_minute</code>.</p><div class="info"><p><code>begin_of_hour</code>, <code>end_of_hour</code>, <code>begin_of_minute</code> y<code>end_of_minute</code> se implementan para <code>Time</code> y <code>DateTime</code> pero <strong>no</strong> <code>Date</code> ya que no tiene sentido solicitar el comienzo o el final de un hora o minuto en una instancia de <code>Date</code>.</p></div><h6 id="ago-since"><a class="anchorlink" href="#ago-since">16.1.6.4 <code>ago</code>, <code>since</code></a></h6><p>El método <code>ago</code> recibe una cantidad de segundos como argumento y devuelve una marca de tiempo de hace muchos segundos desde la medianoche:</p><div class="code_container">
<pre><code class="language-ruby">date = Date.current # =&gt; Fri, 11 Jun 2010
date.ago(1)         # =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00
</code></pre>
</div>
<p>Del mismo modo, <code>since</code> avanza:</p><div class="code_container">
<pre><code class="language-ruby">date = Date.current # =&gt; Fri, 11 Jun 2010
date.since(1)       # =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id="other-time-computations"><a class="anchorlink" href="#other-time-computations">16.1.7 Other Time Computations</a></h5><h4 id="extensions-to-date-conversions"><a class="anchorlink" href="#extensions-to-date-conversions">16.2 Conversions</a></h4><h3 id="extensions-to-datetime"><a class="anchorlink" href="#extensions-to-datetime">17 Extensions to <code>DateTime</code></a></h3><div class="warning"><p><code>DateTime</code> no conoce las reglas de DST, por lo que algunos de estos métodos tienen casos extremos cuando se produce un cambio de DST. Por ejemplo, <code>seconds_since_midnight</code> podría no devolver la cantidad real en ese día.</p></div><h4 id="extensions-to-datetime-calculations"><a class="anchorlink" href="#extensions-to-datetime-calculations">17.1 Calculations</a></h4><p>La clase <code>DateTime</code> es una subclase de <code>Date</code> por lo que al cargar <code>active_support/core_ext/date/calculations.rb</code> hereda estos métodos y sus alias, excepto que siempre devolverán fechas y horas.</p><p>Los siguientes métodos se han vuelto a implementar para que ** no ** necesite cargar <code>active_support/core_ext/date/calculations.rb</code> para estos:</p><div class="code_container">
<pre><code class="language-ruby">beginning_of_day (midnight, at_midnight, at_beginning_of_day)
end_of_day
ago
since (in)
</code></pre>
</div>
<p>Por otro lado, <code>advance</code> y <code>change</code> también se definen y admiten más opciones, que se documentan a continuación.</p><p>Los siguientes métodos solo se implementan en <code>active_support / core_ext / date_time / calculations.rb</code> ya que solo tienen sentido cuando se usan con una instancia de <code>DateTime</code>:</p><div class="code_container">
<pre><code class="language-ruby">beginning_of_hour (at_beginning_of_hour)
end_of_hour
</code></pre>
</div>
<h5 id="named-datetimes"><a class="anchorlink" href="#named-datetimes">17.1.1 Named Datetimes</a></h5><h6 id="datetime-current"><a class="anchorlink" href="#datetime-current">17.1.1.1 <code>DateTime.current</code></a></h6><p>Active Support define <code>DateTime.current</code> como <code>Time.now.to_datetime</code>, excepto que respeta la zona horaria del usuario, si está definida. También define <code>DateTime.yesterday</code> y<code>DateTime.tomorrow</code>, y la instancia predica <code>past?</code> y <code>future?</code> relativo a <code>DateTime.current</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h5 id="other-extensions"><a class="anchorlink" href="#other-extensions">17.1.2 Other Extensions</a></h5><h6 id="seconds-since-midnight"><a class="anchorlink" href="#seconds-since-midnight">17.1.2.1 <code>seconds_since_midnight</code></a></h6><p>El método <code>seconds_since_midnight</code> devuelve el número de segundos desde la medianoche:</p><div class="code_container">
<pre><code class="language-ruby">now = DateTime.current     # =&gt; Mon, 07 Jun 2010 20:26:36 +0000
now.seconds_since_midnight # =&gt; 73596
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id="utc"><a class="anchorlink" href="#utc">17.1.2.2 <code>utc</code></a></h6><p>El método <code>utc</code> le da la misma fecha y hora en el receptor expresada en UTC.</p><div class="code_container">
<pre><code class="language-ruby">now = DateTime.current # =&gt; Mon, 07 Jun 2010 19:27:52 -0400
now.utc                # =&gt; Mon, 07 Jun 2010 23:27:52 +0000
</code></pre>
</div>
<p>Este método también tiene un alias como "getutc".</p><div class="note"><p>Definido <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id="utc-questionmark"><a class="anchorlink" href="#utc-questionmark">17.1.2.3 <code>utc?</code></a></h6><p>El predicado <code>utc?</code> dice si el receptor tiene UTC como zona horaria:</p><div class="code_container">
<pre><code class="language-ruby">now = DateTime.now # =&gt; Mon, 07 Jun 2010 19:30:47 -0400
now.utc?           # =&gt; false
now.utc.utc?       # =&gt; true
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id="other-extensions-advance"><a class="anchorlink" href="#other-extensions-advance">17.1.2.4 <code>advance</code></a></h6><p>La forma más genérica de saltar a otros días es <code>advance</code>. Este método recibe un hash con las claves <code>:years</code>, <code>:months</code>, <code>:weeks</code>, <code>:days</code>, y devuelve una fecha avanzada tanto como las claves presentes indican:</p><div class="code_container">
<pre><code class="language-ruby">d = DateTime.current
# =&gt; Thu, 05 Aug 2010 11:33:31 +0000
d.advance(years: 1, months: 1, days: 1, hours: 1, minutes: 1, seconds: 1)
# =&gt; Tue, 06 Sep 2011 12:34:32 +0000
</code></pre>
</div>
<p>Este método primero calcula la fecha de destino pasando <code>:years</code>, <code>:months</code>, <code>:weeks</code>, y <code>:days</code> hasta la <code>Date#advance</code> documentada anteriormente. Después de eso, ajusta el tiempo llamando "desde" con el número de segundos para avanzar. Este orden es relevante, un orden diferente daría diferentes fechas y horas en algunos casos extremos. Se aplica el ejemplo de <code>Date # advance</code>, y podemos ampliarlo para mostrar la relevancia del orden relacionada con los bits de tiempo.</p><p>Si primero movemos los bits de fecha (que también tienen un orden relativo de procesamiento, como se documentó anteriormente), y luego los bits de tiempo obtenemos, por ejemplo, el siguiente cálculo:</p><div class="code_container">
<pre><code class="language-ruby">d = DateTime.new(2010, 2, 28, 23, 59, 59)
# =&gt; Sun, 28 Feb 2010 23:59:59 +0000
d.advance(months: 1, seconds: 1)
# =&gt; Mon, 29 Mar 2010 00:00:00 +0000
</code></pre>
</div>
<p>pero si los calculamos al revés, el resultado sería diferente:</p><div class="code_container">
<pre><code class="language-ruby">d.advance(seconds: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010 00:00:00 +0000
</code></pre>
</div>
<div class="warning"><p>Dado que "DateTime" no tiene en cuenta el horario de verano, puede terminar en un punto no existente en el tiempo sin ninguna advertencia o error que se lo indique.</p></div><div class="note"><p>Definido en <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h5 id="extensions-to-datetime-calculations-changing-components"><a class="anchorlink" href="#extensions-to-datetime-calculations-changing-components">17.1.3 Changing Components</a></h5><p>El método <code>change</code> le permite obtener una nueva fecha y hora que es la misma que la del receptor excepto por las opciones dadas, que pueden incluir <code>:year</code>, <code>:month</code>, <code>:day</code>, <code>:hour</code>, <code>:min</code>, <code>:sec</code>, <code>:offset</code>, <code>:start</code>:</p><div class="code_container">
<pre><code class="language-ruby">now = DateTime.current
# =&gt; Tue, 08 Jun 2010 01:56:22 +0000
now.change(year: 2011, offset: Rational(-6, 24))
# =&gt; Wed, 08 Jun 2011 01:56:22 -0600
</code></pre>
</div>
<p>Si las horas se ponen a cero, los minutos y los segundos también (a menos que hayan dado valores):</p><div class="code_container">
<pre><code class="language-ruby">now.change(hour: 0)
# =&gt; Tue, 08 Jun 2010 00:00:00 +0000
</code></pre>
</div>
<p>Del mismo modo, si los minutos se ponen a cero, los segundos también (a menos que se haya dado un valor):</p><div class="code_container">
<pre><code class="language-ruby">now.change(min: 0)
# =&gt; Tue, 08 Jun 2010 01:00:00 +0000
</code></pre>
</div>
<p>Este método no es tolerante con fechas inexistentes, si el cambio no es válido, se genera un error de argumento:</p><div class="code_container">
<pre><code class="language-ruby">DateTime.current.change(month: 2, day: 30)
# =&gt; ArgumentError: invalid date
</code></pre>
</div>
<div class="note"><p>Definido en active_support/core_ext/date_time/calculations.rb`.</p></div><h5 id="extensions-to-datetime-calculations-durations"><a class="anchorlink" href="#extensions-to-datetime-calculations-durations">17.1.4 Durations</a></h5><p>Las duraciones se pueden sumar y restar de las fechas y horas:</p><div class="code_container">
<pre><code class="language-ruby">now = DateTime.current
# =&gt; Mon, 09 Aug 2010 23:15:17 +0000
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:15:17 +0000
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:15:17 +0000
</code></pre>
</div>
<p>Se traducen en llamadas a <code>since</code> o <code>advance</code>. Por ejemplo aquí obtenemos el salto correcto en la reforma del calendario:</p><div class="code_container">
<pre><code class="language-ruby">DateTime.new(1582, 10, 4, 23) + 1.hour
# =&gt; Fri, 15 Oct 1582 00:00:00 +0000
</code></pre>
</div>
<h3 id="extensions-to-time"><a class="anchorlink" href="#extensions-to-time">18 Extensions to <code>Time</code></a></h3><h4 id="calculations"><a class="anchorlink" href="#calculations">18.1 Calculations</a></h4><p>Son análogos. Consulte la documentación anterior y tenga en cuenta las siguientes diferencias:</p>
<ul>
<li>
<code>change</code> acepta una opción adicional <code>:usec</code>.</li>
<li>
<code>Time</code> comprende el horario de verano, por lo que obtiene los cálculos correctos de DST como en</li>
</ul>
<div class="code_container">
<pre><code class="language-ruby">Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;

# In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.
t = Time.local(2010, 3, 28, 1, 59, 59)
# =&gt; Sun Mar 28 01:59:59 +0100 2010
t.advance(seconds: 1)
# =&gt; Sun Mar 28 03:00:00 +0200 2010
</code></pre>
</div>

<ul>
<li>Si <code>since</code> o<code>ago</code> salta a una hora que no se puede expresar con <code>Time</code>, se devuelve un objeto<code>DateTime</code> en su lugar.</li>
</ul>
<h5 id="time-current"><a class="anchorlink" href="#time-current">18.1.1 <code>Time.current</code></a></h5><p>Active Support define "Time.current" como hoy en la zona horaria actual. Eso es como "Time.now", excepto que respeta la zona horaria del usuario, si está definida. También define los predicados de instancia <code>past?</code>, <code>today?</code>, <code>tomorrow?</code>, <code>next_day?</code>, <code>yesterday?</code>, <code>prev_day?</code> y <code>future?</code>, Todos ellos relativos a <code>Time.current</code>.</p><p>Al hacer comparaciones de tiempo utilizando métodos que respeten la zona horaria del usuario, asegúrese de utilizar <code>Time.current</code> en lugar de<code>Time.now</code>. Hay casos en los que la zona horaria del usuario podría estar en el futuro en comparación con la zona horaria del sistema, que <code>Time.now</code> utiliza de forma predeterminada. Esto significa que "Time.now.to_date" puede ser igual a "Date.yesterday".</p><div class="note"><p>Definido en <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id="all-day-all-week-all-month-all-quarter-and-all-year"><a class="anchorlink" href="#all-day-all-week-all-month-all-quarter-and-all-year">18.1.2 <code>all_day</code>, <code>all_week</code>, <code>all_month</code>, <code>all_quarter</code> and <code>all_year</code></a></h5><p>El método <code>all_day</code> devuelve un rango que representa el día completo de la hora actual.</p><div class="code_container">
<pre><code class="language-ruby">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_day
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00
</code></pre>
</div>
<p>De manera análoga, <code>all_week</code>,<code>all_month</code>, <code>all_quarter</code> y <code>all_year</code> sirven para generar rangos de tiempo.</p><div class="code_container">
<pre><code class="language-ruby">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_week
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00
now.all_week(:sunday)
# =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00
now.all_month
# =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00
now.all_quarter
# =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00
now.all_year
# =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00
</code></pre>
</div>
<div class="note"><p>Defined in <code><a href="https://github.com/rails/rails/tree/cbb2fdeec97e719bfc9d3df8128a5d566acd4486/activesupport/lib/active_support/core_ext/date_and_time/calculations.rb">active_support/core_ext/date_and_time/calculations.rb</a></code>.</p></div><h5 id="prev-day-next-day"><a class="anchorlink" href="#prev-day-next-day">18.1.3 <code>prev_day</code>, <code>next_day</code></a></h5><p><code>prev_day</code> y <code>next_day</code> devuelven la hora del último día o del día siguiente:</p><div class="code_container">
<pre><code class="language-ruby">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_day               # =&gt; 2010-05-07 00:00:00 +0900
t.next_day               # =&gt; 2010-05-09 00:00:00 +0900
</code></pre>
</div>
<div class="note"><p>Definido en  <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id="prev-month-next-month"><a class="anchorlink" href="#prev-month-next-month">18.1.4 <code>prev_month</code>, <code>next_month</code></a></h5><p><code>prev_month</code> y <code>next_month</code> devuelven la hora con el mismo día en el último o el próximo mes:</p><div class="code_container">
<pre><code class="language-ruby">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_month             # =&gt; 2010-04-08 00:00:00 +0900
t.next_month             # =&gt; 2010-06-08 00:00:00 +0900
</code></pre>
</div>
<p>Si ese día no existe, se devuelve el último día del mes correspondiente:</p><div class="code_container">
<pre><code class="language-ruby">Time.new(2000, 5, 31).prev_month # =&gt; 2000-04-30 00:00:00 +0900
Time.new(2000, 3, 31).prev_month # =&gt; 2000-02-29 00:00:00 +0900
Time.new(2000, 5, 31).next_month # =&gt; 2000-06-30 00:00:00 +0900
Time.new(2000, 1, 31).next_month # =&gt; 2000-02-29 00:00:00 +0900
</code></pre>
</div>
<div class="note"><p>Definido en  <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id="prev-year-next-year"><a class="anchorlink" href="#prev-year-next-year">18.1.5 <code>prev_year</code>, <code>next_year</code></a></h5><p><code>prev_year</code> y <code>next_year</code> devuelven una hora con el mismo día / mes en el último o el próximo año:</p><div class="code_container">
<pre><code class="language-ruby">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_year              # =&gt; 2009-05-08 00:00:00 +0900
t.next_year              # =&gt; 2011-05-08 00:00:00 +0900
</code></pre>
</div>
<p>Si la fecha es el 29 de febrero de un año bisiesto, obtiene el 28:</p><div class="code_container">
<pre><code class="language-ruby">t = Time.new(2000, 2, 29) # =&gt; 2000-02-29 00:00:00 +0900
t.prev_year               # =&gt; 1999-02-28 00:00:00 +0900
t.next_year               # =&gt; 2001-02-28 00:00:00 +0900
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id="prev-quarter-next-quarter"><a class="anchorlink" href="#prev-quarter-next-quarter">18.1.6 <code>prev_quarter</code>, <code>next_quarter</code></a></h5><p><code>prev_quarter</code> and <code>next_quarter</code> return the date with the same day in the previous or next quarter:</p><div class="code_container">
<pre><code class="language-ruby">t = Time.local(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0300
t.prev_quarter             # =&gt; 2010-02-08 00:00:00 +0200
t.next_quarter             # =&gt; 2010-08-08 00:00:00 +0300
</code></pre>
</div>
<p>Si ese día no existe, se devuelve el último día del mes correspondiente:</p><div class="code_container">
<pre><code class="language-ruby">Time.local(2000, 7, 31).prev_quarter  # =&gt; 2000-04-30 00:00:00 +0300
Time.local(2000, 5, 31).prev_quarter  # =&gt; 2000-02-29 00:00:00 +0200
Time.local(2000, 10, 31).prev_quarter # =&gt; 2000-07-31 00:00:00 +0300
Time.local(2000, 11, 31).next_quarter # =&gt; 2001-03-01 00:00:00 +0200
</code></pre>
</div>
<p><code>prev_quarter</code> is aliased to <code>last_quarter</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h4 id="time-constructors"><a class="anchorlink" href="#time-constructors">18.2 Time Constructors</a></h4><p>Active Support define <code>Time.current</code> como <code>Time.zone.now</code> si hay una zona horaria definida por el usuario, con un retorno a <code>Time.now</code>:</p><div class="code_container">
<pre><code class="language-ruby">Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;
Time.current
# =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00
</code></pre>
</div>
<p>De manera análoga a <code>DateTime</code>, los predicados <code>past?</code> y <code>future?</code> Son relativos a <code>Time.current</code>.</p><h5 id="durations"><a class="anchorlink" href="#durations">18.2.1 Durations</a></h5><p>Las duraciones se pueden sumar y restar de los objetos de tiempo:</p><div class="code_container">
<pre><code class="language-ruby">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00
</code></pre>
</div>
<p>Se traducen en llamadas a <code>since</code> o <code>advance</code>. Por ejemplo aquí obtenemos el salto correcto en la reforma del calendario:</p><div class="code_container">
<pre><code class="language-ruby">Time.utc(1582, 10, 3) + 5.days
# =&gt; Mon Oct 18 00:00:00 UTC 1582
</code></pre>
</div>
<h3 id="extensions-to-file"><a class="anchorlink" href="#extensions-to-file">19 Extensions to <code>File</code></a></h3><h4 id="atomic-write"><a class="anchorlink" href="#atomic-write">19.1 <code>atomic_write</code></a></h4><p>Con el método de clase <code>File.atomic_write</code> puedes escribir en un archivo de una manera que evitará que cualquier lector vea contenido a medio escribir.</p><p>El nombre del archivo se pasa como argumento y el método produce un identificador de archivo abierto para escritura. Una vez que el bloque está hecho, atomic_write cierra el identificador del archivo y completa su trabajo.</p><p>For example, Action Pack uses this method to write asset cache files like <code>all.css</code>:</p><div class="code_container">
<pre><code class="language-ruby">File.atomic_write(joined_asset_path) do |cache|
  cache.write(join_asset_file_contents(asset_paths))
end
</code></pre>
</div>
<p>Para lograr esto, atomic_write crea un archivo temporal. Ese es el archivo en el que realmente escribe el código del bloque. Al finalizar, se cambia el nombre del archivo temporal, que es una operación atómica en los sistemas POSIX. Si el archivo de destino existe, <code>atomic_write</code> lo sobrescribe y conserva los propietarios y los permisos. Sin embargo, hay algunos casos en los que atomic_write no puede cambiar la propiedad o los permisos del archivo, este error se detecta y se omite confiando en el usuario/sistema de archivos para garantizar que el archivo sea accesible para los procesos que lo necesitan.</p><div class="note"><p>Debido a la operación chmod que realiza <code>atomic_write</code>, si el archivo de destino tiene una ACL configurada, esta ACL será recalculada / modificada.</p></div><div class="warning"><p>Tenga en cuenta que no puede agregar con <code>atomic_write</code>.</p></div><p>El archivo auxiliar está escrito en un directorio estándar para archivos temporales, pero puede pasar un directorio de su elección como segundo argumento.</p><div class="note"><p>Definido en <code>active_support/core_ext/file/atomic.rb</code>.</p></div><h3 id="extensions-to-marshal"><a class="anchorlink" href="#extensions-to-marshal">20 Extensions to <code>Marshal</code></a></h3><h4 id="load"><a class="anchorlink" href="#load">20.1 <code>load</code></a></h4><p>Active Support agrega soporte constante de carga automática a <code>load</code>.</p><p>Por ejemplo, el almacén de caché de archivos se deserializa de esta manera:</p><div class="code_container">
<pre><code class="language-ruby">File.open(file_name) { |f| Marshal.load(f) }
</code></pre>
</div>
<p>Si los datos almacenados en caché hacen referencia a una constante desconocida en ese momento, se activa el mecanismo de carga automática y, si tiene éxito, la deserialización se vuelve a intentar de forma transparente.</p><p>ADVERTENCIA. Si el argumento es un <code>IO</code>, debe responder a <code>rewind</code> para poder volver a intentarlo. Los archivos normales responden a <code>rewind</code>.</p><div class="note"><p>Definido en <code>active_support/core_ext/marshal.rb</code>.</p></div><h3 id="extensions-to-nameerror"><a class="anchorlink" href="#extensions-to-nameerror">21 Extensions to <code>NameError</code></a></h3><p>Active Support agrega <code>missing_name?</code> a <code>NameError</code>, que prueba si la excepción se generó debido al nombre pasado como argumento.</p><p>El nombre puede darse como símbolo o cadena. Un símbolo se compara con el nombre de constante simple, una cadena se compara con el nombre de constante completo.</p><div class="info"><p>Un símbolo puede representar un nombre de constante totalmente calificado como en <code>:" ActiveRecord :: Base "</code>, por lo que el comportamiento de los símbolos se define por conveniencia, no porque tenga que ser así técnicamente.</p></div><p>Por ejemplo, cuando una acción de <code>ArticlesController</code> se llama, Rails intenta de forma optimista usar <code>ArticlesHelper</code>. Está bien que el módulo auxiliar no exista, por lo que si se genera una excepción para ese nombre constante, se debe silenciar. Pero podría darse el caso de que <code>articles_helper.rb</code> genere un<code>NameError</code> debido a una constante desconocida real. Eso debería volver a plantearse. El método <code>missing_name?</code> Proporciona una forma de distinguir ambos casos:</p><div class="code_container">
<pre><code class="language-ruby">def default_helper_module!
  module_name = name.sub(/Controller$/, '')
  module_path = module_name.underscore
  helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "helpers/#{module_path}_helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
</code></pre>
</div>
<div class="note"><p>Definido en active_support/core_ext/name_error.rb`.</p></div><h3 id="extensions-to-loaderror"><a class="anchorlink" href="#extensions-to-loaderror">22 Extensions to <code>LoadError</code></a></h3><p>Active Support agrega <code>is_missing?</code> a <code>LoadError</code>.</p><p>Dado un nombre de ruta, <code>is_missing?</code> Prueba si la excepción se generó debido a ese archivo en particular (excepto quizás por la extensión ".rb").</p><p>Por ejemplo, cuando una acción de <code>ArticlesController</code> se llama, Rails intenta cargar <code>articles_helper.rb</code>, pero es posible que ese archivo no exista. Está bien, el módulo de ayuda no es obligatorio, por lo que Rails silencia un error de carga. Pero podría darse el caso de que el módulo auxiliar exista y, a su vez, requiera otra biblioteca que falte. En ese caso, Rails debe volver a generar la excepción. El método <code>is_missing?</code> Proporciona una forma de distinguir ambos casos:</p><div class="code_container">
<pre><code class="language-ruby">def default_helper_module!
  module_name = name.sub(/Controller$/, '')
  module_path = module_name.underscore
  helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "helpers/#{module_path}_helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
</code></pre>
</div>
<div class="note"><p>Definido en <code>active_support/core_ext/load_error.rb</code>.</p></div>

        <h3>Comentarios Sobre el Contenido</h3>
        <p>
          Las guías de rieles se administran y publican en latinadeveloper/railsguides.es en GitHub.
        </p>
        <p>
          Si lee esta guía y encuentra algún texto o código incorrecto que le interese, no dude en enviar una solicitud de extracción en el repositorio anterior.

          Consulte el archivo README en GitHub para saber cómo enviar una solicitud de extracción.
          Please contribute if you see any typos or factual errors.
        </p>

      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a> License</p>
<p>"Rails", "Ruby on Rails", and the Rails logo are trademarks of David Heinemeier Hansson. All rights reserved.</p>

    </div>
  </div>
</body>
</html>
